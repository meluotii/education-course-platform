typeof window<"u"&&function(Pe,de){"object"==typeof exports&&"object"==typeof module?module.exports=de():"function"==typeof define&&define.amd?define([],de):"object"==typeof exports?exports.Hls=de():Pe.Hls=de()}(this,()=>(()=>{var Oe={"./src/config.ts":
/*!***********************!*\
          !*** ./src/config.ts ***!
          \***********************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{enableStreamingMode:()=>r,hlsDefaultConfig:()=>f,mergeConfig:()=>t});var F=L(
/*! ./controller/abr-controller */
"./src/controller/abr-controller.ts"),A=L(
/*! ./controller/audio-stream-controller */
"./src/controller/audio-stream-controller.ts"),b=L(
/*! ./controller/audio-track-controller */
"./src/controller/audio-track-controller.ts"),R=L(
/*! ./controller/subtitle-stream-controller */
"./src/controller/subtitle-stream-controller.ts"),k=L(
/*! ./controller/subtitle-track-controller */
"./src/controller/subtitle-track-controller.ts"),P=L(
/*! ./controller/buffer-controller */
"./src/controller/buffer-controller.ts"),D=L(
/*! ./controller/timeline-controller */
"./src/controller/timeline-controller.ts"),S=L(
/*! ./controller/cap-level-controller */
"./src/controller/cap-level-controller.ts"),T=L(
/*! ./controller/fps-controller */
"./src/controller/fps-controller.ts"),_=L(
/*! ./controller/eme-controller */
"./src/controller/eme-controller.ts"),h=L(
/*! ./controller/cmcd-controller */
"./src/controller/cmcd-controller.ts"),y=L(
/*! ./utils/xhr-loader */
"./src/utils/xhr-loader.ts"),m=L(
/*! ./utils/fetch-loader */
"./src/utils/fetch-loader.ts"),l=L(
/*! ./utils/cues */
"./src/utils/cues.ts"),a=L(
/*! ./utils/mediakeys-helper */
"./src/utils/mediakeys-helper.ts"),o=L(
/*! ./utils/logger */
"./src/utils/logger.ts");function n(){return n=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var p=arguments[s];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(e[g]=p[g])}return e},n.apply(this,arguments)}function d(e,s){var p=Object.keys(e);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(e);s&&(g=g.filter(function(x){return Object.getOwnPropertyDescriptor(e,x).enumerable})),p.push.apply(p,g)}return p}function c(e){for(var s=1;s<arguments.length;s++){var p=null!=arguments[s]?arguments[s]:{};s%2?d(Object(p),!0).forEach(function(g){i(e,g,p[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(p)):d(Object(p)).forEach(function(g){Object.defineProperty(e,g,Object.getOwnPropertyDescriptor(p,g))})}return e}function i(e,s,p){return s=function u(e){var s=function E(e,s){if("object"!=typeof e||null===e)return e;var p=e[Symbol.toPrimitive];if(void 0!==p){var g=p.call(e,s||"default");if("object"!=typeof g)return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:String(s)}(s),s in e?Object.defineProperty(e,s,{value:p,enumerable:!0,configurable:!0,writable:!0}):e[s]=p,e}var f=c(c({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:y.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:F.default,bufferController:P.default,capLevelController:S.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:a.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},function v(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:k.default,timelineController:D.TimelineController,audioStreamController:A.default,audioTrackController:b.default,emeController:_.default,cmcdController:h.default});function t(e,s){if((s.liveSyncDurationCount||s.liveMaxLatencyDurationCount)&&(s.liveSyncDuration||s.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==s.liveMaxLatencyDurationCount&&(void 0===s.liveSyncDurationCount||s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==s.liveMaxLatencyDuration&&(void 0===s.liveSyncDuration||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return n({},e,s)}function r(e){var s=e.loader;s!==m.default&&s!==y.default?(o.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):(0,m.fetchSupported)()&&(e.loader=m.default,e.progressive=!0,e.enableSoftwareAES=!0,o.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":
/*!******************************************!*\
          !*** ./src/controller/abr-controller.ts ***!
          \******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>y});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../utils/ewma-bandwidth-estimator */
"./src/utils/ewma-bandwidth-estimator.ts"),b=L(
/*! ../events */
"./src/events.ts"),R=L(
/*! ../errors */
"./src/errors.ts"),k=L(
/*! ../types/loader */
"./src/types/loader.ts"),P=L(
/*! ../utils/logger */
"./src/utils/logger.ts");function D(m,l){for(var a=0;a<l.length;a++){var o=l[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,T(o.key),o)}}function T(m){var l=function _(m,l){if("object"!=typeof m||null===m)return m;var a=m[Symbol.toPrimitive];if(void 0!==a){var o=a.call(m,l||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(m)}(m,"string");return"symbol"==typeof l?l:String(l)}const y=function(){function m(a){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=a;var o=a.config;this.bwEstimator=new A.default(o.abrEwmaSlowVoD,o.abrEwmaFastVoD,o.abrEwmaDefaultEstimate),this.registerListeners()}var l=m.prototype;return l.registerListeners=function(){var o=this.hls;o.on(b.Events.FRAG_LOADING,this.onFragLoading,this),o.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(b.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var o=this.hls;o.off(b.Events.FRAG_LOADING,this.onFragLoading,this),o.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(b.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(o,n){var c,d=n.frag;d.type!==k.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=d,this.partCurrent=null!=(c=n.part)?c:null,this.timer=self.setInterval(this.onCheck,100))},l.onLevelLoaded=function(o,n){var d=this.hls.config;n.details.live?this.bwEstimator.update(d.abrEwmaSlowLive,d.abrEwmaFastLive):this.bwEstimator.update(d.abrEwmaSlowVoD,d.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var o=this.fragCurrent,n=this.partCurrent,d=this.hls,c=d.autoLevelEnabled,i=d.media;if(o&&i){var u=n?n.stats:o.stats,E=n?n.duration:o.duration;if(u.aborted||u.loaded&&u.loaded===u.total||0===o.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(c&&!i.paused&&i.playbackRate&&i.readyState){var f=d.mainForwardBufferInfo;if(null!==f){var v=performance.now()-u.loading.start,t=Math.abs(i.playbackRate);if(!(v<=500*E/t)){var r=u.loaded&&u.loading.first,e=this.bwEstimator.getEstimate(),s=d.levels,p=d.minAutoLevel,x=u.total||Math.max(u.loaded,Math.round(E*s[o.level].maxBitrate/8)),O=r?1e3*u.loaded/v:0,I=O?(x-u.loaded)/O:8*x/e,C=f.len/t;if(!(I<=C)){var U,M=Number.POSITIVE_INFINITY;for(U=o.level-1;U>p;U--){var w=s[U].maxBitrate;if((M=O?E*w/(6.4*O):E*w/e)<C)break}M>=I||(P.logger.warn("Fragment "+o.sn+(n?" part "+n.index:"")+" of level "+o.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+U+"\n      Current BW estimate: "+((0,F.isFiniteNumber)(e)?(e/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+I.toFixed(3)+" s\n      Estimated load time for the next fragment: "+M.toFixed(3)+" s\n      Time to underbuffer: "+C.toFixed(3)+" s"),d.nextLoadLevel=U,r&&this.bwEstimator.sample(v,u.loaded),this.clearTimer(),(o.loader||o.keyLoader)&&(this.fragCurrent=this.partCurrent=null,o.abortRequests()),d.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:o,part:n,stats:u}))}}}}}},l.onFragLoaded=function(o,n){var d=n.frag,c=n.part;if(d.type===k.PlaylistLevelType.MAIN&&(0,F.isFiniteNumber)(d.sn)){var i=c?c.stats:d.stats,u=c?c.duration:d.duration;if(this.clearTimer(),this.lastLoadedFragLevel=d.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var E=this.hls.levels[d.level],f=(E.loaded?E.loaded.bytes:0)+i.loaded,v=(E.loaded?E.loaded.duration:0)+u;E.loaded={bytes:f,duration:v},E.realBitrate=Math.round(8*f/v)}d.bitrateTest&&this.onFragBuffered(b.Events.FRAG_BUFFERED,{stats:i,frag:d,part:c,id:d.type})}},l.onFragBuffered=function(o,n){var d=n.frag,c=n.part,i=c?c.stats:d.stats;if(!i.aborted&&d.type===k.PlaylistLevelType.MAIN&&"initSegment"!==d.sn){var u=i.parsing.end-i.loading.start;this.bwEstimator.sample(u,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=d.bitrateTest?u/1e3:0}},l.onError=function(o,n){var d;if((null===(d=n.frag)||void 0===d?void 0:d.type)===k.PlaylistLevelType.MAIN){if(n.type===R.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(n.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:case R.ErrorDetails.KEY_LOAD_ERROR:case R.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var o=this.fragCurrent,n=this.partCurrent,d=this.hls,c=d.maxAutoLevel,i=d.config,u=d.minAutoLevel,E=d.media,f=n?n.duration:o?o.duration:0,v=E&&0!==E.playbackRate?Math.abs(E.playbackRate):1,t=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,r=d.mainForwardBufferInfo,e=(r?r.len:0)/v,s=this.findBestLevel(t,u,c,e,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(s>=0)return s;P.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=f?Math.min(f,i.maxStarvationDelay):i.maxStarvationDelay,g=i.abrBandWidthFactor,x=i.abrBandWidthUpFactor;if(!e){var O=this.bitrateTestDelay;O&&(p=(f?Math.min(f,i.maxLoadingDelay):i.maxLoadingDelay)-O,P.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),g=x=1)}return s=this.findBestLevel(t,u,c,e+p,g,x),Math.max(s,0)},l.findBestLevel=function(o,n,d,c,i,u){for(var E,f=this.fragCurrent,v=this.partCurrent,t=this.lastLoadedFragLevel,r=this.hls.levels,e=r[t],s=!(null==e||null===(E=e.details)||void 0===E||!E.live),p=e?.codecSet,g=v?v.duration:f?f.duration:0,x=d;x>=n;x--){var O=r[x];if(O&&(!p||O.codecSet===p)){var M,I=O.details,C=(v?I?.partTarget:I?.averagetargetduration)||g,U=r[x].maxBitrate,w=U*C/(M=x<=t?i*o:u*o);if(P.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+x+"/"+Math.round(M)+"/"+U+"/"+C+"/"+c+"/"+w),M>U&&(0===w||!(0,F.isFiniteNumber)(w)||s&&!this.bitrateTestDelay||w<c))return x}}return-1},function S(m,l,a){l&&D(m.prototype,l),a&&D(m,a),Object.defineProperty(m,"prototype",{writable:!1})}(m,[{key:"nextAutoLevel",get:function(){var o=this._nextAutoLevel;if(-1!==o&&!this.bwEstimator.canEstimate())return o;var d=this.getNextABRAutoLevel();return-1!==o&&this.hls.levels[d].loadError?o:(-1!==o&&(d=Math.min(o,d)),d)},set:function(o){this._nextAutoLevel=o}}]),m}()},"./src/controller/audio-stream-controller.ts":
/*!***************************************************!*\
          !*** ./src/controller/audio-stream-controller.ts ***!
          \***************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>i});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ./base-stream-controller */
"./src/controller/base-stream-controller.ts"),b=L(
/*! ../events */
"./src/events.ts"),R=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),k=L(
/*! ./fragment-tracker */
"./src/controller/fragment-tracker.ts"),P=L(
/*! ../types/level */
"./src/types/level.ts"),D=L(
/*! ../types/loader */
"./src/types/loader.ts"),S=L(
/*! ../loader/fragment */
"./src/loader/fragment.ts"),T=L(
/*! ../demux/chunk-cache */
"./src/demux/chunk-cache.ts"),_=L(
/*! ../demux/transmuxer-interface */
"./src/demux/transmuxer-interface.ts"),h=L(
/*! ../types/transmuxer */
"./src/types/transmuxer.ts"),y=L(
/*! ./fragment-finders */
"./src/controller/fragment-finders.ts"),m=L(
/*! ../utils/discontinuities */
"./src/utils/discontinuities.ts"),l=L(
/*! ../errors */
"./src/errors.ts");function a(){return a=Object.assign?Object.assign.bind():function(u){for(var E=1;E<arguments.length;E++){var f=arguments[E];for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(u[v]=f[v])}return u},a.apply(this,arguments)}function n(u,E){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,t){return v.__proto__=t,v})(u,E)}const i=function(u){function E(v,t,r){var e;return(e=u.call(this,v,t,r,"[audio-stream-controller]")||this).videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}!function o(u,E){u.prototype=Object.create(E.prototype),u.prototype.constructor=u,n(u,E)}(E,u);var f=E.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var t=this.hls;t.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.Events.ERROR,this.onError,this),t.on(b.Events.BUFFER_RESET,this.onBufferReset,this),t.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var t=this.hls;t.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.Events.ERROR,this.onError,this),t.off(b.Events.BUFFER_RESET,this.onBufferReset,this),t.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f.onInitPtsFound=function(t,r){var e=r.frag,p=r.initPTS;if("main"===r.id){var g=e.cc;this.initPTS[e.cc]=p,this.log("InitPTS for cc: "+g+" found from main: "+p),this.videoTrackCC=g,this.state===A.State.WAITING_INIT_PTS&&this.tick()}},f.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=A.State.STOPPED);var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,r>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r,this.state=A.State.IDLE):(this.loadedmetadata=!1,this.state=A.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},f.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_TRACK:var t,r=this.levels,s=null==r||null===(t=r[this.trackId])||void 0===t?void 0:t.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=A.State.WAITING_INIT_PTS}break;case A.State.FRAG_LOADING_WAITING_RETRY:var p,g=performance.now(),x=this.retryDate;(!x||g>=x||null!==(p=this.media)&&void 0!==p&&p.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=A.State.IDLE);break;case A.State.WAITING_INIT_PTS:var O=this.waitingData;if(O){var I=O.frag,C=O.part,M=O.cache,U=O.complete;if(void 0!==this.initPTS[I.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.FRAG_LOADING;var K={frag:I,part:C,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(K),U&&u.prototype._handleFragmentLoadComplete.call(this,K)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+I.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var N=this.getLoadPosition(),W=R.BufferHelper.bufferInfo(this.mediaBuffer,N,this.config.maxBufferHole);(0,y.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,I)<0&&(this.log("Waiting fragment cc ("+I.cc+") @ "+I.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=A.State.IDLE}this.onTickEnd()},f.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.IDLE)},f.resetLoadingState=function(){this.clearWaitingFragment(),u.prototype.resetLoadingState.call(this)},f.onTickEnd=function(){var t=this.media;!t||!t.readyState||(this.lastCurrentTime=t.currentTime)},f.doTickIdle=function(){var t=this.hls,r=this.levels,e=this.media,s=this.trackId;if(r&&r[s]&&(e||!this.startFragRequested&&t.config.startFragPrefetch)){var x=r[s].details;if(!x||x.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(x))return void(this.state=A.State.WAITING_TRACK);var O=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&O&&(this.bufferFlushed=!1,this.afterBufferFlushed(O,S.ElementaryStreamTypes.AUDIO,D.PlaylistLevelType.AUDIO));var I=this.getFwdBufferInfo(O,D.PlaylistLevelType.AUDIO);if(null!==I){var C=this.audioSwitch;if(!C&&this._streamEnded(I,x))return t.trigger(b.Events.BUFFER_EOS,{type:"audio"}),void(this.state=A.State.ENDED);var M=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,D.PlaylistLevelType.MAIN);if(!(I.len>=this.getMaxBufferLength(M?.len))||C){var N=x.fragments[0].start,W=I.end;if(C&&e){var G=this.getLoadPosition();W=G,x.PTSKnown&&G<N&&(I.end>N||I.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=N+.05)}if(!(M&&W>M.end+x.targetduration)&&(M&&M.len||!I.len)){var V=this.getNextFragment(W,x);if(!V)return void(this.bufferFlushed=!0);this.loadFragment(V,x,W)}}}}},f.getMaxBufferLength=function(t){var r=u.prototype.getMaxBufferLength.call(this);return t?Math.max(r,t):r},f.onMediaDetaching=function(){this.videoBuffer=null,u.prototype.onMediaDetaching.call(this)},f.onAudioTracksUpdated=function(t,r){var e=r.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(s){return new P.Level(s)})},f.onAudioTrackSwitching=function(t,r){var e=!!r.url;this.trackId=r.id;var s=this.fragCurrent;s&&s.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),e?this.setInterval(100):this.resetTransmuxer(),e?(this.audioSwitch=!0,this.state=A.State.IDLE):this.state=A.State.STOPPED,this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},f.onLevelLoaded=function(t,r){this.mainDetails=r.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(b.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},f.onAudioTrackLoaded=function(t,r){var e;if(null!=this.mainDetails){var s=this.levels,p=r.details,g=r.id;if(s){this.log("Track "+g+" loaded ["+p.startSN+","+p.endSN+"],duration:"+p.totalduration);var x=s[g],O=0;if(p.live||null!==(e=x.details)&&void 0!==e&&e.live){var I=this.mainDetails;if(p.fragments[0]||(p.deltaUpdateFailed=!0),p.deltaUpdateFailed||!I)return;!x.details&&p.hasProgramDateTime&&I.hasProgramDateTime?((0,m.alignMediaPlaylistByPDT)(p,I),O=p.fragments[0].start):O=this.alignPlaylists(p,x.details)}x.details=p,this.levelLastLoaded=g,!this.startFragRequested&&(this.mainDetails||!p.live)&&this.setStartPosition(x.details,O),this.state===A.State.WAITING_TRACK&&!this.waitForCdnTuneIn(p)&&(this.state=A.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+g)}else this.cachedTrackLoadedData=r},f._handleFragmentLoadProgress=function(t){var r,e=t.frag,s=t.part,p=t.payload,g=this.config,x=this.trackId,O=this.levels;if(O){var I=O[x];console.assert(I,"Audio track is defined on fragment load progress");var C=I.details;console.assert(C,"Audio track details are defined on fragment load progress");var M=g.defaultAudioCodec||I.audioCodec||"mp4a.40.2",U=this.transmuxer;U||(U=this.transmuxer=new _.default(this.hls,D.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[e.cc],K=null===(r=e.initSegment)||void 0===r?void 0:r.data;if(void 0!==w){var W=s?s.index:-1,V=new h.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,p.byteLength,W,-1!==W);U.push(p,K,M,"",e,s,C.totalduration,!1,V,w)}else this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+C.startSN+" ,"+C.endSN+"],track "+x),(this.waitingData=this.waitingData||{frag:e,part:s,cache:new T.default,complete:!1}).cache.push(new Uint8Array(p)),this.waitingVideoCC=this.videoTrackCC,this.state=A.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered")},f._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:u.prototype._handleFragmentLoadComplete.call(this,t)},f.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},f.onBufferCreated=function(t,r){var e=r.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer||null)},f.onFragBuffered=function(t,r){var p,e=r.frag,s=r.part;e.type===D.PlaylistLevelType.AUDIO?this.fragContextChanged(e)?this.warn("Fragment "+e.sn+(s?" p: "+s.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==e.sn&&(this.fragPrevious=e,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(e,s)):this.loadedmetadata||e.type!==D.PlaylistLevelType.MAIN||null!==(p=this.videoBuffer||this.media)&&void 0!==p&&p.buffered.length&&(this.loadedmetadata=!0)},f.onError=function(t,r){if(r.type!==l.ErrorTypes.KEY_SYSTEM_ERROR)switch(r.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.FRAG_PARSING_ERROR:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(D.PlaylistLevelType.AUDIO,r);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==A.State.ERROR&&this.state!==A.State.STOPPED&&(this.state=r.fatal?A.State.ERROR:A.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===r.parent&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var e=!0,s=this.getFwdBufferInfo(this.mediaBuffer,D.PlaylistLevelType.AUDIO);s&&s.len>.5&&(e=!this.reduceMaxBufferLength(s.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,u.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(D.PlaylistLevelType.AUDIO,r)},f.onBufferFlushed=function(t,r){r.type===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===A.State.ENDED&&(this.state=A.State.IDLE))},f._handleTransmuxComplete=function(t){var r,e="audio",s=this.hls,p=t.remuxResult,g=t.chunkMeta,x=this.getCurrentContext(g);if(!x)return this.warn("The loading context changed while buffering fragment "+g.sn+" of level "+g.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(g.level);var O=x.frag,I=x.part,C=x.level.details,M=p.audio,U=p.text,w=p.id3,K=p.initSegment;if(!this.fragContextChanged(O)&&C){if(this.state=A.State.PARSING,this.audioSwitch&&M&&this.completeAudioSwitch(),null!=K&&K.tracks&&(this._bufferInitSegment(K.tracks,O,g),s.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:e,tracks:K.tracks})),M){var N=M.startPTS,W=M.endPTS,G=M.startDTS,V=M.endDTS;I&&(I.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:N,endPTS:W,startDTS:G,endDTS:V}),O.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,N,W,G,V),this.bufferFragmentData(M,O,I,g)}if(null!=w&&null!==(r=w.samples)&&void 0!==r&&r.length){var H=a({id:e,frag:O,details:C},w);s.trigger(b.Events.FRAG_PARSING_METADATA,H)}if(U){var j=a({id:e,frag:O,details:C},U);s.trigger(b.Events.FRAG_PARSING_USERDATA,j)}}},f._bufferInitSegment=function(t,r,e){if(this.state===A.State.PARSING){t.video&&delete t.video;var s=t.audio;if(s){s.levelCodec=s.codec,s.id="audio",this.log("Init audio buffer, container:"+s.container+", codecs[parsed]=["+s.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,t);var p=s.initSegment;null!=p&&p.byteLength&&this.hls.trigger(b.Events.BUFFER_APPENDING,{type:"audio",frag:r,part:null,chunkMeta:e,parent:r.type,data:p}),this.tick()}}},f.loadFragment=function(t,r,e){var s=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||s===k.FragmentState.NOT_LOADED||s===k.FragmentState.PARTIAL)&&("initSegment"===t.sn?this._loadInitSegment(t,r):r.live&&!(0,F.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=A.State.WAITING_INIT_PTS):(this.startFragRequested=!0,u.prototype.loadFragment.call(this,t,r,e)))},f.completeAudioSwitch=function(){var t=this.hls,e=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),u.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:e})},E}(A.default)},"./src/controller/audio-track-controller.ts":
/*!**************************************************!*\
          !*** ./src/controller/audio-track-controller.ts ***!
          \**************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>y});var F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../errors */
"./src/errors.ts"),b=L(
/*! ./base-playlist-controller */
"./src/controller/base-playlist-controller.ts"),R=L(
/*! ../types/loader */
"./src/types/loader.ts");function k(m,l){for(var a=0;a<l.length;a++){var o=l[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,D(o.key),o)}}function D(m){var l=function S(m,l){if("object"!=typeof m||null===m)return m;var a=m[Symbol.toPrimitive];if(void 0!==a){var o=a.call(m,l||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(m)}(m,"string");return"symbol"==typeof l?l:String(l)}function _(m,l){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,n){return o.__proto__=n,o})(m,l)}const y=function(m){function l(o){var n;return(n=m.call(this,o,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}!function T(m,l){m.prototype=Object.create(l.prototype),m.prototype.constructor=m,_(m,l)}(l,m);var a=l.prototype;return a.registerListeners=function(){var n=this.hls;n.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(F.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var n=this.hls;n.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(F.Events.ERROR,this.onError,this)},a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,m.prototype.destroy.call(this)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},a.onManifestParsed=function(n,d){this.tracks=d.audioTracks||[]},a.onAudioTrackLoaded=function(n,d){var c=d.id,i=d.details,u=this.tracksInGroup[c];if(u){var E=u.details;u.details=d.details,this.log("audioTrack "+c+" loaded ["+i.startSN+"-"+i.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,d,E))}else this.warn("Invalid audio track id "+c)},a.onLevelLoading=function(n,d){this.switchLevel(d.level)},a.onLevelSwitching=function(n,d){this.switchLevel(d.level)},a.switchLevel=function(n){var d=this.hls.levels[n];if(null!=d&&d.audioGroupIds){var c=d.audioGroupIds[d.urlId];if(this.groupId!==c){this.groupId=c;var i=this.tracks.filter(function(E){return!c||E.groupId===c});this.selectDefaultTrack&&!i.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var u={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(F.Events.AUDIO_TRACKS_UPDATED,u),this.selectInitialTrack()}}},a.onError=function(n,d){m.prototype.onError.call(this,n,d),!d.fatal&&d.context&&d.context.type===R.PlaylistContextType.AUDIO_TRACK&&d.context.id===this.trackId&&d.context.groupId===this.groupId&&this.retryLoadingOrFail(d)},a.setAudioTrack=function(n){var d=this.tracksInGroup;if(n<0||n>=d.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var c=d[this.trackId];this.log("Now switching to audio-track index "+n);var i=d[n],u=i.id,E=i.groupId,f=void 0===E?"":E,v=i.name,t=i.type,r=i.url;if(this.trackId=n,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(F.Events.AUDIO_TRACK_SWITCHING,{id:u,groupId:f,name:v,type:t,url:r}),!i.details||i.details.live){var e=this.switchParams(i.url,c?.details);this.loadPlaylist(e)}}},a.selectInitialTrack=function(){console.assert(this.tracksInGroup.length,"Initial audio track should be selected when tracks are known");var c=this.findTrackId(this.trackName)||this.findTrackId();-1!==c?this.setAudioTrack(c):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},a.findTrackId=function(n){for(var d=this.tracksInGroup,c=0;c<d.length;c++){var i=d[c];if((!this.selectDefaultTrack||i.default)&&(!n||n===i.name))return i.id}return-1},a.loadPlaylist=function(n){m.prototype.loadPlaylist.call(this);var d=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(d)){var c=d.id,i=d.groupId,u=d.url;if(n)try{u=n.addDirectives(u)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("loading audio-track playlist for id: "+c),this.clearTimer(),this.hls.trigger(F.Events.AUDIO_TRACK_LOADING,{url:u,id:c,groupId:i,deliveryDirectives:n||null})}},function P(m,l,a){l&&k(m.prototype,l),a&&k(m,a),Object.defineProperty(m,"prototype",{writable:!1})}(l,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),l}(b.default)},"./src/controller/base-playlist-controller.ts":
/*!****************************************************!*\
          !*** ./src/controller/base-playlist-controller.ts ***!
          \****************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>k});var F=L(
/*! ../types/level */
"./src/types/level.ts"),A=L(
/*! ./level-helper */
"./src/controller/level-helper.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),R=L(
/*! ../errors */
"./src/errors.ts"),k=function(){function P(S,T){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,T+":"),this.warn=b.logger.warn.bind(b.logger,T+":"),this.hls=S}var D=P.prototype;return D.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},D.onError=function(T,_){_.fatal&&(_.type===R.ErrorTypes.NETWORK_ERROR||_.type===R.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},D.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},D.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},D.stopLoad=function(){this.canLoad=!1,this.clearTimer()},D.switchParams=function(T,_){var h=_?.renditionReports;if(h)for(var y=0;y<h.length;y++){var m=h[y],l=void 0;try{l=new self.URL(m.URI,_.url).href}catch(d){b.logger.warn("Could not construct new URL for Rendition Report: "+d),l=m.URI||""}if(l===T.slice(-l.length)){var a=parseInt(m["LAST-MSN"])||_?.lastPartSn,o=parseInt(m["LAST-PART"])||_?.lastPartIndex;if(this.hls.config.lowLatencyMode){var n=Math.min(_.age-_.partTarget,_.targetduration);o>=0&&n>_.partTarget&&(o+=1)}return new F.HlsUrlParameters(a,o>=0?o:void 0,F.HlsSkip.No)}}},D.loadPlaylist=function(T){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},D.shouldLoadTrack=function(T){return this.canLoad&&T&&!!T.url&&(!T.details||T.details.live)},D.playlistLoaded=function(T,_,h){var y=this,m=_.details,l=_.stats,a=self.performance.now(),o=l.loading.first?Math.max(0,a-l.loading.first):0;if(m.advancedDateTime=Date.now()-o,m.live||null!=h&&h.live){if(m.reloaded(h),h&&this.log("live playlist "+T+" "+(m.advanced?"REFRESHED "+m.lastPartSn+"-"+m.lastPartIndex:"MISSED")),h&&m.fragments.length>0&&(0,A.mergeDetails)(h,m),!this.canLoad||!m.live)return;var n,d=void 0,c=void 0;if(m.canBlockReload&&m.endSN&&m.advanced){var i=this.hls.config.lowLatencyMode,u=m.lastPartSn,E=m.endSN,f=m.lastPartIndex,t=u===E;-1!==f?(d=t?E+1:u,c=t?i?0:f:f+1):d=E+1;var e=m.age,p=Math.min(e+m.ageHeader-m.partTarget,1.5*m.targetduration);if(p>0){if(h&&p>h.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+h.tuneInGoal+" to: "+p+" with playlist age: "+m.age),p=0;else{var g=Math.floor(p/m.targetduration);d+=g,void 0!==c&&(c+=Math.round(p%m.targetduration/m.partTarget)),this.log("CDN Tune-in age: "+m.ageHeader+"s last advanced "+e.toFixed(2)+"s goal: "+p+" skip sn "+g+" to part "+c)}m.tuneInGoal=p}if(n=this.getDeliveryDirectives(m,_.deliveryDirectives,d,c),i||!t)return void this.loadPlaylist(n)}else n=this.getDeliveryDirectives(m,_.deliveryDirectives,d,c);var O=this.hls.mainForwardBufferInfo,M=(0,A.computeReloadInterval)(m,1e3*(m.edge-(O?O.end-O.len:0)));m.updated?a>this.requestScheduled+M&&(this.requestScheduled=l.loading.start):this.requestScheduled=-1,this.requestScheduled=void 0!==d&&m.canBlockReload?l.loading.first+M-(1e3*m.partTarget||1e3):(-1===this.requestScheduled?a:this.requestScheduled)+M;var U=this.requestScheduled-a;U=Math.max(0,U),this.log("reload live playlist "+T+" in "+Math.round(U)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(n)},U)}else this.clearTimer()},D.getDeliveryDirectives=function(T,_,h,y){var m=(0,F.getSkipValue)(T,h);return null!=_&&_.skip&&T.deltaUpdateFailed&&(h=_.msn,y=_.part,m=F.HlsSkip.No),new F.HlsUrlParameters(h,y,m)},D.retryLoadingOrFail=function(T){var m,_=this,h=this.hls.config,y=this.retryCount<h.levelLoadingMaxRetry;if(y)if(this.requestScheduled=-1,this.retryCount++,T.details.indexOf("LoadTimeOut")>-1&&null!==(m=T.context)&&void 0!==m&&m.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+T.details+'"'),this.loadPlaylist();else{var l=Math.min(Math.pow(2,this.retryCount)*h.levelLoadingRetryDelay,h.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return _.loadPlaylist()},l),this.warn("retry playlist loading #"+this.retryCount+" in "+l+' ms after "'+T.details+'"')}else this.warn('cannot recover from error "'+T.details+'"'),this.clearTimer(),T.fatal=!0;return y},P}()},"./src/controller/base-stream-controller.ts":
/*!**************************************************!*\
          !*** ./src/controller/base-stream-controller.ts ***!
          \**************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{State:()=>v,default:()=>t});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../task-loop */
"./src/task-loop.ts"),b=L(
/*! ./fragment-tracker */
"./src/controller/fragment-tracker.ts"),R=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),k=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),P=L(
/*! ../events */
"./src/events.ts"),D=L(
/*! ../errors */
"./src/errors.ts"),S=L(
/*! ../types/transmuxer */
"./src/types/transmuxer.ts"),T=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),_=L(
/*! ../utils/discontinuities */
"./src/utils/discontinuities.ts"),h=L(
/*! ./fragment-finders */
"./src/controller/fragment-finders.ts"),y=L(
/*! ./level-helper */
"./src/controller/level-helper.ts"),m=L(
/*! ../loader/fragment-loader */
"./src/loader/fragment-loader.ts"),l=L(
/*! ../crypt/decrypter */
"./src/crypt/decrypter.ts"),a=L(
/*! ../utils/time-ranges */
"./src/utils/time-ranges.ts"),o=L(
/*! ../types/loader */
"./src/types/loader.ts");function n(r,e){for(var s=0;s<e.length;s++){var p=e[s];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(r,c(p.key),p)}}function c(r){var e=function i(r,e){if("object"!=typeof r||null===r)return r;var s=r[Symbol.toPrimitive];if(void 0!==s){var p=s.call(r,e||"default");if("object"!=typeof p)return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(r)}(r,"string");return"symbol"==typeof e?e:String(e)}function f(r,e){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,g){return p.__proto__=g,p})(r,e)}var v={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(r){function e(p,g,x,O){var I;return(I=r.call(this)||this).hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=v.STOPPED,I.media=null,I.mediaBuffer=null,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.keyLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=O,I.log=k.logger.log.bind(k.logger,O+":"),I.warn=k.logger.warn.bind(k.logger,O+":"),I.hls=p,I.fragmentLoader=new m.default(p.config),I.keyLoader=x,I.fragmentTracker=g,I.config=p.config,I.decrypter=new l.default(p.config),p.on(P.Events.LEVEL_SWITCHING,I.onLevelSwitching,function u(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(I)),I}!function E(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,f(r,e)}(e,r);var s=e.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(g){},s.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var g=this.fragCurrent;g&&(g.abortRequests(),this.fragmentTracker.removeFragment(g)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=v.STOPPED},s._streamEnded=function(g,x){if(x.live||g.nextStart||!g.end||!this.media)return!1;var O=x.partList;if(null!=O&&O.length){var I=O[O.length-1];return R.BufferHelper.isBuffered(this.media,I.start+I.duration/2)}return this.fragmentTracker.isEndListAppended(x.fragments[x.fragments.length-1].type)},s.getLevelDetails=function(){var g;if(this.levels&&null!==this.levelLastLoaded)return null===(g=this.levels[this.levelLastLoaded])||void 0===g?void 0:g.details},s.onMediaAttached=function(g,x){var O=this.media=this.mediaBuffer=x.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var I=this.config;this.levels&&I.autoStartLoad&&this.state===v.STOPPED&&this.startLoad(I.startPosition)},s.onMediaDetaching=function(){var g=this.media;null!=g&&g.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),g&&this.onvseeking&&this.onvended&&(g.removeEventListener("seeking",this.onvseeking),g.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var g=this.config,x=this.fragCurrent,O=this.media,C=this.state,M=O?O.currentTime:0,U=R.BufferHelper.bufferInfo(this.mediaBuffer||O,M,g.maxBufferHole);if(this.log("media seeking to "+((0,F.isFiniteNumber)(M)?M.toFixed(3):M)+", state: "+C),this.state===v.ENDED)this.resetLoadingState();else if(x){var w=g.maxFragLookUpTolerance,K=x.start-w,N=x.start+x.duration+w;if(!U.len||N<U.start||K>U.end){var W=M>N;(M<K||W)&&(W&&x.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),x.abortRequests()),this.resetLoadingState())}}O&&(this.lastCurrentTime=M),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=M),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onLevelSwitching=function(g,x){this.fragLoadError=0},s.onHandlerDestroying=function(){this.stopLoad(),r.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=v.STOPPED,this.hls.off(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,r.prototype.onHandlerDestroyed.call(this)},s.loadFragment=function(g,x,O){this._loadFragForPlayback(g,x,O)},s._loadFragForPlayback=function(g,x,O){var I=this;this._doFragLoad(g,x,O,function(U){if(I.fragContextChanged(g))return I.warn("Fragment "+g.sn+(U.part?" p: "+U.part.index:"")+" of level "+g.level+" was dropped during download."),void I.fragmentTracker.removeFragment(g);g.stats.chunkCount++,I._handleFragmentLoadProgress(U)}).then(function(M){if(M){I.fragLoadError=0;var U=I.state;if(I.fragContextChanged(g))return void((U===v.FRAG_LOADING||!I.fragCurrent&&U===v.PARSING)&&(I.fragmentTracker.removeFragment(g),I.state=v.IDLE));"payload"in M&&(I.log("Loaded fragment "+g.sn+" of level "+g.level),I.hls.trigger(P.Events.FRAG_LOADED,M)),I._handleFragmentLoadComplete(M)}}).catch(function(M){I.state===v.STOPPED||I.state===v.ERROR||(I.warn(M),I.resetFragmentLoading(g))})},s.flushMainBuffer=function(g,x,O){if(void 0===O&&(O=null),g-x){var I={startOffset:g,endOffset:x,type:O};this.fragLoadError=0,this.hls.trigger(P.Events.BUFFER_FLUSHING,I)}},s._loadInitSegment=function(g,x){var O=this;this._doFragLoad(g,x).then(function(I){if(!I||O.fragContextChanged(g)||!O.levels)throw new Error("init load aborted");return I}).then(function(I){var C=O.hls,M=I.payload,U=g.decryptdata;if(M&&M.byteLength>0&&U&&U.key&&U.iv&&"AES-128"===U.method){var w=self.performance.now();return O.decrypter.decrypt(new Uint8Array(M),U.key.buffer,U.iv.buffer).then(function(K){var N=self.performance.now();return C.trigger(P.Events.FRAG_DECRYPTED,{frag:g,payload:K,stats:{tstart:w,tdecrypt:N}}),I.payload=K,I})}return I}).then(function(I){var C=O.fragCurrent,M=O.hls,U=O.levels;if(!U)throw new Error("init load aborted, missing levels");console.assert(U[g.level].details,"Level details are defined when init segment is loaded");var K=g.stats;O.state=v.IDLE,O.fragLoadError=0,g.data=new Uint8Array(I.payload),K.parsing.start=K.buffering.start=self.performance.now(),K.parsing.end=K.buffering.end=self.performance.now(),I.frag===C&&M.trigger(P.Events.FRAG_BUFFERED,{stats:K,frag:C,part:null,id:g.type}),O.tick()}).catch(function(I){O.state===v.STOPPED||O.state===v.ERROR||(O.warn(I),O.resetFragmentLoading(g))})},s.fragContextChanged=function(g){var x=this.fragCurrent;return!g||!x||g.level!==x.level||g.sn!==x.sn||g.urlId!==x.urlId},s.fragBufferedComplete=function(g,x){var O,I,C,M,U=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+g.type+" sn: "+g.sn+(x?" part: "+x.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+g.level+" (frag:["+(null!=(O=g.startPTS)?O:NaN).toFixed(3)+"-"+(null!=(I=g.endPTS)?I:NaN).toFixed(3)+"] > buffer:"+(U?a.default.toString(R.BufferHelper.getBuffered(U)):"(detached)")+")"),this.state=v.IDLE,U&&(!this.loadedmetadata&&g.type==o.PlaylistLevelType.MAIN&&U.buffered.length&&(null===(C=this.fragCurrent)||void 0===C?void 0:C.sn)===(null===(M=this.fragPrevious)||void 0===M?void 0:M.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},s.seekToStartPos=function(){},s._handleFragmentLoadComplete=function(g){var x=this.transmuxer;if(x){var O=g.frag,I=g.part,C=g.partsLoaded,M=!C||0===C.length||C.some(function(w){return!w}),U=new S.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,I?I.index:-1,!M);x.flush(U)}},s._handleFragmentLoadProgress=function(g){},s._doFragLoad=function(g,x,O,I){var C,M=this;if(void 0===O&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");var U=null;if(!g.encrypted||null!==(C=g.decryptdata)&&void 0!==C&&C.key?!g.encrypted&&x.encryptedFragments.length&&this.keyLoader.loadClear(g,x.encryptedFragments):(this.log("Loading key for "+g.sn+" of ["+x.startSN+"-"+x.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+g.level),this.state=v.KEY_LOADING,this.fragCurrent=g,U=this.keyLoader.load(g).then(function(G){if(!M.fragContextChanged(G.frag))return M.hls.trigger(P.Events.KEY_LOADED,G),M.state===v.KEY_LOADING&&(M.state=v.IDLE),G}),this.hls.trigger(P.Events.KEY_LOADING,{frag:g}),this.throwIfFragContextChanged("KEY_LOADING")),O=Math.max(g.start,O||0),this.config.lowLatencyMode&&x){var w=x.partList;if(w&&I){O>g.end&&x.fragmentHint&&(g=x.fragmentHint);var K=this.getNextPart(w,g,O);if(K>-1){var N=w[K];return this.log("Loading part sn: "+g.sn+" p: "+N.index+" cc: "+g.cc+" of playlist ["+x.startSN+"-"+x.endSN+"] parts [0-"+K+"-"+(w.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+g.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=v.FRAG_LOADING,this.hls.trigger(P.Events.FRAG_LOADING,{frag:g,part:w[K],targetBufferTime:O}),this.throwIfFragContextChanged("FRAG_LOADING parts"),U?U.then(function(G){return!G||M.fragContextChanged(G.frag)?null:M.doFragPartsLoad(g,w,K,I)}).catch(function(G){return M.handleFragLoadError(G)}):this.doFragPartsLoad(g,w,K,I).catch(function(G){return M.handleFragLoadError(G)})}if(!g.url||this.loadedEndOfParts(w,O))return Promise.resolve(null)}}this.log("Loading fragment "+g.sn+" cc: "+g.cc+" "+(x?"of ["+x.startSN+"-"+x.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+g.level+", target: "+parseFloat(O.toFixed(3))),(0,F.isFiniteNumber)(g.sn)&&!this.bitrateTest&&(this.nextLoadPosition=g.start+g.duration),this.state=v.FRAG_LOADING,this.hls.trigger(P.Events.FRAG_LOADING,{frag:g,targetBufferTime:O}),this.throwIfFragContextChanged("FRAG_LOADING");var W=this.config.progressive;return W&&U?U.then(function(G){return!G||M.fragContextChanged(G?.frag)?null:M.fragmentLoader.load(g,I)}).catch(function(G){return M.handleFragLoadError(G)}):Promise.all([this.fragmentLoader.load(g,W?I:void 0),U]).then(function(G){var V=G[0];return!W&&V&&I&&I(V),V}).catch(function(G){return M.handleFragLoadError(G)})},s.throwIfFragContextChanged=function(g){if(null===this.fragCurrent)throw new Error("frag load aborted, context changed in "+g)},s.doFragPartsLoad=function(g,x,O,I){var C=this;return new Promise(function(M,U){var w=[];!function N(W){var G=x[W];C.fragmentLoader.loadPart(g,G,I).then(function(V){w[G.index]=V;var H=V.part;C.hls.trigger(P.Events.FRAG_LOADED,V);var j=x[W+1];if(!j||j.fragment!==g)return M({frag:g,part:H,partsLoaded:w});N(W+1)}).catch(U)}(O)})},s.handleFragLoadError=function(g){if("data"in g){var x=g.data;g.data&&x.details===D.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(x.frag,x.part):this.hls.trigger(P.Events.ERROR,x)}else this.hls.trigger(P.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,err:g,fatal:!0});return null},s._handleTransmuxerFlush=function(g){var x=this.getCurrentContext(g);if(x&&this.state===v.PARSING){var O=x.frag,I=x.part,C=x.level,M=self.performance.now();O.stats.parsing.end=M,I&&(I.stats.parsing.end=M),this.updateLevelTiming(O,I,C,g.partial)}else!this.fragCurrent&&this.state!==v.STOPPED&&this.state!==v.ERROR&&(this.state=v.IDLE)},s.getCurrentContext=function(g){var x=this.levels,O=g.level,I=g.sn,C=g.part;if(!x||!x[O])return this.warn("Levels object was unset while buffering fragment "+I+" of level "+O+". The current chunk will not be buffered."),null;var M=x[O],U=C>-1?(0,y.getPartWith)(M,I,C):null,w=U?U.fragment:(0,y.getFragmentWithSN)(M,I,this.fragCurrent);return w?{frag:w,part:U,level:M}:null},s.bufferFragmentData=function(g,x,O,I){if(g&&this.state===v.PARSING){var C=g.data1,M=g.data2,U=C;C&&M&&(U=(0,T.appendUint8Array)(C,M)),U&&U.length&&(this.hls.trigger(P.Events.BUFFER_APPENDING,{type:g.type,frag:x,part:O,chunkMeta:I,parent:x.type,data:U}),g.dropped&&g.independent&&!O&&this.flushBufferGap(x))}},s.flushBufferGap=function(g){var x=this.media;if(x){if(!R.BufferHelper.isBuffered(x,x.currentTime))return void this.flushMainBuffer(0,g.start);var O=x.currentTime,I=R.BufferHelper.bufferInfo(x,O,0),M=Math.min(2*this.config.maxFragLookUpTolerance,.25*g.duration),U=Math.max(Math.min(g.start-M,I.end-M),O+M);g.start-U>M&&this.flushMainBuffer(U,g.start)}},s.getFwdBufferInfo=function(g,x){var O=this.config,I=this.getLoadPosition();if(!(0,F.isFiniteNumber)(I))return null;var C=R.BufferHelper.bufferInfo(g,I,O.maxBufferHole);if(0===C.len&&void 0!==C.nextStart){var M=this.fragmentTracker.getBufferedFrag(I,x);if(M&&C.nextStart<M.end)return R.BufferHelper.bufferInfo(g,I,Math.max(C.nextStart,O.maxBufferHole))}return C},s.getMaxBufferLength=function(g){var O,x=this.config;return O=g?Math.max(8*x.maxBufferSize/g,x.maxBufferLength):x.maxBufferLength,Math.min(O,x.maxMaxBufferLength)},s.reduceMaxBufferLength=function(g){var x=this.config;return x.maxMaxBufferLength>=(g||x.maxBufferLength)&&(x.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+x.maxMaxBufferLength+"s"),!0)},s.getNextFragment=function(g,x){var O=x.fragments,I=O.length;if(!I)return null;var U,C=this.config,M=O[0].start;if(x.live){var w=C.initialLiveManifestSize;if(I<w)return this.warn("Not enough fragments to start playback (have: "+I+", need: "+w+")"),null;!x.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(U=this.getInitialLiveFragment(x,O),this.startPosition=U?this.hls.liveSyncPosition||U.start:g)}else g<=M&&(U=O[0]);return U||(U=this.getFragmentAtPosition(g,C.lowLatencyMode?x.partEnd:x.fragmentEnd,x)),this.mapToInitFragWhenRequired(U)},s.mapToInitFragWhenRequired=function(g){return null==g||!g.initSegment||null!=g&&g.initSegment.data||this.bitrateTest?g:g.initSegment},s.getNextPart=function(g,x,O){for(var I=-1,C=!1,M=!0,U=0,w=g.length;U<w;U++){var K=g[U];if(M=M&&!K.independent,I>-1&&O<K.start)break;var N=K.loaded;N?I=-1:(C||K.independent||M)&&K.fragment===x&&(I=U),C=N}return I},s.loadedEndOfParts=function(g,x){var O=g[g.length-1];return O&&x>O.start&&O.loaded},s.getInitialLiveFragment=function(g,x){var O=this.fragPrevious,I=null;if(O){if(g.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),I=(0,h.findFragmentByPDT)(x,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!I){var C=O.sn+1;if(C>=g.startSN&&C<=g.endSN){var M=x[C-g.startSN];O.cc===M.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(I=M).sn)}I||(I=(0,h.findFragWithCC)(x,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+I.sn)}}else{var U=this.hls.liveSyncPosition;null!==U&&(I=this.getFragmentAtPosition(U,this.bitrateTest?g.fragmentEnd:g.edge,g))}return I},s.getFragmentAtPosition=function(g,x,O){var W,I=this.config,C=this.fragPrevious,M=O.fragments,U=O.endSN,w=O.fragmentHint,K=I.maxFragLookUpTolerance,N=!!(I.lowLatencyMode&&O.partList&&w);if(N&&w&&!this.bitrateTest&&(M=M.concat(w),U=w.sn),W=g<x?(0,h.findFragmentByPTS)(C,M,g,g>x-K?0:K):M[M.length-1]){var V=W.sn-O.startSN;if(this.fragmentTracker.getState(W)===b.FragmentState.OK&&(C=W),C&&W.sn===C.sn&&!N&&C&&W.level===C.level){var j=M[V+1];W.sn<U&&this.fragmentTracker.getState(j)!==b.FragmentState.OK?(this.log("SN "+W.sn+" just loaded, load next one: "+j.sn),W=j):W=null}}return W},s.synchronizeToLiveEdge=function(g){var x=this.config,O=this.media;if(O){var I=this.hls.liveSyncPosition,C=O.currentTime,U=g.edge,w=C>=g.fragments[0].start-x.maxFragLookUpTolerance&&C<=U;null!==I&&O.duration>I&&(C<I||!w)&&(!w&&O.readyState<4||C<U-(void 0!==x.liveMaxLatencyDuration?x.liveMaxLatencyDuration:x.liveMaxLatencyDurationCount*g.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=I),O.readyState&&(this.warn("Playback: "+C.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+I.toFixed(3)),O.currentTime=I))}},s.alignPlaylists=function(g,x){var I=this.levelLastLoaded,C=this.fragPrevious,M=null!==I?this.levels[I]:null,U=g.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var w=g.fragments[0].start,K=!x,N=g.alignedSliding&&(0,F.isFiniteNumber)(w);if(K||!N&&!w){(0,_.alignStream)(C,M,g);var W=g.fragments[0].start;return this.log("Live playlist sliding: "+W.toFixed(2)+" start-sn: "+(x?x.startSN:"na")+"->"+g.startSN+" prev-sn: "+(C?C.sn:"na")+" fragments: "+U),W}return w},s.waitForCdnTuneIn=function(g){return g.live&&g.canBlockReload&&g.partTarget&&g.tuneInGoal>Math.max(g.partHoldBack,3*g.partTarget)},s.setStartPosition=function(g,x){var O=this.startPosition;if(O<x&&(O=-1),-1===O||-1===this.lastCurrentTime){var I=g.startTimeOffset;(0,F.isFiniteNumber)(I)?(O=x+I,I<0&&(O+=g.totalduration),O=Math.min(Math.max(x,O),x+g.totalduration),this.log("Start time offset "+I+" found in playlist, adjust startPosition to "+O),this.startPosition=O):g.live?O=this.hls.liveSyncPosition||x:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},s.getLoadPosition=function(){var g=this.media,x=0;return this.loadedmetadata&&g?x=g.currentTime:this.nextLoadPosition&&(x=this.nextLoadPosition),x},s.handleFragLoadAborted=function(g,x){this.transmuxer&&"initSegment"!==g.sn&&g.stats.aborted&&(this.warn("Fragment "+g.sn+(x?" part"+x.index:"")+" of level "+g.level+" was aborted"),this.resetFragmentLoading(g))},s.resetFragmentLoading=function(g){(!this.fragCurrent||!this.fragContextChanged(g)&&this.state!==v.FRAG_LOADING_WAITING_RETRY)&&(this.state=v.IDLE)},s.onFragmentOrKeyLoadError=function(g,x){if(x.fatal)return this.stopLoad(),void(this.state=v.ERROR);var O=this.config;if(x.chunkMeta){var I=this.getCurrentContext(x.chunkMeta);I&&(x.frag=I.frag,x.levelRetry=!0,this.fragLoadError=O.fragLoadingMaxRetry)}var C=x.frag;if(C&&C.type===g){var M=this.fragCurrent;if(console.assert(M&&C.sn===M.sn&&C.level===M.level&&C.urlId===M.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=O.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var U=Math.min(Math.pow(2,this.fragLoadError)*O.fragLoadingRetryDelay,O.fragLoadingMaxRetryTimeout);this.warn("Fragment "+C.sn+" of "+g+" "+C.level+" failed to load, retrying in "+U+"ms"),this.retryDate=self.performance.now()+U,this.fragLoadError++,this.state=v.FRAG_LOADING_WAITING_RETRY}else x.levelRetry?(g===o.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=v.IDLE):(k.logger.error(x.details+" reaches max retry, redispatch as fatal ..."),x.fatal=!0,this.hls.stopLoad(),this.state=v.ERROR)}},s.afterBufferFlushed=function(g,x,O){if(g){var I=R.BufferHelper.getBuffered(g);this.fragmentTracker.detectEvictedFragments(x,I,O),this.state===v.ENDED&&this.resetLoadingState()}},s.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=v.IDLE},s.resetStartWhenNotLoaded=function(g){if(!this.loadedmetadata){this.startFragRequested=!1;var x=this.levels?this.levels[g].details:null;null!=x&&x.live?(this.startPosition=-1,this.setStartPosition(x,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},s.updateLevelTiming=function(g,x,O,I){var C=this,M=O.details;console.assert(!!M,"level.details must be defined"),Object.keys(g.elementaryStreams).reduce(function(w,K){var N=g.elementaryStreams[K];if(N){var W=N.endPTS-N.startPTS;if(W<=0)return C.warn("Could not parse fragment "+g.sn+" "+K+" duration reliably ("+W+")"),w||!1;var G=I?0:(0,y.updateFragPTSDTS)(M,g,N.startPTS,N.endPTS,N.startDTS,N.endDTS);return C.hls.trigger(P.Events.LEVEL_PTS_UPDATED,{details:M,level:O,drift:G,type:K,frag:g,start:N.startPTS,end:N.endPTS}),!0}return w},!1)||(this.warn("Found no media in fragment "+g.sn+" of level "+O.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=v.PARSED,this.hls.trigger(P.Events.FRAG_PARSED,{frag:g,part:x})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function d(r,e,s){e&&n(r.prototype,e),s&&n(r,s),Object.defineProperty(r,"prototype",{writable:!1})}(e,[{key:"state",get:function(){return this._state},set:function(g){var x=this._state;x!==g&&(this._state=g,this.log(x+"->"+g))}}]),e}(A.default)},"./src/controller/buffer-controller.ts":
/*!*********************************************!*\
          !*** ./src/controller/buffer-controller.ts ***!
          \*********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>h});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),R=L(
/*! ../errors */
"./src/errors.ts"),k=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),P=L(
/*! ../utils/mediasource-helper */
"./src/utils/mediasource-helper.ts"),D=L(
/*! ../loader/fragment */
"./src/loader/fragment.ts"),S=L(
/*! ./buffer-operation-queue */
"./src/controller/buffer-operation-queue.ts"),T=(0,P.getMediaSource)(),_=/([ha]vc.)(?:\.[^.,]+)+/,h=function(){function y(l){var a=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var o=a.media,n=a.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),o&&(o.removeEventListener("emptied",a._onMediaEmptied),a.updateMediaElementDuration(),a.hls.trigger(A.Events.MEDIA_ATTACHED,{media:o})),n&&n.removeEventListener("sourceopen",a._onMediaSourceOpen),a.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var o=a.media,n=a._objectUrl;o&&o.src!==n&&b.logger.error("Media element src was set while attaching MediaSource ("+n+" > "+o.src+")")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var m=y.prototype;return m.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},m.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},m.registerListeners=function(){var a=this.hls;a.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(A.Events.BUFFER_RESET,this.onBufferReset,this),a.on(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.on(A.Events.BUFFER_EOS,this.onBufferEos,this),a.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.on(A.Events.FRAG_PARSED,this.onFragParsed,this),a.on(A.Events.FRAG_CHANGED,this.onFragChanged,this)},m.unregisterListeners=function(){var a=this.hls;a.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(A.Events.BUFFER_RESET,this.onBufferReset,this),a.off(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),a.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),a.off(A.Events.BUFFER_EOS,this.onBufferEos,this),a.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),a.off(A.Events.FRAG_PARSED,this.onFragParsed,this),a.off(A.Events.FRAG_CHANGED,this.onFragChanged,this)},m._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},m.onManifestParsed=function(a,o){var n=2;(o.audio&&!o.video||!o.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},m.onMediaAttaching=function(a,o){var n=this.media=o.media;if(n&&T){var d=this.mediaSource=new T;d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(d),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}},m.onMediaDetaching=function(){var a=this.media,o=this.mediaSource,n=this._objectUrl;if(o){if(b.logger.log("[buffer-controller]: media source detaching"),"open"===o.readyState)try{o.endOfStream()}catch(d){b.logger.warn("[buffer-controller]: onMediaDetaching: "+d.message+" while calling endOfStream")}this.onBufferReset(),o.removeEventListener("sourceopen",this._onMediaSourceOpen),o.removeEventListener("sourceended",this._onMediaSourceEnded),o.removeEventListener("sourceclose",this._onMediaSourceClose),a&&(a.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),a.src===n?(a.removeAttribute("src"),a.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(A.Events.MEDIA_DETACHED,void 0)},m.onBufferReset=function(){var a=this;this.getSourceBufferTypes().forEach(function(o){var n=a.sourceBuffer[o];try{n&&(a.removeBufferListeners(o),a.mediaSource&&a.mediaSource.removeSourceBuffer(n),a.sourceBuffer[o]=void 0)}catch(d){b.logger.warn("[buffer-controller]: Failed to reset the "+o+" buffer",d)}}),this._initSourceBuffer()},m.onBufferCodecs=function(a,o){var n=this,d=this.getSourceBufferTypes().length;Object.keys(o).forEach(function(c){if(d){var i=n.tracks[c];if(i&&"function"==typeof i.buffer.changeType){var u=o[c],E=u.id,f=u.codec,v=u.levelCodec,t=u.container,r=u.metadata,e=(i.levelCodec||i.codec).replace(_,"$1"),s=(v||f).replace(_,"$1");e!==s&&(n.appendChangeType(c,t+";codecs="+(v||f)),b.logger.log("[buffer-controller]: switching codec "+e+" to "+s),n.tracks[c]={buffer:i.buffer,codec:f,container:t,levelCodec:v,metadata:r,id:E})}}else n.pendingTracks[c]=o[c]}),!d&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},m.appendChangeType=function(a,o){var n=this,d=this.operationQueue,c={execute:function(){var u=n.sourceBuffer[a];u&&(b.logger.log("[buffer-controller]: changing "+a+" sourceBuffer type to "+o),u.changeType(o)),d.shiftAndExecuteNext(a)},onStart:function(){},onComplete:function(){},onError:function(u){b.logger.warn("[buffer-controller]: Failed to change "+a+" SourceBuffer type",u)}};d.append(c,a)},m.onBufferAppending=function(a,o){var n=this,d=this.hls,c=this.operationQueue,i=this.tracks,u=o.data,E=o.type,f=o.frag,v=o.part,t=o.chunkMeta,r=t.buffering[E],e=self.performance.now();r.start=e;var s=f.stats.buffering,p=v?v.stats.buffering:null;0===s.start&&(s.start=e),p&&0===p.start&&(p.start=e);var x=!1;"audio"===E&&"audio/mpeg"===i.audio?.container&&(x=!this.lastMpegAudioChunk||1===t.id||this.lastMpegAudioChunk.sn!==t.sn,this.lastMpegAudioChunk=t);var O=f.start;c.append({execute:function(){if(r.executeStart=self.performance.now(),x){var M=n.sourceBuffer[E];if(M){var U=O-M.timestampOffset;Math.abs(U)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+O+" (delta: "+U+") sn: "+f.sn+")"),M.timestampOffset=O)}}n.appendExecutor(u,E)},onStart:function(){},onComplete:function(){var M=self.performance.now();r.executeEnd=r.end=M,0===s.first&&(s.first=M),p&&0===p.first&&(p.first=M);var U=n.sourceBuffer,w={};for(var K in U)w[K]=k.BufferHelper.getBuffered(U[K]);n.appendError=0,n.hls.trigger(A.Events.BUFFER_APPENDED,{type:E,frag:f,part:v,chunkMeta:t,parent:f.type,timeRanges:w})},onError:function(M){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",M);var U={type:R.ErrorTypes.MEDIA_ERROR,parent:f.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:M,fatal:!1};M.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=R.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,U.details=R.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>d.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+d.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0,d.stopLoad())),d.trigger(A.Events.ERROR,U)}},E)},m.onBufferFlushing=function(a,o){var n=this,d=this.operationQueue,c=function(u){return{execute:n.removeExecutor.bind(n,u,o.startOffset,o.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(A.Events.BUFFER_FLUSHED,{type:u})},onError:function(f){b.logger.warn("[buffer-controller]: Failed to remove from "+u+" SourceBuffer",f)}}};o.type?d.append(c(o.type),o.type):this.getSourceBufferTypes().forEach(function(i){d.append(c(i),i)})},m.onFragParsed=function(a,o){var n=this,d=o.frag,c=o.part,i=[],u=c?c.elementaryStreams:d.elementaryStreams;u[D.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(u[D.ElementaryStreamTypes.AUDIO]&&i.push("audio"),u[D.ElementaryStreamTypes.VIDEO]&&i.push("video")),0===i.length&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+d.type+" level: "+d.level+" sn: "+d.sn),this.blockBuffers(function(){var v=self.performance.now();d.stats.buffering.end=v,c&&(c.stats.buffering.end=v),n.hls.trigger(A.Events.FRAG_BUFFERED,{frag:d,part:c,stats:c?c.stats:d.stats,id:d.type})},i)},m.onFragChanged=function(a,o){this.flushBackBuffer()},m.onBufferEos=function(a,o){var n=this;this.getSourceBufferTypes().reduce(function(c,i){var u=n.sourceBuffer[i];return u&&(!o.type||o.type===i)&&(u.ending=!0,u.ended||(u.ended=!0,b.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS"))),c&&!(u&&!u.ended)},!0)&&(b.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){n.getSourceBufferTypes().forEach(function(i){var u=n.sourceBuffer[i];u&&(u.ending=!1)});var c=n.mediaSource;c&&"open"===c.readyState?(b.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),c.endOfStream()):c&&b.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+c.readyState)}))},m.onLevelUpdated=function(a,o){var n=o.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},m.flushBackBuffer=function(){var a=this.hls,o=this.details,n=this.media,d=this.sourceBuffer;if(n&&null!==o){var c=this.getSourceBufferTypes();if(c.length){var i=o.live&&null!==a.config.liveBackBufferLength?a.config.liveBackBufferLength:a.config.backBufferLength;if((0,F.isFiniteNumber)(i)&&!(i<0)){var u=n.currentTime,E=o.levelTargetDuration,f=Math.max(i,E),v=Math.floor(u/E)*E-f;c.forEach(function(t){var r=d[t];if(r){var e=k.BufferHelper.getBuffered(r);if(e.length>0&&v>e.start(0)){if(a.trigger(A.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),o.live)a.trigger(A.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v});else if(r.ended&&e.end(e.length-1)-u<2*E)return void b.logger.info("[buffer-controller]: Cannot flush "+t+" back buffer while SourceBuffer is in ended state");a.trigger(A.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:t})}}})}}}},m.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var a=this.details,o=this.hls,d=this.mediaSource,c=a.fragments[0].start+a.totalduration,i=this.media.duration,u=(0,F.isFiniteNumber)(d.duration)?d.duration:0;a.live&&o.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),d.duration=1/0,this.updateSeekableRange(a)):(c>u&&c>i||!(0,F.isFiniteNumber)(i))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+c.toFixed(3)),d.duration=c)}},m.updateSeekableRange=function(a){var o=this.mediaSource,n=a.fragments;if(n.length&&a.live&&null!=o&&o.setLiveSeekableRange){var c=Math.max(0,n[0].start),i=Math.max(c,c+a.totalduration);o.setLiveSeekableRange(c,i)}},m.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,o=this.operationQueue,n=this.pendingTracks,d=Object.keys(n).length;if(d&&!a||2===d){this.createSourceBuffers(n),this.pendingTracks={};var c=this.getSourceBufferTypes();if(0===c.length)return void this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});c.forEach(function(i){o.executeNext(i)})}},m.createSourceBuffers=function(a){var o=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var d=0;for(var c in a)if(!o[c]){var i=a[c];if(!i)throw Error("source buffer exists for track "+c+", however track does not");var u=i.levelCodec||i.codec,E=i.container+";codecs="+u;b.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var f=o[c]=n.addSourceBuffer(E),v=c;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[c]={buffer:f,codec:u,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id},d++}catch(t){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:E})}}d&&this.hls.trigger(A.Events.BUFFER_CREATED,{tracks:this.tracks})},m._onSBUpdateStart=function(a){this.operationQueue.current(a).onStart()},m._onSBUpdateEnd=function(a){var o=this.operationQueue;o.current(a).onComplete(),o.shiftAndExecuteNext(a)},m._onSBUpdateError=function(a,o){b.logger.error("[buffer-controller]: "+a+" SourceBuffer error",o),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(a);n&&n.onError(o)},m.removeExecutor=function(a,o,n){var d=this.media,c=this.mediaSource,i=this.operationQueue,E=this.sourceBuffer[a];if(!d||!c||!E)return b.logger.warn("[buffer-controller]: Attempting to remove from the "+a+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(a);var f=(0,F.isFiniteNumber)(d.duration)?d.duration:1/0,v=(0,F.isFiniteNumber)(c.duration)?c.duration:1/0,t=Math.max(0,o),r=Math.min(n,f,v);r>t&&!E.ending?(E.ended=!1,b.logger.log("[buffer-controller]: Removing ["+t+","+r+"] from the "+a+" SourceBuffer"),console.assert(!E.updating,a+" sourceBuffer must not be updating"),E.remove(t,r)):i.shiftAndExecuteNext(a)},m.appendExecutor=function(a,o){var n=this.operationQueue,c=this.sourceBuffer[o];if(!c)return b.logger.warn("[buffer-controller]: Attempting to append to the "+o+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(o);c.ended=!1,console.assert(!c.updating,o+" sourceBuffer must not be updating"),c.appendBuffer(a)},m.blockBuffers=function(a,o){var n=this;if(void 0===o&&(o=this.getSourceBufferTypes()),!o.length)return b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(a);var d=this.operationQueue,c=o.map(function(i){return d.appendBlocker(i)});Promise.all(c).then(function(){a(),o.forEach(function(i){var u=n.sourceBuffer[i];(!u||!u.updating)&&d.shiftAndExecuteNext(i)})})},m.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},m.addBufferListener=function(a,o,n){var d=this.sourceBuffer[a];if(d){var c=n.bind(this,a);this.listeners[a].push({event:o,listener:c}),d.addEventListener(o,c)}},m.removeBufferListeners=function(a){var o=this.sourceBuffer[a];o&&this.listeners[a].forEach(function(n){o.removeEventListener(n.event,n.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":
/*!**************************************************!*\
          !*** ./src/controller/buffer-operation-queue.ts ***!
          \**************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>A});var F=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),A=function(){function b(k){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=k}var R=b.prototype;return R.append=function(P,D){var S=this.queues[D];S.push(P),1===S.length&&this.buffers[D]&&this.executeNext(D)},R.insertAbort=function(P,D){this.queues[D].unshift(P),this.executeNext(D)},R.appendBlocker=function(P){var D,S=new Promise(function(_){D=_});return this.append({execute:D,onStart:function(){},onComplete:function(){},onError:function(){}},P),S},R.executeNext=function(P){var T=this.buffers[P],_=this.queues[P];if(_.length){var h=_[0];try{h.execute()}catch(y){F.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(y),(!T||!T.updating)&&(_.shift(),this.executeNext(P))}}},R.shiftAndExecuteNext=function(P){this.queues[P].shift(),this.executeNext(P)},R.current=function(P){return this.queues[P][0]},b}()},"./src/controller/cap-level-controller.ts":
/*!************************************************!*\
          !*** ./src/controller/cap-level-controller.ts ***!
          \************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>D});var F=L(
/*! ../events */
"./src/events.ts");function A(S,T){for(var _=0;_<T.length;_++){var h=T[_];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,R(h.key),h)}}function R(S){var T=function k(S,T){if("object"!=typeof S||null===S)return S;var _=S[Symbol.toPrimitive];if(void 0!==_){var h=_.call(S,T||"default");if("object"!=typeof h)return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===T?String:Number)(S)}(S,"string");return"symbol"==typeof T?T:String(T)}const D=function(){function S(_){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=_,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var T=S.prototype;return T.setStreamController=function(h){this.streamController=h},T.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},T.registerListeners=function(){var h=this.hls;h.on(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),h.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.on(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},T.unregisterListener=function(){var h=this.hls;h.off(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),h.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.off(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},T.onFpsDropLevelCapping=function(h,y){S.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},T.onMediaAttaching=function(h,y){this.media=y.media instanceof HTMLVideoElement?y.media:null,this.clientRect=null},T.onManifestParsed=function(h,y){var m=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,m.config.capLevelToPlayerSize&&y.video&&this.startCapping()},T.onBufferCodecs=function(h,y){this.hls.config.capLevelToPlayerSize&&y.video&&this.startCapping()},T.onMediaDetaching=function(){this.stopCapping()},T.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var h=this.hls.levels;if(h.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(h.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},T.getMaxLevel=function(h){var y=this,m=this.hls.levels;if(!m.length)return-1;var l=m.filter(function(a,o){return S.isLevelAllowed(o,y.restrictedLevels)&&o<=h});return this.clientRect=null,S.getMaxLevelByMediaSize(l,this.mediaWidth,this.mediaHeight)},T.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},T.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},T.getDimensions=function(){if(this.clientRect)return this.clientRect;var h=this.media,y={width:0,height:0};if(h){var m=h.getBoundingClientRect();y.width=m.width,y.height=m.height,!y.width&&!y.height&&(y.width=m.right-m.left||h.width||0,y.height=m.bottom-m.top||h.height||0)}return this.clientRect=y,y},S.isLevelAllowed=function(h,y){return void 0===y&&(y=[]),-1===y.indexOf(h)},S.getMaxLevelByMediaSize=function(h,y,m){if(!h||!h.length)return-1;for(var a=h.length-1,o=0;o<h.length;o+=1){var n=h[o];if((n.width>=y||n.height>=m)&&(c=n,!(i=h[o+1])||c.width!==i.width||c.height!==i.height)){a=o;break}}var c,i;return a},function b(S,T,_){T&&A(S.prototype,T),_&&A(S,_),Object.defineProperty(S,"prototype",{writable:!1})}(S,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var h=1;if(!this.hls.config.ignoreDevicePixelRatio)try{h=self.devicePixelRatio}catch{}return h}}]),S}()},"./src/controller/cmcd-controller.ts":
/*!*******************************************!*\
          !*** ./src/controller/cmcd-controller.ts ***!
          \*******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>m});var F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../types/cmcd */
"./src/types/cmcd.ts"),b=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts");function k(l,a){for(var o=0;o<a.length;o++){var n=a[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(l,D(n.key),n)}}function P(l,a,o){return a&&k(l.prototype,a),o&&k(l,o),Object.defineProperty(l,"prototype",{writable:!1}),l}function D(l){var a=function S(l,a){if("object"!=typeof l||null===l)return l;var o=l[Symbol.toPrimitive];if(void 0!==o){var n=o.call(l,a||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(l)}(l,"string");return"symbol"==typeof a?a:String(a)}function T(l,a){var o=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(o)return(o=o.call(l)).next.bind(o);if(Array.isArray(l)||(o=function _(l,a){if(l){if("string"==typeof l)return h(l,a);var o=Object.prototype.toString.call(l).slice(8,-1);if("Object"===o&&l.constructor&&(o=l.constructor.name),"Map"===o||"Set"===o)return Array.from(l);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(l,a)}}(l))||a&&l&&"number"==typeof l.length){o&&(l=o);var n=0;return function(){return n>=l.length?{done:!0}:{done:!1,value:l[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(l,a){(null==a||a>l.length)&&(a=l.length);for(var o=0,n=new Array(a);o<a;o++)n[o]=l[o];return n}function y(){return y=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(l[n]=o[n])}return l},y.apply(this,arguments)}var m=function(){function l(o){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(i){try{n.apply(i,{ot:A.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(u){R.logger.warn("Could not generate manifest CMCD data.",u)}},this.applyFragmentData=function(i){try{var u=i.frag,E=n.hls.levels[u.level],f=n.getObjectType(u),v={d:1e3*u.duration,ot:f};(f===A.CMCDObjectType.VIDEO||f===A.CMCDObjectType.AUDIO||f==A.CMCDObjectType.MUXED)&&(v.br=E.bitrate/1e3,v.tb=n.getTopBandwidth(f)/1e3,v.bl=n.getBufferLength(f)),n.apply(i,v)}catch(t){R.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=o;var d=this.config=o.config,c=d.cmcd;null!=c&&(d.pLoader=this.createPlaylistLoader(),d.fLoader=this.createFragmentLoader(),this.sid=c.sessionId||l.uuid(),this.cid=c.contentId,this.useHeaders=!0===c.useHeaders,this.registerListeners())}var a=l.prototype;return a.registerListeners=function(){var n=this.hls;n.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this)},a.unregisterListeners=function(){var n=this.hls;n.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},a.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},a.onMediaAttached=function(n,d){this.media=d.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},a.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},a.onBufferCreated=function(n,d){var c,i;this.audioBuffer=null===(c=d.tracks.audio)||void 0===c?void 0:c.buffer,this.videoBuffer=null===(i=d.tracks.video)||void 0===i?void 0:i.buffer},a.createData=function(){var n;return{v:A.CMCDVersion,sf:A.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(n=this.media)||void 0===n?void 0:n.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},a.apply=function(n,d){if(void 0===d&&(d={}),y(d,this.createData()),this.starved&&(d.ot===A.CMCDObjectType.INIT||d.ot===A.CMCDObjectType.VIDEO||d.ot===A.CMCDObjectType.MUXED)&&(d.bs=!0,d.su=!0,this.starved=!1),null==d.su&&(d.su=this.buffering),this.useHeaders){var i=l.toHeaders(d);if(!Object.keys(i).length)return;n.headers||(n.headers={}),y(n.headers,i)}else{var u=l.toQuery(d);if(!u)return;n.url=l.appendQueryToUri(n.url,u)}},a.getObjectType=function(n){var d=n.type;return"subtitle"===d?A.CMCDObjectType.TIMED_TEXT:"initSegment"===n.sn?A.CMCDObjectType.INIT:"audio"===d?A.CMCDObjectType.AUDIO:"main"===d?this.hls.audioTracks.length?A.CMCDObjectType.VIDEO:A.CMCDObjectType.MUXED:void 0},a.getTopBandwidth=function(n){var c,d=0,i=this.hls;if(n===A.CMCDObjectType.AUDIO)c=i.audioTracks;else{var u=i.maxAutoLevel;c=i.levels.slice(0,u>-1?u+1:i.levels.length)}for(var v,f=T(c);!(v=f()).done;){var t=v.value;t.bitrate>d&&(d=t.bitrate)}return d>0?d:NaN},a.getBufferLength=function(n){var d=this.hls.media,c=n===A.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return c&&d?1e3*b.BufferHelper.bufferInfo(c,d.currentTime,this.config.maxBufferHole).len:NaN},a.createPlaylistLoader=function(){var d=this.applyPlaylistData,c=this.config.pLoader||this.config.loader;return function(){function i(E){this.loader=void 0,this.loader=new c(E)}var u=i.prototype;return u.destroy=function(){this.loader.destroy()},u.abort=function(){this.loader.abort()},u.load=function(f,v,t){d(f),this.loader.load(f,v,t)},P(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},a.createFragmentLoader=function(){var d=this.applyFragmentData,c=this.config.fLoader||this.config.loader;return function(){function i(E){this.loader=void 0,this.loader=new c(E)}var u=i.prototype;return u.destroy=function(){this.loader.destroy()},u.abort=function(){this.loader.abort()},u.load=function(f,v,t){d(f),this.loader.load(f,v,t)},P(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},l.uuid=function(){var n=URL.createObjectURL(new Blob),d=n.toString();return URL.revokeObjectURL(n),d.slice(d.lastIndexOf("/")+1)},l.serialize=function(n){for(var r,d=[],i=function(I){return Math.round(I)},u=function(I){return 100*i(I/100)},f={br:i,d:i,bl:u,dl:u,mtp:u,nor:function(I){return encodeURIComponent(I)},rtp:u,tb:i},t=T(Object.keys(n||{}).sort());!(r=t()).done;){var e=r.value,s=n[e];if(I=s,!(Number.isNaN(I)||null==I||""===I||!1===I||"v"===e&&1===s||"pr"==e&&1===s)){var p=f[e];p&&(s=p(s));var x,g=typeof s;x="ot"===e||"sf"===e||"st"===e?e+"="+s:"boolean"===g?e:"number"===g?e+"="+s:e+"="+JSON.stringify(s),d.push(x)}}var I;return d.join(",")},l.toHeaders=function(n){for(var c={},i=["Object","Request","Session","Status"],u=[{},{},{},{}],E={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},f=0,v=Object.keys(n);f<v.length;f++){var t=v[f];u[null!=E[t]?E[t]:1][t]=n[t]}for(var e=0;e<u.length;e++){var s=l.serialize(u[e]);s&&(c["CMCD-"+i[e]]=s)}return c},l.toQuery=function(n){return"CMCD="+encodeURIComponent(l.serialize(n))},l.appendQueryToUri=function(n,d){if(!d)return n;var c=n.includes("?")?"&":"?";return""+n+c+d},l}()},"./src/controller/eme-controller.ts":
/*!******************************************!*\
          !*** ./src/controller/eme-controller.ts ***!
          \******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>f});var F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../errors */
"./src/errors.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),R=L(
/*! ../utils/mediakeys-helper */
"./src/utils/mediakeys-helper.ts"),k=L(
/*! ../utils/keysystem-util */
"./src/utils/keysystem-util.ts"),P=L(
/*! ../utils/numeric-encoding-utils */
"./src/utils/numeric-encoding-utils.ts"),D=L(
/*! ../loader/level-key */
"./src/loader/level-key.ts"),S=L(
/*! ../utils/hex */
"./src/utils/hex.ts"),T=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),_=L(
/*! eventemitter3 */
"./node_modules/eventemitter3/index.js"),h=L.n(_);function m(v){var t="function"==typeof Map?new Map:void 0;return m=function(e){if(null===e||!function o(v){return-1!==Function.toString.call(v).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,s)}function s(){return l(e,arguments,d(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),n(s,e)},m(v)}function l(v,t,r){return(l=function a(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(s,p,g){var x=[null];x.push.apply(x,p);var I=new(Function.bind.apply(s,x));return g&&n(I,g.prototype),I}).apply(null,arguments)}function n(v,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e})(v,t)}function d(v){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)})(v)}var i="[eme]",u=function(){function v(r){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=v.CDMCleanupPromise?[v.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=b.logger.debug.bind(b.logger,i),this.log=b.logger.log.bind(b.logger,i),this.warn=b.logger.warn.bind(b.logger,i),this.error=b.logger.error.bind(b.logger,i),this.hls=r,this.config=r.config,this.registerListeners()}var t=v.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(F.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(F.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var s=this.config,g=s.widevineLicenseUrl,x=s.drmSystems[e];if(x)return x.licenseUrl;if(e===R.KeySystems.WIDEVINE&&g)return g;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var p=this.config.drmSystems[e];if(p)return p.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var s=this,p=this.hls.levels,g=function(C,M,U){return!!C&&U.indexOf(C)===M},x=p.map(function(I){return I.audioCodec}).filter(g),O=p.map(function(I){return I.videoCodec}).filter(g);return x.length+O.length===0&&O.push("avc1.42e01e"),new Promise(function(I,C){!function U(w){var K=w.shift();s.getMediaKeysPromise(K,x,O).then(function(N){return I({keySystem:K,mediaKeys:N})}).catch(function(N){w.length?U(w):C(N instanceof E?N:new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:N,fatal:!0},N.message))})}(e)})},t.requestMediaKeySystemAccess=function(e,s){var p=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof p){var g="Configured requestMediaKeySystemAccess is not a function "+p;return null===R.requestMediaKeySystemAccess&&"http:"===self.location.protocol&&(g="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(g))}return p(e,s)},t.getMediaKeysPromise=function(e,s,p){var g=this,x=(0,R.getSupportedMediaKeySystemConfigurations)(e,s,p,this.config.drmSystemOptions),O=this.keySystemAccessPromises[e],I=O?.keySystemAccess;if(!I){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(x)),I=this.requestMediaKeySystemAccess(e,x);var C=this.keySystemAccessPromises[e]={keySystemAccess:I};return I.catch(function(M){g.log('Failed to obtain access to key-system "'+e+'": '+M)}),I.then(function(M){g.log('Access for key-system "'+M.keySystem+'" obtained');var U=g.fetchServerCertificate(e);return g.log('Create media-keys for "'+e+'"'),C.mediaKeys=M.createMediaKeys().then(function(w){return g.log('Media-keys created for "'+e+'"'),U.then(function(K){return K?g.setMediaKeysServerCertificate(w,e,K):w})}),C.mediaKeys.catch(function(w){g.error('Failed to create media-keys for "'+e+'"}: '+w)}),C.mediaKeys})}return I.then(function(){return O.mediaKeys})},t.createMediaKeySessionContext=function(e){var s=e.decryptdata,p=e.keySystem,g=e.mediaKeys;console.assert(!!g,"mediaKeys is defined"),this.log('Creating key-system session "'+p+'" keyId: '+S.default.hexDump(s.keyId||[]));var x=g.createSession(),O={decryptdata:s,keySystem:p,mediaKeys:g,mediaKeysSession:x,keyStatus:"status-pending"};return this.mediaKeySessions.push(O),O},t.renewKeySession=function(e){var s=e.decryptdata;if(s.pssh){var p=this.createMediaKeySessionContext(e),g=this.getKeyIdString(s);this.keyIdToKeySessionPromise[g]=this.generateRequestWithPreferredKeySession(p,"cenc",s.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return S.default.hexDump(e.keyId)},t.updateKeySession=function(e,s){var p,g=e.mediaKeysSession;return this.log('Updating key-session "'+g.sessionId+'" for keyID '+S.default.hexDump((null===(p=e.decryptdata)||void 0===p?void 0:p.keyId)||[])+"\n      } (data length: "+(s&&s.byteLength)+")"),g.update(s)},t.selectKeySystemFormat=function(e){var s=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+s.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(s)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var s=this;return new Promise(function(p,g){var x=(0,R.getKeySystemsForConfig)(s.config),O=e.map(R.keySystemFormatToKeySystemDomain).filter(function(I){return!!I&&-1!==x.indexOf(I)});return s.getKeySystemSelectionPromise(O).then(function(I){var C=I.keySystem,M=(0,R.keySystemDomainToKeySystemFormat)(C);M?p(M):g(new Error('Unable to find format for key-system "'+C+'"'))}).catch(g)})},t.loadKey=function(e){var s=this,p=e.keyInfo.decryptdata,g=this.getKeyIdString(p),x="(keyId: "+g+' format: "'+p.keyFormat+'" method: '+p.method+" uri: "+p.uri+")";this.log("Starting session for key "+x);var O=this.keyIdToKeySessionPromise[g];return O||(O=this.keyIdToKeySessionPromise[g]=this.getKeySystemForKeyPromise(p).then(function(I){var C=I.keySystem,M=I.mediaKeys;return s.throwIfDestroyed(),s.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+x),s.attemptSetMediaKeys(C,M).then(function(){s.throwIfDestroyed();var U=s.createMediaKeySessionContext({keySystem:C,mediaKeys:M,decryptdata:p});return s.generateRequestWithPreferredKeySession(U,"cenc",p.pssh,"playlist-key")})})).catch(function(I){return s.handleError(I)}),O},t.throwIfDestroyed=function(e){if(void 0===e&&(e="Invalid state"),!this.hls)throw new Error("invalid state")},t.handleError=function(e){this.hls&&(this.error(e.message),this.hls.trigger(F.Events.ERROR,e instanceof E?e.data:{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var s=this.getKeyIdString(e),p=this.keyIdToKeySessionPromise[s];if(!p){var g=(0,R.keySystemFormatToKeySystemDomain)(e.keyFormat),x=g?[g]:(0,R.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(x)}return p},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,R.getKeySystemsForConfig)(this.config)),0===e.length)throw new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var s=this,p=e.initDataType,g=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+p+'"'),null!==g){var x,O;if("sinf"===p&&this.config.drmSystems[R.KeySystems.FAIRPLAY]){var I=(0,T.bin2str)(new Uint8Array(g));try{var C=(0,P.base64Decode)(JSON.parse(I).sinf),M=(0,T.parseSinf)(new Uint8Array(C));if(!M)return;x=M.subarray(8,24),O=R.KeySystems.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var U=(0,T.parsePssh)(g);if(null===U)return;0===U.version&&U.systemId===R.KeySystemIds.WIDEVINE&&U.data&&(x=U.data.subarray(8,24)),O=(0,R.keySystemIdToKeySystemDomain)(U.systemId)}if(O&&x){for(var w=S.default.hexDump(x),K=this.keyIdToKeySessionPromise,N=this.mediaKeySessions,W=K[w],G=function(X){var Z=N[X],Q=Z.decryptdata;if(Q.pssh||!Q.keyId)return"continue";var z=S.default.hexDump(Q.keyId);return w===z||-1!==Q.uri.replace(/-/g,"").indexOf(w)?(W=K[z],delete K[z],Q.pssh=new Uint8Array(g),Q.keyId=x,W=K[w]=W.then(function(){return s.generateRequestWithPreferredKeySession(Z,p,g,"encrypted-event-key-match")}),"break"):void 0},V=0;V<N.length;V++){var H=G(V);if("continue"!==H&&"break"===H)break}W||(W=K[w]=this.getKeySystemSelectionPromise([O]).then(function(j){var X,Z=j.keySystem,Q=j.mediaKeys;s.throwIfDestroyed();var z=new D.LevelKey("ISO-23001-7",w,null!=(X=(0,R.keySystemDomainToKeySystemFormat)(Z))?X:"");return z.pssh=new Uint8Array(g),z.keyId=x,s.attemptSetMediaKeys(Z,Q).then(function(){s.throwIfDestroyed();var $=s.createMediaKeySessionContext({decryptdata:z,keySystem:Z,mediaKeys:Q});return s.generateRequestWithPreferredKeySession($,p,g,"encrypted-event-no-match")})})),W.catch(function(j){return s.handleError(j)})}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,s){var p=this,g=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var x=Promise.all(g).then(function(){if(!p.media)throw new Error("Attempted to set mediaKeys without media element attached");return p.media.setMediaKeys(s)});return this.setMediaKeysQueue.push(x),x.then(function(){p.log('Media-keys set for "'+e+'"'),g.push(x),p.setMediaKeysQueue=p.setMediaKeysQueue.filter(function(O){return-1===g.indexOf(O)})})},t.generateRequestWithPreferredKeySession=function(e,s,p,g){var x,O,I=this,C=null===(x=this.config.drmSystems)||void 0===x||null===(O=x[e.keySystem])||void 0===O?void 0:O.generateRequest;if(C)try{var M=C.call(this.hls,s,p,e);if(!M)throw new Error("Invalid response from configured generateRequest filter");s=M.initDataType,p=e.decryptdata.pssh=M.initData?new Uint8Array(M.initData):null}catch(W){var U;if(this.warn(W.message),null!==(U=this.hls)&&void 0!==U&&U.config.debug)throw W}if(null===p)return this.log('Skipping key-session request for "'+g+'" (no initData)'),Promise.resolve(e);var w=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+g+'": '+w+" (init data type: "+s+" length: "+(p?p.byteLength:null)+")");var K=new(h());e.mediaKeysSession.onmessage=function(W){var G=e.mediaKeysSession;if(G){var V=W.messageType,H=W.message;I.log('"'+V+'" message event for session "'+G.sessionId+'" message size: '+H.byteLength),"license-request"===V||"license-renewal"===V?I.renewLicense(e,H).catch(function(j){I.handleError(j),K.emit("error",j)}):"license-release"===V?e.keySystem===R.KeySystems.FAIRPLAY&&(I.updateKeySession(e,(0,k.strToUtf8array)("acknowledged")),I.removeSession(e)):I.warn('unhandled media key message type "'+V+'"')}else K.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(W){if(e.mediaKeysSession){I.onKeyStatusChange(e);var V=e.keyStatus;K.emit("keyStatus",V),"expired"===V&&(I.warn(e.keySystem+" expired for key "+w),I.renewKeySession(e))}else K.emit("error",new Error("invalid state"))};var N=new Promise(function(W,G){K.on("error",G),K.on("keyStatus",function(V){V.startsWith("usable")?W():"output-restricted"===V?G(new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===V?G(new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+V+'"')):"expired"===V?G(new Error("key expired while generating request")):I.warn('unhandled key status change "'+V+'"')})});return e.mediaKeysSession.generateRequest(s,p).then(function(){var W;I.log('Request generated for key-session "'+(null===(W=e.mediaKeysSession)||void 0===W?void 0:W.sessionId)+'" keyId: '+w)}).catch(function(W){throw new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:W,fatal:!1},"Error generating key-session request: "+W)}).then(function(){return N}).catch(function(W){throw K.removeAllListeners(),I.removeSession(e),W}).then(function(){return K.removeAllListeners(),e})},t.onKeyStatusChange=function(e){var s=this;e.mediaKeysSession.keyStatuses.forEach(function(p,g){s.log('key status change "'+p+'" for keyStatuses keyId: '+S.default.hexDump("buffer"in g?new Uint8Array(g.buffer,g.byteOffset,g.byteLength):new Uint8Array(g))+" session keyId: "+S.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=p})},t.fetchServerCertificate=function(e){var s=this;return new Promise(function(p,g){var x=s.getServerCertificateUrl(e);if(!x)return p();s.log('Fetching serverCertificate for "'+e+'"');var O=new XMLHttpRequest;O.open("GET",x,!0),O.responseType="arraybuffer",O.onreadystatechange=function(){O.readyState===XMLHttpRequest.DONE&&(200===O.status?p(O.response):g(new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:O},'"'+e+'" certificate request XHR failed ('+x+"). Status: "+O.status+" ("+O.statusText+")")))},O.send()})},t.setMediaKeysServerCertificate=function(e,s,p){var g=this;return new Promise(function(x,O){e.setServerCertificate(p).then(function(I){g.log("setServerCertificate "+(I?"success":"not supported by CDM")+" ("+p?.byteLength+') on "'+s+'"'),x(e)}).catch(function(I){O(new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:I,fatal:!0},I.message))})})},t.renewLicense=function(e,s){var p=this;return this.requestLicense(e,new Uint8Array(s)).then(function(g){return p.updateKeySession(e,new Uint8Array(g)).catch(function(x){throw new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:x,fatal:!0},x.message)})})},t.setupLicenseXHR=function(e,s,p,g){var x=this,O=this.config.licenseXhrSetup;return O?Promise.resolve().then(function(){if(!p.decryptdata)throw new Error("Key removed");return O.call(x.hls,e,s,p,g)}).catch(function(I){if(!p.decryptdata)throw I;return e.open("POST",s,!0),O.call(x.hls,e,s,p,g)}).then(function(I){return e.readyState||e.open("POST",s,!0),{xhr:e,licenseChallenge:I||g}}):(e.open("POST",s,!0),Promise.resolve({xhr:e,licenseChallenge:g}))},t.requestLicense=function(e,s){var p=this;return new Promise(function(g,x){var O=p.getLicenseServerUrl(e.keySystem);p.log("Sending license request to URL: "+O);var I=new XMLHttpRequest;I.responseType="arraybuffer",I.onreadystatechange=function(){if(!p.hls||!e.mediaKeysSession)return x(new Error("invalid state"));if(4===I.readyState)if(200===I.status){p._requestLicenseFailureCount=0;var C=I.response;p.log("License received "+(C instanceof ArrayBuffer?C.byteLength:C));var M=p.config.licenseResponseCallback;if(M)try{C=M.call(p.hls,I,O,e)}catch(w){p.error(w)}g(C)}else p._requestLicenseFailureCount++,p._requestLicenseFailureCount>3||I.status>=400&&I.status<500?x(new E({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:I},"License Request XHR failed ("+O+"). Status: "+I.status+" ("+I.statusText+")")):(p.warn("Retrying license request, "+(3-p._requestLicenseFailureCount+1)+" attempts left"),p.requestLicense(e,s).then(g,x))},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=I,p.setupLicenseXHR(I,O,e,s).then(function(C){C.xhr.send(C.licenseChallenge)})})},t.onMediaAttached=function(e,s){if(this.config.emeEnabled){var p=s.media;this.media=p,p.addEventListener("encrypted",this.onMediaEncrypted),p.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var e=this,s=this.media,p=this.mediaKeySessions;s&&(s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},D.LevelKey.clearKeyUriToKeyIdMap();var g=p.length;v.CDMCleanupPromise=Promise.all(p.map(function(x){return e.removeSession(x)}).concat(s?.setMediaKeys(null).catch(function(x){e.log("Could not clear media keys: "+x+". media.src: "+s?.src)}))).then(function(){g&&(e.log("finished closing key sessions and clearing media keys"),p.length=0)}).catch(function(x){e.log("Could not close sessions and clear media keys: "+x+". media.src: "+s?.src)})},t.onManifestLoaded=function(e,s){var p=s.sessionKeys;if(p&&this.config.emeEnabled&&!this.keyFormatPromise){var g=p.reduce(function(x,O){return-1===x.indexOf(O.keyFormat)&&x.push(O.keyFormat),x},[]);this.log("Selecting key-system from session-keys "+g.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(g)}},t.removeSession=function(e){var s=this,p=e.mediaKeysSession,g=e.licenseXhr;if(p){this.log("Remove licenses and keys and close session "+p.sessionId),p.onmessage=null,p.onkeystatuseschange=null,g&&g.readyState!==XMLHttpRequest.DONE&&g.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var x=this.mediaKeySessions.indexOf(e);return x>-1&&this.mediaKeySessions.splice(x,1),p.remove().catch(function(O){s.log("Could not remove session: "+O)}).then(function(){return p.close()}).catch(function(O){s.log("Could not close session: "+O)})}},v}();u.CDMCleanupPromise=void 0;var E=function(v){function t(r,e){var s;return(s=v.call(this,e)||this).data=void 0,s.data=r,r.err=r.error,s}return function y(v,t){v.prototype=Object.create(t.prototype),v.prototype.constructor=v,n(v,t)}(t,v),t}(m(Error));const f=u},"./src/controller/fps-controller.ts":
/*!******************************************!*\
          !*** ./src/controller/fps-controller.ts ***!
          \******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>R});var F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../utils/logger */
"./src/utils/logger.ts");const R=function(){function k(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var P=k.prototype;return P.setStreamController=function(S){this.streamController=S},P.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},P.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching)},P.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},P.onMediaAttaching=function(S,T){var _=this.hls.config;if(_.capLevelOnFPSDrop){var h=T.media instanceof self.HTMLVideoElement?T.media:null;this.media=h,h&&"function"==typeof h.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),_.fpsDroppedMonitoringPeriod)}},P.checkFPS=function(S,T,_){var h=performance.now();if(T){if(this.lastTime){var m=_-this.lastDroppedFrames,l=T-this.lastDecodedFrames,a=1e3*m/(h-this.lastTime),o=this.hls;if(o.trigger(F.Events.FPS_DROP,{currentDropped:m,currentDecoded:l,totalDroppedFrames:_}),a>0&&m>o.config.fpsDroppedMonitoringThreshold*l){var n=o.currentLevel;A.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+n),n>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=n)&&(o.trigger(F.Events.FPS_DROP_LEVEL_CAPPING,{level:n-=1,droppedLevel:o.currentLevel}),o.autoLevelCapping=n,this.streamController.nextLevelSwitch())}}this.lastTime=h,this.lastDroppedFrames=_,this.lastDecodedFrames=T}},P.checkFPSInterval=function(){var S=this.media;if(S)if(this.isVideoPlaybackQualityAvailable){var T=S.getVideoPlaybackQuality();this.checkFPS(S,T.totalVideoFrames,T.droppedVideoFrames)}else this.checkFPS(S,S.webkitDecodedFrameCount,S.webkitDroppedFrameCount)},k}()},"./src/controller/fragment-finders.ts":
/*!********************************************!*\
          !*** ./src/controller/fragment-finders.ts ***!
          \********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{findFragWithCC:()=>D,findFragmentByPDT:()=>b,findFragmentByPTS:()=>R,fragmentWithinToleranceTest:()=>k,pdtWithinToleranceTest:()=>P});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../utils/binary-search */
"./src/utils/binary-search.ts");function b(S,T,_){if(null===T||!Array.isArray(S)||!S.length||!(0,F.isFiniteNumber)(T))return null;if(T<(S[0].programDateTime||0))return null;if(T>=(S[S.length-1].endProgramDateTime||0))return null;_=_||0;for(var m=0;m<S.length;++m){var l=S[m];if(P(T,_,l))return l}return null}function R(S,T,_,h){void 0===_&&(_=0),void 0===h&&(h=0);var y=null;if(S?y=T[S.sn-T[0].sn+1]||null:0===_&&0===T[0].start&&(y=T[0]),y&&0===k(_,h,y))return y;var m=A.default.search(T,k.bind(null,_,h));return!m||m===S&&y?y:m}function k(S,T,_){if(void 0===S&&(S=0),void 0===T&&(T=0),_.start<=S&&_.start+_.duration>S)return 0;var h=Math.min(T,_.duration+(_.deltaPTS?_.deltaPTS:0));return _.start+_.duration-h<=S?1:_.start-h>S&&_.start?-1:0}function P(S,T,_){var h=1e3*Math.min(T,_.duration+(_.deltaPTS?_.deltaPTS:0));return(_.endProgramDateTime||0)-h>S}function D(S,T){return A.default.search(S,function(_){return _.cc<T?1:_.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":
/*!********************************************!*\
          !*** ./src/controller/fragment-tracker.ts ***!
          \********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{FragmentState:()=>b,FragmentTracker:()=>R});var b,D,F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../types/loader */
"./src/types/loader.ts");(D=b||(b={})).NOT_LOADED="NOT_LOADED",D.APPENDING="APPENDING",D.PARTIAL="PARTIAL",D.OK="OK";var R=function(){function D(T){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=T,this._registerListeners()}var S=D.prototype;return S._registerListeners=function(){var _=this.hls;_.on(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),_.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),_.on(F.Events.FRAG_LOADED,this.onFragLoaded,this)},S._unregisterListeners=function(){var _=this.hls;_.off(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),_.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),_.off(F.Events.FRAG_LOADED,this.onFragLoaded,this)},S.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},S.getAppendedFrag=function(_,h){if(h===A.PlaylistLevelType.MAIN){var y=this.activeFragment,m=this.activeParts;if(!y)return null;if(m)for(var l=m.length;l--;){var a=m[l],o=a?a.end:y.appendedPTS;if(a.start<=_&&void 0!==o&&_<=o)return l>9&&(this.activeParts=m.slice(l-9)),a}else if(y.start<=_&&void 0!==y.appendedPTS&&_<=y.appendedPTS)return y}return this.getBufferedFrag(_,h)},S.getBufferedFrag=function(_,h){for(var y=this.fragments,m=Object.keys(y),l=m.length;l--;){var a=y[m[l]];if(a?.body.type===h&&a.buffered){var o=a.body;if(o.start<=_&&_<=o.end)return o}}return null},S.detectEvictedFragments=function(_,h,y){var m=this;this.timeRanges&&(this.timeRanges[_]=h),Object.keys(this.fragments).forEach(function(l){var a=m.fragments[l];if(a){if(!a.buffered&&!a.loaded)return void(a.body.type===y&&m.removeFragment(a.body));var o=a.range[_];o&&o.time.some(function(n){var d=!m.isTimeBuffered(n.startPTS,n.endPTS,h);return d&&m.removeFragment(a.body),d})}})},S.detectPartialFragments=function(_){var h=this,y=this.timeRanges,m=_.frag,l=_.part;if(y&&"initSegment"!==m.sn){var a=P(m),o=this.fragments[a];o&&(Object.keys(y).forEach(function(n){var d=m.elementaryStreams[n];d&&(o.range[n]=h.getBufferedTimes(m,l,null!==l||!0===d.partial,y[n]))}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,o.body.endList&&(this.endListFragments[o.body.type]=o)):this.removeFragment(o.body))}},S.fragBuffered=function(_){var h=P(_),y=this.fragments[h];y&&(y.loaded=null,y.buffered=!0)},S.getBufferedTimes=function(_,h,y,m){for(var l={time:[],partial:y},a=h?h.start:_.start,o=h?h.end:_.end,n=_.minEndPTS||o,d=_.maxStartPTS||a,c=0;c<m.length;c++){var i=m.start(c)-this.bufferPadding,u=m.end(c)+this.bufferPadding;if(d>=i&&n<=u){l.time.push({startPTS:Math.max(a,m.start(c)),endPTS:Math.min(o,m.end(c))});break}if(a<u&&o>i)l.partial=!0,l.time.push({startPTS:Math.max(a,m.start(c)),endPTS:Math.min(o,m.end(c))});else if(o<=i)break}return l},S.getPartialFragment=function(_){var y,m,l,h=null,a=0,o=this.bufferPadding,n=this.fragments;return Object.keys(n).forEach(function(d){var c=n[d];c&&k(c)&&(l=c.body.end+o,_>=(m=c.body.start-o)&&_<=l&&(y=Math.min(_-m,l-_),a<=y&&(h=c.body,a=y)))}),h},S.isEndListAppended=function(_){var h=this.endListFragments[_];return void 0!==h&&(h.buffered||k(h))},S.getState=function(_){var h=P(_),y=this.fragments[h];return y?y.buffered?k(y)?b.PARTIAL:b.OK:b.APPENDING:b.NOT_LOADED},S.isTimeBuffered=function(_,h,y){for(var m,l,a=0;a<y.length;a++){if(m=y.start(a)-this.bufferPadding,l=y.end(a)+this.bufferPadding,_>=m&&h<=l)return!0;if(h<=m)return!1}return!1},S.onFragLoaded=function(_,h){var y=h.frag;if("initSegment"!==y.sn&&!y.bitrateTest&&!h.part){var l=P(y);this.fragments[l]={body:y,loaded:h,buffered:!1,range:Object.create(null)}}},S.onBufferAppended=function(_,h){var y=this,m=h.frag,l=h.part,a=h.timeRanges;if(m.type===A.PlaylistLevelType.MAIN)if(this.activeFragment!==m&&(this.activeFragment=m,m.appendedPTS=void 0),l){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(l)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach(function(n){var d=a[n];if(y.detectEvictedFragments(n,d),!l&&m.type===A.PlaylistLevelType.MAIN){var c=m.elementaryStreams[n];if(!c)return;for(var i=0;i<d.length;i++){var u=d.end(i);m.appendedPTS=u<=c.endPTS&&u>c.startPTS?Math.max(u,m.appendedPTS||0):c.endPTS}}})},S.onFragBuffered=function(_,h){this.detectPartialFragments(h)},S.hasFragment=function(_){var h=P(_);return!!this.fragments[h]},S.removeFragmentsInRange=function(_,h,y){var m=this;Object.keys(this.fragments).forEach(function(l){var a=m.fragments[l];if(a&&a.buffered){var o=a.body;o.type===y&&o.start<h&&o.end>_&&m.removeFragment(o)}})},S.removeFragment=function(_){var h=P(_);_.stats.loaded=0,_.clearElementaryStreamInfo(),_.appendedPTS=void 0,delete this.fragments[h],_.endList&&delete this.endListFragments[_.type]},S.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},D}();function k(D){var S,T;return D.buffered&&((null===(S=D.range.video)||void 0===S?void 0:S.partial)||(null===(T=D.range.audio)||void 0===T?void 0:T.partial))}function P(D){return D.type+"_"+D.level+"_"+D.urlId+"_"+D.sn}},"./src/controller/gap-controller.ts":
/*!******************************************!*\
          !*** ./src/controller/gap-controller.ts ***!
          \******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{MAX_START_GAP_JUMP:()=>P,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>D,SKIP_BUFFER_RANGE_START:()=>S,STALL_MINIMUM_DURATION_MS:()=>k,default:()=>T});var F=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),A=L(
/*! ../errors */
"./src/errors.ts"),b=L(
/*! ../events */
"./src/events.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),k=250,P=2,D=.1,S=.05,T=function(){function _(y,m,l,a){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=m,this.fragmentTracker=l,this.hls=a}var h=_.prototype;return h.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},h.poll=function(m,l){var a=this.config,o=this.media,n=this.stalled;if(null!==o){var d=o.currentTime,c=o.seeking,i=this.seeking&&!c,u=!this.seeking&&c;if(this.seeking=c,d!==m){if(this.moved=!0,null!==n){if(this.stallReported){var E=self.performance.now()-n;R.logger.warn("playback not stuck anymore @"+d+", after "+Math.round(E)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((u||i)&&(this.stalled=null),!(o.paused&&!c||o.ended||0===o.playbackRate)&&F.BufferHelper.getBuffered(o).length){var f=F.BufferHelper.bufferInfo(o,d,0),t=f.nextStart||0;if(f.len>0||t){if(c){var r=f.len>P,e=!t||l&&l.start<=d||t-d>P&&!this.fragmentTracker.getPartialFragment(d);if(r||e)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var s,p=Math.max(t,f.start||0)-d,g=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,x=null==g||null===(s=g.details)||void 0===s?void 0:s.live;if(p>0&&p<=(x?2*g.details.targetduration:P))return void this._trySkipBufferHole(null)}var I=self.performance.now();if(null===n)return void(this.stalled=I);var C=I-n;if(c||!(C>=k)||(this._reportStall(f),this.media)){var M=F.BufferHelper.bufferInfo(o,d,a.maxBufferHole);this._tryFixBufferStall(M,C)}}}}},h._tryFixBufferStall=function(m,l){var a=this.config,n=this.media;if(null!==n){var c=this.fragmentTracker.getPartialFragment(n.currentTime);if(c&&(this._trySkipBufferHole(c)||!this.media))return;m.len>a.maxBufferHole&&l>1e3*a.highBufferWatchdogPeriod&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},h._reportStall=function(m){var l=this.hls,a=this.media;!this.stallReported&&a&&(this.stallReported=!0,R.logger.warn("Playback stalling at @"+a.currentTime+" due to low buffer ("+JSON.stringify(m)+")"),l.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m.len}))},h._trySkipBufferHole=function(m){var l=this.config,a=this.hls,o=this.media;if(null===o)return 0;for(var n=o.currentTime,d=0,c=F.BufferHelper.getBuffered(o),i=0;i<c.length;i++){var u=c.start(i);if(n+l.maxBufferHole>=d&&n<u){var E=Math.max(u+S,o.currentTime+D);return R.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+E),this.moved=!0,this.stalled=null,o.currentTime=E,m&&a.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+E,frag:m}),E}d=c.end(i)}return 0},h._tryNudgeBuffer=function(){var m=this.config,l=this.hls,a=this.media,o=this.nudgeRetry;if(null!==a){var n=a.currentTime;if(this.nudgeRetry++,o<m.nudgeMaxRetry){var d=n+(o+1)*m.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+n+" to "+d),a.currentTime=d,l.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+m.nudgeMaxRetry+" nudges"),l.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},_}()},"./src/controller/id3-track-controller.ts":
/*!************************************************!*\
          !*** ./src/controller/id3-track-controller.ts ***!
          \************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>m});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../utils/texttrack-utils */
"./src/utils/texttrack-utils.ts"),R=L(
/*! ../demux/id3 */
"./src/demux/id3.ts"),k=L(
/*! ../loader/date-range */
"./src/loader/date-range.ts"),P=L(
/*! ../types/demuxer */
"./src/types/demuxer.ts");function S(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var T=function(){var l=S();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function _(l,a){return l.getTime()/1e3-a}function h(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}const m=function(){function l(o){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=o,this._registerListeners()}var a=l.prototype;return a.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},a._registerListeners=function(){var n=this.hls;n.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},a._unregisterListeners=function(){var n=this.hls;n.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},a.onMediaAttached=function(n,d){this.media=d.media},a.onMediaDetaching=function(){this.id3Track&&((0,b.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},a.onManifestLoading=function(){this.dateRangeCuesAppended={}},a.createTrack=function(n){var d=this.getID3Track(n.textTracks);return d.mode="hidden",d},a.getID3Track=function(n){if(this.media){for(var d=0;d<n.length;d++){var c=n[d];if("metadata"===c.kind&&"id3"===c.label)return(0,b.sendAddTrackEvent)(c,this.media),c}return this.media.addTextTrack("metadata","id3")}},a.onFragParsingMetadata=function(n,d){if(this.media){var c=this.hls.config,i=c.enableEmsgMetadataCues,u=c.enableID3MetadataCues;if(i||u){var E=d.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var f=S(),v=0;v<E.length;v++){var t=E[v].type;if((t!==P.MetadataSchema.emsg||i)&&u){var r=R.getID3Frames(E[v].data);if(r){var e=E[v].pts,s=e+E[v].duration;s>T&&(s=T),s-e<=0&&(s=e+.25);for(var g=0;g<r.length;g++){var x=r[g];if(!R.isTimeStampFrame(x)){this.updateId3CueEnds(e);var O=new f(e,s,"");O.value=x,t&&(O.type=t),this.id3Track.addCue(O)}}}}}}}},a.updateId3CueEnds=function(n){var d,c=null===(d=this.id3Track)||void 0===d?void 0:d.cues;if(c)for(var i=c.length;i--;){var u=c[i];u.startTime<n&&u.endTime===T&&(u.endTime=n)}},a.onBufferFlushing=function(n,d){var u=d.type,E=this.id3Track,f=this.hls;if(f){var v=f.config,t=v.enableEmsgMetadataCues,r=v.enableID3MetadataCues;E&&(t||r)&&(0,b.removeCuesInRange)(E,d.startOffset,d.endOffset,"audio"===u?function(p){return p.type===P.MetadataSchema.audioId3&&r}:"video"===u?function(p){return p.type===P.MetadataSchema.emsg&&t}:function(p){return p.type===P.MetadataSchema.audioId3&&r||p.type===P.MetadataSchema.emsg&&t})}},a.onLevelUpdated=function(n,d){var c=this,i=d.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var u=this.dateRangeCuesAppended,E=this.id3Track,f=i.dateRanges,v=Object.keys(f);if(E)for(var t=Object.keys(u).filter(function(I){return!v.includes(I)}),r=function(C){var M=t[C];Object.keys(u[M].cues).forEach(function(U){E.removeCue(u[M].cues[U])}),delete u[M]},e=t.length;e--;)r(e);var s=i.fragments[i.fragments.length-1];if(0!==v.length&&(0,F.isFiniteNumber)(s?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var p=s.programDateTime/1e3-s.start,g=S(),x=function(C){var M=v[C],U=f[M],w=u[M],K=w?.cues||{},N=w?.durationKnown||!1,W=_(U.startDate,p),G=T,V=U.endDate;if(V)G=_(V,p),N=!0;else if(U.endOnNext&&!N){var H=v.reduce(function($,J){var q=f[J];return q.class===U.class&&q.id!==J&&q.startDate>U.startDate&&$.push(q),$},[]).sort(function($,J){return $.startDate.getTime()-J.startDate.getTime()})[0];H&&(G=_(H.startDate,p),N=!0)}for(var j=Object.keys(U.attr),X=0;X<j.length;X++){var Z=j[X];if(Z!==k.DateRangeAttribute.ID&&Z!==k.DateRangeAttribute.CLASS&&Z!==k.DateRangeAttribute.START_DATE&&Z!==k.DateRangeAttribute.DURATION&&Z!==k.DateRangeAttribute.END_DATE&&Z!==k.DateRangeAttribute.END_ON_NEXT){var Q=K[Z];if(Q)N&&!w.durationKnown&&(Q.endTime=G);else{var z=U.attr[Z];Q=new g(W,G,""),(Z===k.DateRangeAttribute.SCTE35_OUT||Z===k.DateRangeAttribute.SCTE35_IN)&&(z=h(z)),Q.value={key:Z,data:z},Q.type=P.MetadataSchema.dateRange,c.id3Track.addCue(Q),K[Z]=Q}}}u[M]={cues:K,dateRange:U,durationKnown:N}},O=0;O<v.length;O++)x(O)}}},l}()},"./src/controller/latency-controller.ts":
/*!**********************************************!*\
          !*** ./src/controller/latency-controller.ts ***!
          \**********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>S});var F=L(
/*! ../errors */
"./src/errors.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts");function R(T,_){for(var h=0;h<_.length;h++){var y=_[h];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(T,P(y.key),y)}}function P(T){var _=function D(T,_){if("object"!=typeof T||null===T)return T;var h=T[Symbol.toPrimitive];if(void 0!==h){var y=h.call(T,_||"default");if("object"!=typeof y)return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===_?String:Number)(T)}(T,"string");return"symbol"==typeof _?_:String(_)}var S=function(){function T(h){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=h,this.config=h.config,this.registerListeners()}var _=T.prototype;return _.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},_.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(A.Events.ERROR,this.onError,this)},_.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(A.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(A.Events.ERROR,this.onError)},_.onMediaAttached=function(y,m){this.media=m.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},_.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},_.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},_.onLevelUpdated=function(y,m){var l=m.details;this.levelDetails=l,l.advanced&&this.timeupdate(),!l.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},_.onError=function(y,m){m.details===F.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},_.timeupdate=function(){var y=this.media,m=this.levelDetails;if(y&&m){this.currentTime=y.currentTime;var l=this.computeLatency();if(null!==l){this._latency=l;var a=this.config,n=a.maxLiveSyncPlaybackRate;if(a.lowLatencyMode&&1!==n){var d=this.targetLatency;if(null!==d){var c=l-d,i=Math.min(this.maxLatency,d+m.targetduration);if(m.live&&c<i&&c>.05&&this.forwardBufferLength>1){var E=Math.min(2,Math.max(1,n)),f=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;y.playbackRate=Math.min(E,Math.max(1,f))}else 1!==y.playbackRate&&0!==y.playbackRate&&(y.playbackRate=1)}}}}},_.estimateLiveEdge=function(){var y=this.levelDetails;return null===y?null:y.edge+y.age},_.computeLatency=function(){var y=this.estimateLiveEdge();return null===y?null:y-this.currentTime},function k(T,_,h){_&&R(T.prototype,_),h&&R(T,h),Object.defineProperty(T,"prototype",{writable:!1})}(T,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,m=this.levelDetails;return void 0!==y.liveMaxLatencyDuration?y.liveMaxLatencyDuration:m?y.liveMaxLatencyDurationCount*m.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(null===y)return null;var a=y.targetduration,o=this.config,n=o.liveSyncDuration,i=this.hls.userConfig,u=o.lowLatencyMode&&y.partHoldBack||y.holdBack;return(i.liveSyncDuration||i.liveSyncDurationCount||0===u)&&(u=void 0!==n?n:o.liveSyncDurationCount*a),u+Math.min(1*this.stallCount,a)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),m=this.targetLatency,l=this.levelDetails;if(null===y||null===m||null===l)return null;var a=l.edge,d=a-(this.config.lowLatencyMode&&l.partTarget||l.targetduration);return Math.min(Math.max(a-l.totalduration,y-m-this.edgeStalled),d)}},{key:"drift",get:function(){var y=this.levelDetails;return null===y?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;return null===y?0:Math.max(y.age-3*(this.config.lowLatencyMode&&y.partTarget||y.targetduration),0)}},{key:"forwardBufferLength",get:function(){var y=this.media,m=this.levelDetails;if(!y||!m)return 0;var l=y.buffered.length;return(l?y.buffered.end(l-1):m.edge)-this.currentTime}}]),T}()},"./src/controller/level-controller.ts":
/*!********************************************!*\
          !*** ./src/controller/level-controller.ts ***!
          \********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>o});var F=L(
/*! ../types/level */
"./src/types/level.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../errors */
"./src/errors.ts"),R=L(
/*! ../utils/codecs */
"./src/utils/codecs.ts"),k=L(
/*! ./level-helper */
"./src/controller/level-helper.ts"),P=L(
/*! ./base-playlist-controller */
"./src/controller/base-playlist-controller.ts"),D=L(
/*! ../types/loader */
"./src/types/loader.ts");function S(){return S=Object.assign?Object.assign.bind():function(n){for(var d=1;d<arguments.length;d++){var c=arguments[d];for(var i in c)Object.prototype.hasOwnProperty.call(c,i)&&(n[i]=c[i])}return n},S.apply(this,arguments)}function T(n,d){for(var c=0;c<d.length;c++){var i=d[c];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,h(i.key),i)}}function h(n){var d=function y(n,d){if("object"!=typeof n||null===n)return n;var c=n[Symbol.toPrimitive];if(void 0!==c){var i=c.call(n,d||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===d?String:Number)(n)}(n,"string");return"symbol"==typeof d?d:String(d)}function l(n,d){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,u){return i.__proto__=u,i})(n,d)}var a=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),o=function(n){function d(i){var u;return(u=n.call(this,i,"[level-controller]")||this)._levels=[],u._firstLevel=-1,u._startLevel=void 0,u.currentLevelIndex=-1,u.manualLevelIndex=-1,u.onParsedComplete=void 0,u._registerListeners(),u}!function m(n,d){n.prototype=Object.create(d.prototype),n.prototype.constructor=n,l(n,d)}(d,n);var c=d.prototype;return c._registerListeners=function(){var u=this.hls;u.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(A.Events.ERROR,this.onError,this)},c._unregisterListeners=function(){var u=this.hls;u.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(A.Events.ERROR,this.onError,this)},c.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,n.prototype.destroy.call(this)},c.startLoad=function(){this._levels.forEach(function(E){E.loadError=0}),n.prototype.startLoad.call(this)},c.onManifestLoaded=function(u,E){var r,s,f=[],v=[],t=[],e={},p=!1,g=!1,x=!1;if(E.levels.forEach(function(M){var U=M.attrs;p=p||!(!M.width||!M.height),g=g||!!M.videoCodec,x=x||!!M.audioCodec,a&&M.audioCodec&&-1!==M.audioCodec.indexOf("mp4a.40.34")&&(M.audioCodec=void 0);var w=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(s=e[w])?s.url.push(M.url):(s=new F.Level(M),e[w]=s,f.push(s)),U&&(U.AUDIO&&(0,k.addGroupId)(s,"audio",U.AUDIO),U.SUBTITLES&&(0,k.addGroupId)(s,"text",U.SUBTITLES))}),(p||g)&&x&&(f=f.filter(function(M){return!!M.videoCodec||!(!M.width||!M.height)})),f=f.filter(function(M){var U=M.audioCodec,w=M.videoCodec;return(!U||(0,R.isCodecSupportedInMp4)(U,"audio"))&&(!w||(0,R.isCodecSupportedInMp4)(w,"video"))}),E.audioTracks&&(v=E.audioTracks.filter(function(M){return!M.audioCodec||(0,R.isCodecSupportedInMp4)(M.audioCodec,"audio")}),(0,k.assignTrackIdsByGroup)(v)),E.subtitles&&(0,k.assignTrackIdsByGroup)(t=E.subtitles),f.length>0){r=f[0].bitrate,f.sort(function(M,U){return M.attrs["HDCP-LEVEL"]!==U.attrs["HDCP-LEVEL"]?(M.attrs["HDCP-LEVEL"]||"")>(U.attrs["HDCP-LEVEL"]||"")?1:-1:M.bitrate!==U.bitrate?M.bitrate-U.bitrate:M.attrs.SCORE!==U.attrs.SCORE?M.attrs.decimalFloatingPoint("SCORE")-U.attrs.decimalFloatingPoint("SCORE"):p&&M.height!==U.height?M.height-U.height:0}),this._levels=f;for(var O=0;O<f.length;O++)if(f[O].bitrate===r){this._firstLevel=O,this.log("manifest loaded, "+f.length+" level(s) found, first bitrate: "+r);break}var C={levels:f,audioTracks:v,subtitleTracks:t,sessionData:E.sessionData,sessionKeys:E.sessionKeys,firstLevel:this._firstLevel,stats:E.stats,audio:x,video:g,altAudio:!(x&&!g)&&v.some(function(M){return!!M.url})};this.hls.trigger(A.Events.MANIFEST_PARSED,C),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:E.url,reason:"no level with compatible codecs found in manifest"})},c.onError=function(u,E){var f,v;if(n.prototype.onError.call(this,u,E),!E.fatal){var t=E.context,r=this._levels[this.currentLevelIndex];if(t&&(t.type===D.PlaylistContextType.AUDIO_TRACK&&r.audioGroupIds&&t.groupId===r.audioGroupIds[r.urlId]||t.type===D.PlaylistContextType.SUBTITLE_TRACK&&r.textGroupIds&&t.groupId===r.textGroupIds[r.urlId]))return void this.redundantFailover(this.currentLevelIndex);var p,e=!1,s=!0;switch(E.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(E.frag){var g=E.frag.type===D.PlaylistLevelType.MAIN?E.frag.level:this.currentLevelIndex,x=this._levels[g];x?(x.fragmentError++,x.fragmentError>this.hls.config.fragLoadingMaxRetry&&(p=g)):p=g}break;case b.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var O=r.attrs["HDCP-LEVEL"];O&&(this.hls.maxHdcpLevel=F.HdcpLevels[F.HdcpLevels.indexOf(O)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case b.ErrorDetails.FRAG_PARSING_ERROR:case b.ErrorDetails.KEY_SYSTEM_NO_SESSION:p=(null===(f=E.frag)||void 0===f?void 0:f.type)===D.PlaylistLevelType.MAIN?E.frag.level:this.currentLevelIndex,E.levelRetry=!1;break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:t&&(t.deliveryDirectives&&(s=!1),p=t.level),e=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:p=null!=(v=E.level)?v:this.currentLevelIndex,e=!0}void 0!==p&&this.recoverLevel(E,p,e,s)}},c.recoverLevel=function(u,E,f,v){var t=u.details,r=this._levels[E];if(r.loadError++,f){if(!this.retryLoadingOrFail(u))return void(this.currentLevelIndex=-1);u.levelRetry=!0}if(v){var s=r.url.length;if(s>1&&r.loadError<s)u.levelRetry=!0,this.redundantFailover(E);else if(-1===this.manualLevelIndex){for(var p=-1,g=this._levels,x=g.length;x--;){var O=(x+this.currentLevelIndex)%g.length;if(O!==this.currentLevelIndex&&0===g[O].loadError){p=O;break}}p>-1&&this.currentLevelIndex!==p?(this.warn(t+": switch to "+p),u.levelRetry=!0,this.hls.nextAutoLevel=p):!1===u.levelRetry&&(u.fatal=!0)}}},c.redundantFailover=function(u){var E=this._levels[u],f=E.url.length;if(f>1){var v=(E.urlId+1)%f;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(t){t.urlId=v}),this.level=u}},c.onFragLoaded=function(u,E){var f=E.frag;if(void 0!==f&&f.type===D.PlaylistLevelType.MAIN){var v=this._levels[f.level];void 0!==v&&(v.fragmentError=0,v.loadError=0)}},c.onLevelLoaded=function(u,E){var f,e,v=E.level,t=E.details,r=this._levels[v];if(!r)return this.warn("Invalid level index "+v),void(null!==(e=E.deliveryDirectives)&&void 0!==e&&e.skip&&(t.deltaUpdateFailed=!0));v===this.currentLevelIndex?(0===r.fragmentError&&(r.loadError=0,this.retryCount=0),this.playlistLoaded(v,E,r.details)):null!==(f=E.deliveryDirectives)&&void 0!==f&&f.skip&&(t.deltaUpdateFailed=!0)},c.onAudioTrackSwitched=function(u,E){var f=this.hls.levels[this.currentLevelIndex];if(f&&f.audioGroupIds){for(var v=-1,t=this.hls.audioTracks[E.id].groupId,r=0;r<f.audioGroupIds.length;r++)if(f.audioGroupIds[r]===t){v=r;break}v!==f.urlId&&(f.urlId=v,this.startLoad())}},c.loadPlaylist=function(u){n.prototype.loadPlaylist.call(this);var E=this.currentLevelIndex,f=this._levels[E];if(this.canLoad&&f&&f.url.length>0){var v=f.urlId,t=f.url[v];if(u)try{t=u.addDirectives(t)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Attempt loading level index "+E+(void 0!==u?.msn?" at sn "+u.msn+" part "+u.part:"")+" with URL-id "+v+" "+t),this.clearTimer(),this.hls.trigger(A.Events.LEVEL_LOADING,{url:t,level:E,id:v,deliveryDirectives:u||null})}},c.removeLevel=function(u,E){var f=function(r,e){return e!==E},v=this._levels.filter(function(t,r){return r!==u||t.url.length>1&&void 0!==E&&(t.url=t.url.filter(f),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(f)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(f)),t.urlId=0,!0)}).map(function(t,r){var e=t.details;return null!=e&&e.fragments&&e.fragments.forEach(function(s){s.level=r}),t});this._levels=v,this.hls.trigger(A.Events.LEVELS_UPDATED,{levels:v})},function _(n,d,c){d&&T(n.prototype,d),c&&T(n,c),Object.defineProperty(n,"prototype",{writable:!1})}(d,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(u){var E,f=this._levels;if(0!==f.length&&(this.currentLevelIndex!==u||null===(E=f[u])||void 0===E||!E.details)){if(u<0||u>=f.length){var v=u<0;if(this.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:u,fatal:v,reason:"invalid level idx"}),v)return;u=Math.min(u,f.length-1)}this.clearTimer();var t=this.currentLevelIndex,r=f[t],e=f[u];this.log("switching to level "+u+" from "+t),this.currentLevelIndex=u;var s=S({},e,{level:u,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete s._urlId,this.hls.trigger(A.Events.LEVEL_SWITCHING,s);var p=e.details;if(!p||p.live){var g=this.switchParams(e.uri,r?.details);this.loadPlaylist(g)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(u){this.manualLevelIndex=u,void 0===this._startLevel&&(this._startLevel=u),-1!==u&&(this.level=u)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(u){this._firstLevel=u}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var u=this.hls.config.startLevel;return void 0!==u?u:this._firstLevel}return this._startLevel},set:function(u){this._startLevel=u}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(u){this.level=u,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=u)}}]),d}(P.default)},"./src/controller/level-helper.ts":
/*!****************************************!*\
          !*** ./src/controller/level-helper.ts ***!
          \****************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{addGroupId:()=>k,addSliding:()=>a,adjustSliding:()=>l,assignTrackIdsByGroup:()=>P,computeReloadInterval:()=>o,getFragmentWithSN:()=>n,getPartWith:()=>d,mapFragmentIntersection:()=>m,mapPartIntersection:()=>y,mergeDetails:()=>_,updateFragPTSDTS:()=>T,updatePTS:()=>D});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),b=L(
/*! ../loader/date-range */
"./src/loader/date-range.ts");function R(){return R=Object.assign?Object.assign.bind():function(c){for(var i=1;i<arguments.length;i++){var u=arguments[i];for(var E in u)Object.prototype.hasOwnProperty.call(u,E)&&(c[E]=u[E])}return c},R.apply(this,arguments)}function k(c,i,u){switch(i){case"audio":c.audioGroupIds||(c.audioGroupIds=[]),c.audioGroupIds.push(u);break;case"text":c.textGroupIds||(c.textGroupIds=[]),c.textGroupIds.push(u)}}function P(c){var i={};c.forEach(function(u){var E=u.groupId||"";u.id=i[E]=i[E]||0,i[E]++})}function D(c,i,u){S(c[i],c[u])}function S(c,i){var u=i.startPTS;if((0,F.isFiniteNumber)(u)){var f,E=0;i.sn>c.sn?(E=u-c.start,f=c):(E=c.start-u,f=i),f.duration!==E&&(f.duration=E)}else i.start=i.sn>c.sn?c.cc===i.cc&&c.minEndPTS?c.start+(c.minEndPTS-c.start):c.start+c.duration:Math.max(c.start-i.duration,0)}function T(c,i,u,E,f,v){E-u<=0&&(A.logger.warn("Fragment should have a positive duration",i),E=u+i.duration,v=f+i.duration);var r=u,e=E,s=i.startPTS,p=i.endPTS;if((0,F.isFiniteNumber)(s)){var g=Math.abs(s-u);i.deltaPTS=(0,F.isFiniteNumber)(i.deltaPTS)?Math.max(g,i.deltaPTS):g,r=Math.max(u,s),u=Math.min(u,s),f=Math.min(f,i.startDTS),e=Math.min(E,p),E=Math.max(E,p),v=Math.max(v,i.endDTS)}i.duration=E-u;var x=u-i.start;i.start=i.startPTS=u,i.maxStartPTS=r,i.startDTS=f,i.endPTS=E,i.minEndPTS=e,i.endDTS=v;var O=i.sn;if(!c||O<c.startSN||O>c.endSN)return 0;var I,C=O-c.startSN,M=c.fragments;for(M[C]=i,I=C;I>0;I--)S(M[I],M[I-1]);for(I=C;I<M.length-1;I++)S(M[I],M[I+1]);return c.fragmentHint&&S(M[M.length-1],c.fragmentHint),c.PTSKnown=c.alignedSliding=!0,x}function _(c,i){for(var u=null,E=c.fragments,f=E.length-1;f>=0;f--){var v=E[f].initSegment;if(v){u=v;break}}c.fragmentHint&&delete c.fragmentHint.endPTS;var r,t=0;if(m(c,i,function(I,C){I.relurl&&(t=I.cc-C.cc),(0,F.isFiniteNumber)(I.startPTS)&&(0,F.isFiniteNumber)(I.endPTS)&&(C.start=C.startPTS=I.startPTS,C.startDTS=I.startDTS,C.appendedPTS=I.appendedPTS,C.maxStartPTS=I.maxStartPTS,C.endPTS=I.endPTS,C.endDTS=I.endDTS,C.minEndPTS=I.minEndPTS,C.duration=I.endPTS-I.startPTS,C.duration&&(r=C),i.PTSKnown=i.alignedSliding=!0),C.elementaryStreams=I.elementaryStreams,C.loader=I.loader,C.stats=I.stats,C.urlId=I.urlId,I.initSegment&&(C.initSegment=I.initSegment,u=I.initSegment)}),u&&(i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments).forEach(function(I){var C;(!I.initSegment||I.initSegment.relurl===(null===(C=u)||void 0===C?void 0:C.relurl))&&(I.initSegment=u)}),i.skippedSegments)if(i.deltaUpdateFailed=i.fragments.some(function(I){return!I}),i.deltaUpdateFailed){A.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var s=i.skippedSegments;s--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}else i.canSkipDateRanges&&(i.dateRanges=function h(c,i,u){var E=R({},c);return u&&u.forEach(function(f){delete E[f]}),Object.keys(i).forEach(function(f){var v=new b.DateRange(i[f].attr,E[f]);v.isValid?E[f]=v:A.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(i[f].attr)+'"')}),E}(c.dateRanges,i.dateRanges,i.recentlyRemovedDateranges));var p=i.fragments;if(t){A.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<p.length;g++)p[g].cc+=t}i.skippedSegments&&(i.startCC=i.fragments[0].cc),y(c.partList,i.partList,function(I,C){C.elementaryStreams=I.elementaryStreams,C.stats=I.stats}),r?T(i,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):l(c,i),p.length&&(i.totalduration=i.edge-p[0].start),i.driftStartTime=c.driftStartTime,i.driftStart=c.driftStart;var x=i.advancedDateTime;if(i.advanced&&x){var O=i.edge;i.driftStart||(i.driftStartTime=x,i.driftStart=O),i.driftEndTime=x,i.driftEnd=O}else i.driftEndTime=c.driftEndTime,i.driftEnd=c.driftEnd,i.advancedDateTime=c.advancedDateTime}function y(c,i,u){if(c&&i)for(var E=0,f=0,v=c.length;f<=v;f++){var t=c[f],r=i[f+E];t&&r&&t.index===r.index&&t.fragment.sn===r.fragment.sn?u(t,r):E--}}function m(c,i,u){for(var E=i.skippedSegments,f=Math.max(c.startSN,i.startSN)-i.startSN,v=(c.fragmentHint?1:0)+(E?i.endSN:Math.min(c.endSN,i.endSN))-i.startSN,t=i.startSN-c.startSN,r=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,e=c.fragmentHint?c.fragments.concat(c.fragmentHint):c.fragments,s=f;s<=v;s++){var p=e[t+s],g=r[s];E&&!g&&s<E&&(g=i.fragments[s]=p),p&&g&&u(p,g)}}function l(c,i){var u=i.startSN+i.skippedSegments-c.startSN,E=c.fragments;u<0||u>=E.length||a(i,E[u].start)}function a(c,i){if(i){for(var u=c.fragments,E=c.skippedSegments;E<u.length;E++)u[E].start+=i;c.fragmentHint&&(c.fragmentHint.start+=i)}}function o(c,i){void 0===i&&(i=1/0);var u=1e3*c.targetduration;if(c.updated){var E=c.fragments;if(E.length&&4*u>i){var v=1e3*E[E.length-1].duration;v<u&&(u=v)}}else u/=2;return Math.round(u)}function n(c,i,u){if(!c||!c.details)return null;var E=c.details,f=E.fragments[i-E.startSN];return f||(f=E.fragmentHint)&&f.sn===i?f:i<E.startSN&&u&&u.sn===i?u:null}function d(c,i,u){if(!c||!c.details)return null;var E=c.details.partList;if(E)for(var f=E.length;f--;){var v=E[f];if(v.index===u&&v.fragment.sn===i)return v}return null}},"./src/controller/stream-controller.ts":
/*!*********************************************!*\
          !*** ./src/controller/stream-controller.ts ***!
          \*********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>i});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ./base-stream-controller */
"./src/controller/base-stream-controller.ts"),b=L(
/*! ../is-supported */
"./src/is-supported.ts"),R=L(
/*! ../events */
"./src/events.ts"),k=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),P=L(
/*! ./fragment-tracker */
"./src/controller/fragment-tracker.ts"),D=L(
/*! ../types/loader */
"./src/types/loader.ts"),S=L(
/*! ../loader/fragment */
"./src/loader/fragment.ts"),T=L(
/*! ../demux/transmuxer-interface */
"./src/demux/transmuxer-interface.ts"),_=L(
/*! ../types/transmuxer */
"./src/types/transmuxer.ts"),h=L(
/*! ./gap-controller */
"./src/controller/gap-controller.ts"),y=L(
/*! ../errors */
"./src/errors.ts");function m(u,E){for(var f=0;f<E.length;f++){var v=E[f];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(u,a(v.key),v)}}function a(u){var E=function o(u,E){if("object"!=typeof u||null===u)return u;var f=u[Symbol.toPrimitive];if(void 0!==f){var v=f.call(u,E||"default");if("object"!=typeof v)return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===E?String:Number)(u)}(u,"string");return"symbol"==typeof E?E:String(E)}function d(u,E){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,t){return v.__proto__=t,v})(u,E)}var i=function(u){function E(v,t,r){var e;return(e=u.call(this,v,t,r,"[stream-controller]")||this).audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}!function n(u,E){u.prototype=Object.create(E.prototype),u.prototype.constructor=u,d(u,E)}(E,u);var f=E.prototype;return f._registerListeners=function(){var t=this.hls;t.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(R.Events.ERROR,this.onError,this),t.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var t=this.hls;t.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(R.Events.ERROR,this.onError,this),t.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},f.startLoad=function(t){if(this.levels){var r=this.lastCurrentTime,e=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var s=e.startLevel;-1===s&&(e.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=e.nextAutoLevel),this.level=e.nextLoadLevel=s,this.loadedmetadata=!1}r>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=A.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=A.State.STOPPED},f.stopLoad=function(){this._forceStartLoad=!1,u.prototype.stopLoad.call(this)},f.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_LEVEL:var t,r=this.levels,s=null==r||null===(t=r[this.level])||void 0===t?void 0:t.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=A.State.IDLE;break}break;case A.State.FRAG_LOADING_WAITING_RETRY:var p,g=self.performance.now(),x=this.retryDate;(!x||g>=x||null!==(p=this.media)&&void 0!==p&&p.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=A.State.IDLE)}this.onTickEnd()},f.onTickEnd=function(){u.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},f.doTickIdle=function(){var t=this.hls,e=this.levels,g=t.nextLoadLevel;if(null!==this.levelLastLoaded&&(this.media||!this.startFragRequested&&t.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&e&&e[g]){var x=e[g],O=this.getMainFwdBufferInfo();if(null!==O){var I=this.getLevelDetails();if(I&&this._streamEnded(O,I)){var C={};return this.altAudio&&(C.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,C),void(this.state=A.State.ENDED)}this.level=t.nextLoadLevel=g;var M=x.details;if(!M||this.state===A.State.WAITING_LEVEL||M.live&&this.levelLastLoaded!==g)return this.level=g,void(this.state=A.State.WAITING_LEVEL);if(!(O.len>=this.getMaxBufferLength(x.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>O.end&&(this.backtrackFragment=null);var K=this.backtrackFragment?this.backtrackFragment.start:O.end,N=this.getNextFragment(K,M);if(this.couldBacktrack&&!this.fragPrevious&&N&&"initSegment"!==N.sn&&this.fragmentTracker.getState(N)!==P.FragmentState.OK){var W,G=(null!=(W=this.backtrackFragment)?W:N).sn,H=M.fragments[G-M.startSN-1];H&&N.cc===H.cc&&(N=H,this.fragmentTracker.removeFragment(H))}else this.backtrackFragment&&O.len&&(this.backtrackFragment=null);if(N&&this.fragmentTracker.getState(N)===P.FragmentState.OK&&this.nextLoadPosition>K){var j=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO,X=(j===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;X&&this.afterBufferFlushed(X,j,D.PlaylistLevelType.MAIN),N=this.getNextFragment(this.nextLoadPosition,M)}N&&(N.initSegment&&!N.initSegment.data&&!this.bitrateTest&&(N=N.initSegment),this.loadFragment(N,M,K))}}}},f.loadFragment=function(t,r,e){var s,p=this.fragmentTracker.getState(t);this.fragCurrent=t,p===P.FragmentState.NOT_LOADED?"initSegment"===t.sn?this._loadInitSegment(t,r):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):(this.startFragRequested=!0,u.prototype.loadFragment.call(this,t,r,e)):p===P.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(s=this.media)||void 0===s?void 0:s.buffered.length)&&this.fragmentTracker.removeAllFragments()},f.getAppendedFrag=function(t){var r=this.fragmentTracker.getAppendedFrag(t,D.PlaylistLevelType.MAIN);return r&&"fragment"in r?r.fragment:r},f.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,D.PlaylistLevelType.MAIN)},f.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},f.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},f.nextLevelSwitch=function(){var t=this.levels,r=this.media;if(null!=r&&r.readyState){var e,s=this.getAppendedFrag(r.currentTime);if(s&&s.start>1&&this.flushMainBuffer(0,s.start-1),!r.paused&&t){var x=this.fragLastKbps;e=x&&this.fragCurrent?this.fragCurrent.duration*t[this.hls.nextLoadLevel].maxBitrate/(1e3*x)+1:0}else e=0;var O=this.getBufferedFrag(r.currentTime+e);if(O){var I=this.followingBufferedFrag(O);if(I){this.abortCurrentFrag();var M=I.duration,U=Math.max(O.end,(I.maxStartPTS?I.maxStartPTS:I.start)+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,.5*M),.75*M));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},f.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case A.State.KEY_LOADING:case A.State.FRAG_LOADING:case A.State.FRAG_LOADING_WAITING_RETRY:case A.State.PARSING:case A.State.PARSED:this.state=A.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},f.flushMainBuffer=function(t,r){u.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},f.onMediaAttached=function(t,r){u.prototype.onMediaAttached.call(this,t,r);var e=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new h.default(this.config,e,this.fragmentTracker,this.hls)},f.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),u.prototype.onMediaDetaching.call(this)},f.onMediaPlaying=function(){this.tick()},f.onMediaSeeked=function(){var t=this.media,r=t?t.currentTime:null;(0,F.isFiniteNumber)(r)&&this.log("Media seeked to "+r.toFixed(3)),this.tick()},f.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},f.onManifestParsed=function(t,r){var p,e=!1,s=!1;r.levels.forEach(function(g){(p=g.audioCodec)&&(-1!==p.indexOf("mp4a.40.2")&&(e=!0),-1!==p.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=e&&s&&!(0,b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},f.onLevelLoading=function(t,r){var e=this.levels;if(e&&this.state===A.State.IDLE){var s=e[r.level];(!s.details||s.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(s.details))&&(this.state=A.State.WAITING_LEVEL)}},f.onLevelLoaded=function(t,r){var e,s=this.levels,p=r.level,g=r.details;if(s){this.log("Level "+p+" loaded ["+g.startSN+","+g.endSN+"], cc ["+g.startCC+", "+g.endCC+"] duration:"+g.totalduration);var O=this.fragCurrent;O&&(this.state===A.State.FRAG_LOADING||this.state===A.State.FRAG_LOADING_WAITING_RETRY)&&O.level!==r.level&&O.loader&&(this.state=A.State.IDLE,this.backtrackFragment=null,O.abortRequests());var I=s[p],C=0;if(g.live||null!==(e=I.details)&&void 0!==e&&e.live){if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed)return;C=this.alignPlaylists(g,I.details)}if(I.details=g,this.levelLastLoaded=p,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:g,level:p}),this.state===A.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(g))return;this.state=A.State.IDLE}this.startFragRequested?g.live&&this.synchronizeToLiveEdge(g):this.setStartPosition(g,C),this.tick()}else this.warn("Levels were reset while loading level "+p)},f._handleFragmentLoadProgress=function(t){var r,e=t.frag,s=t.part,p=t.payload,g=this.levels;if(g){var x=g[e.level],O=x.details;if(O){var I=x.videoCodec,C=O.PTSKnown||!O.live,M=null===(r=e.initSegment)||void 0===r?void 0:r.data,U=this._getAudioCodec(x),w=this.transmuxer=this.transmuxer||new T.default(this.hls,D.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=s?s.index:-1,W=new _.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,p.byteLength,K,-1!==K);w.push(p,M,U,I,e,s,O.totalduration,C,W,this.initPTS[e.cc])}else this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered")},f.onAudioTrackSwitching=function(t,r){var e=this.altAudio,p=r.id;if(!r.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var g=this.fragCurrent;g&&(this.log("Switching to main audio track, cancel main fragment load"),g.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var x=this.hls;e&&x.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),x.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:p})}},f.onAudioTrackSwitched=function(t,r){var s=!!this.hls.audioTracks[r.id].url;if(s){var p=this.videoBuffer;p&&this.mediaBuffer!==p&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=p)}this.altAudio=s,this.tick()},f.onBufferCreated=function(t,r){var s,p,e=r.tracks,g=!1;for(var x in e){var O=e[x];if("main"===O.id){if(p=x,s=O,"video"===x){var I=e[x];I&&(this.videoBuffer=I.buffer)}}else g=!0}g&&s?(this.log("Alternate track found, use "+p+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},f.onFragBuffered=function(t,r){var e=r.frag,s=r.part;if(!e||e.type===D.PlaylistLevelType.MAIN){if(this.fragContextChanged(e))return this.warn("Fragment "+e.sn+(s?" p: "+s.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===A.State.PARSED&&(this.state=A.State.IDLE));var p=s?s.stats:e.stats;this.fragLastKbps=Math.round(8*p.total/(p.buffering.end-p.loading.first)),"initSegment"!==e.sn&&(this.fragPrevious=e),this.fragBufferedComplete(e,s)}},f.onError=function(t,r){if(r.type!==y.ErrorTypes.KEY_SYSTEM_ERROR)switch(r.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.FRAG_PARSING_ERROR:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(D.PlaylistLevelType.MAIN,r);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==A.State.ERROR&&(r.fatal?(this.warn(""+r.details),this.state=A.State.ERROR):!r.levelRetry&&this.state===A.State.WAITING_LEVEL&&(this.state=A.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if("main"===r.parent&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var e=!0,s=this.getFwdBufferInfo(this.media,D.PlaylistLevelType.MAIN);s&&s.len>.5&&(e=!this.reduceMaxBufferLength(s.len)),e&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(D.PlaylistLevelType.MAIN,r)},f.checkBuffer=function(){var t=this.media,r=this.gapController;t&&r&&t.readyState&&(!this.loadedmetadata&&k.BufferHelper.getBuffered(t).length||r.poll(this.lastCurrentTime,this.state!==A.State.IDLE?this.fragCurrent:null),this.lastCurrentTime=t.currentTime)},f.onFragLoadEmergencyAborted=function(){this.state=A.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},f.onBufferFlushed=function(t,r){var e=r.type;(e!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((e===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,e,D.PlaylistLevelType.MAIN)},f.onLevelsUpdated=function(t,r){this.levels=r.levels},f.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},f.seekToStartPos=function(){var t=this.media;if(t){var r=t.currentTime,e=this.startPosition;if(e>=0&&r<e){if(t.seeking)return void this.log("could not seek to "+e+", already seeking at "+r);var s=k.BufferHelper.getBuffered(t),g=(s.length?s.start(0):0)-e;g>0&&(g<this.config.maxBufferHole||g<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+g+" to match buffer start"),this.startPosition=e+=g),this.log("seek to target start position "+e+" from current time "+r),t.currentTime=e}}},f._getAudioCodec=function(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),r},f._loadBitrateTestFrag=function(t,r){var e=this;t.bitrateTest=!0,this._doFragLoad(t,r).then(function(s){var p=e.hls;if(s&&!e.fragContextChanged(t)){e.fragLoadError=0,e.state=A.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var g=t.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),p.trigger(R.Events.FRAG_LOADED,s),t.bitrateTest=!1}})},f._handleTransmuxComplete=function(t){var r,e="main",s=this.hls,p=t.remuxResult,g=t.chunkMeta,x=this.getCurrentContext(g);if(!x)return this.warn("The loading context changed while buffering fragment "+g.sn+" of level "+g.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(g.level);var O=x.frag,I=x.part,C=x.level,M=p.video,U=p.text,w=p.id3,K=p.initSegment,N=C.details,W=this.altAudio?void 0:p.audio;if(!this.fragContextChanged(O)){if(this.state=A.State.PARSING,K){K.tracks&&(this._bufferInitSegment(C,K.tracks,O,g),s.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:e,tracks:K.tracks}));var G=K.initPTS,V=K.timescale;(0,F.isFiniteNumber)(G)&&(this.initPTS[O.cc]=G,s.trigger(R.Events.INIT_PTS_FOUND,{frag:O,id:e,initPTS:G,timescale:V}))}if(M&&!1!==p.independent){if(N){var H=M.startPTS,j=M.endPTS,X=M.startDTS,Z=M.endDTS;if(I)I.elementaryStreams[M.type]={startPTS:H,endPTS:j,startDTS:X,endDTS:Z};else if(M.firstKeyFrame&&M.independent&&1===g.id&&(this.couldBacktrack=!0),M.dropped&&M.independent){var Q=this.getMainFwdBufferInfo();if((Q?Q.end:this.getLoadPosition())+this.config.maxBufferHole<(M.firstKeyFramePTS?M.firstKeyFramePTS:H)-this.config.maxBufferHole)return void this.backtrack(O);O.setElementaryStreamInfo(M.type,O.start,j,O.start,Z,!0)}O.setElementaryStreamInfo(M.type,H,j,X,Z),this.backtrackFragment&&(this.backtrackFragment=O),this.bufferFragmentData(M,O,I,g)}}else if(!1===p.independent)return void this.backtrack(O);if(W){var J=W.startPTS,q=W.endPTS,ie=W.startDTS,re=W.endDTS;I&&(I.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:q,startDTS:ie,endDTS:re}),O.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,J,q,ie,re),this.bufferFragmentData(W,O,I,g)}N&&null!=w&&null!==(r=w.samples)&&void 0!==r&&r.length&&s.trigger(R.Events.FRAG_PARSING_METADATA,{id:e,frag:O,details:N,samples:w.samples}),N&&U&&s.trigger(R.Events.FRAG_PARSING_USERDATA,{id:e,frag:O,details:N,samples:U.samples})}},f._bufferInitSegment=function(t,r,e,s){var p=this;if(this.state===A.State.PARSING){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var g=r.audio,x=r.video,O=r.audiovideo;if(g){var I=t.audioCodec,C=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(I&&(I=-1!==I.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==g.metadata.channelCount&&-1===C.indexOf("firefox")&&(I="mp4a.40.5")),-1!==C.indexOf("android")&&"audio/mpeg"!==g.container&&this.log("Android: force audio codec to "+(I="mp4a.40.2")),t.audioCodec&&t.audioCodec!==I&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+I+'"'),g.levelCodec=I,g.id="main",this.log("Init audio buffer, container:"+g.container+", codecs[selected/level/parsed]=["+(I||"")+"/"+(t.audioCodec||"")+"/"+g.codec+"]")}x&&(x.levelCodec=t.videoCodec,x.id="main",this.log("Init video buffer, container:"+x.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+x.codec+"]")),O&&this.log("Init audiovideo buffer, container:"+O.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+O.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,r),Object.keys(r).forEach(function(M){var w=r[M].initSegment;null!=w&&w.byteLength&&p.hls.trigger(R.Events.BUFFER_APPENDING,{type:M,data:w,frag:e,part:null,chunkMeta:s,parent:e.type})}),this.tick()}},f.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,D.PlaylistLevelType.MAIN)},f.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=A.State.IDLE},f.checkFragmentChanged=function(){var t=this.media,r=null;if(t&&t.readyState>1&&!1===t.seeking){var e=t.currentTime;if(k.BufferHelper.isBuffered(t,e)?r=this.getAppendedFrag(e):k.BufferHelper.isBuffered(t,e+.1)&&(r=this.getAppendedFrag(e+.1)),r){this.backtrackFragment=null;var s=this.fragPlaying,p=r.level;(!s||r.sn!==s.sn||s.level!==p||r.urlId!==s.urlId)&&(this.fragPlaying=r,this.hls.trigger(R.Events.FRAG_CHANGED,{frag:r}),(!s||s.level!==p)&&this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:p}))}}},function l(u,E,f){E&&m(u.prototype,E),f&&m(u,f),Object.defineProperty(u,"prototype",{writable:!1})}(E,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var r=t.currentTime,e=this.currentFrag;if(e&&(0,F.isFiniteNumber)(r)&&(0,F.isFiniteNumber)(e.programDateTime))return new Date(e.programDateTime+1e3*(r-e.start))}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),E}(A.default)},"./src/controller/subtitle-stream-controller.ts":
/*!******************************************************!*\
          !*** ./src/controller/subtitle-stream-controller.ts ***!
          \******************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{SubtitleStreamController:()=>n});var F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../utils/buffer-helper */
"./src/utils/buffer-helper.ts"),b=L(
/*! ./fragment-finders */
"./src/controller/fragment-finders.ts"),R=L(
/*! ../utils/discontinuities */
"./src/utils/discontinuities.ts"),k=L(
/*! ./level-helper */
"./src/controller/level-helper.ts"),P=L(
/*! ./fragment-tracker */
"./src/controller/fragment-tracker.ts"),D=L(
/*! ./base-stream-controller */
"./src/controller/base-stream-controller.ts"),S=L(
/*! ../types/loader */
"./src/types/loader.ts"),T=L(
/*! ../types/level */
"./src/types/level.ts");function _(c,i){for(var u=0;u<i.length;u++){var E=i[u];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(c,y(E.key),E)}}function y(c){var i=function m(c,i){if("object"!=typeof c||null===c)return c;var u=c[Symbol.toPrimitive];if(void 0!==u){var E=u.call(c,i||"default");if("object"!=typeof E)return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(c)}(c,"string");return"symbol"==typeof i?i:String(i)}function a(c,i){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,f){return E.__proto__=f,E})(c,i)}var n=function(c){function i(E,f,v){var t;return(t=c.call(this,E,f,v,"[subtitle-stream-controller]")||this).levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}!function l(c,i){c.prototype=Object.create(i.prototype),c.prototype.constructor=c,a(c,i)}(i,c);var u=i.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var f=this.hls;f.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(F.Events.ERROR,this.onError,this),f.on(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.on(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),f.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),f.on(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),f.on(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var f=this.hls;f.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(F.Events.ERROR,this.onError,this),f.off(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.off(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),f.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),f.off(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),f.off(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.startLoad=function(f){this.stopLoad(),this.state=D.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},u.onLevelLoaded=function(f,v){this.mainDetails=v.details},u.onSubtitleFragProcessed=function(f,v){var t=v.frag,r=v.success;if(this.fragPrevious=t,this.state=D.State.IDLE,r){var e=this.tracksBuffered[this.currentTrackId];if(e){for(var s,p=t.start,g=0;g<e.length;g++)if(p>=e[g].start&&p<=e[g].end){s=e[g];break}var x=t.start+t.duration;s?s.end=x:e.push(s={start:p,end:x}),this.fragmentTracker.fragBuffered(t)}}},u.onBufferFlushing=function(f,v){var t=v.startOffset,r=v.endOffset;if(0===t&&r!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,s=this.levels;if(!s.length||!s[e]||!s[e].details)return;var x=r-s[e].details.targetduration;if(x<=0)return;v.endOffsetSubtitles=Math.max(0,x),this.tracksBuffered.forEach(function(O){for(var I=0;I<O.length;)if(O[I].end<=x)O.shift();else{if(!(O[I].start<x))break;O[I].start=x,I++}}),this.fragmentTracker.removeFragmentsInRange(t,x,S.PlaylistLevelType.SUBTITLE)}},u.onFragBuffered=function(f,v){var t;this.loadedmetadata||v.frag.type!==S.PlaylistLevelType.MAIN||null!==(t=this.media)&&void 0!==t&&t.buffered.length&&(this.loadedmetadata=!0)},u.onError=function(f,v){var t=v.frag;!t||t.type!==S.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=D.State.IDLE)},u.onSubtitleTracksUpdated=function(f,v){var t=this,r=v.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(e){return new T.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){t.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},u.onSubtitleTrackSwitch=function(f,v){if(this.currentTrackId=v.id,this.levels.length&&-1!==this.currentTrackId){var t=this.levels[this.currentTrackId];this.mediaBuffer=null!=t&&t.details?this.mediaBufferTimeRanges:null,t&&this.setInterval(500)}else this.clearInterval()},u.onSubtitleTrackLoaded=function(f,v){var t,r=v.details,e=v.id,s=this.currentTrackId,p=this.levels;if(p.length){var g=p[s];if(!(e>=p.length||e!==s)&&g){this.mediaBuffer=this.mediaBufferTimeRanges;var x=0;if(r.live||null!==(t=g.details)&&void 0!==t&&t.live){var O=this.mainDetails;if(r.deltaUpdateFailed||!O)return;var I=O.fragments[0];g.details?0===(x=this.alignPlaylists(r,g.details))&&I&&(0,k.addSliding)(r,x=I.start):r.hasProgramDateTime&&O.hasProgramDateTime?((0,R.alignMediaPlaylistByPDT)(r,O),x=r.fragments[0].start):I&&(0,k.addSliding)(r,x=I.start)}g.details=r,this.levelLastLoaded=e,!this.startFragRequested&&(this.mainDetails||!r.live)&&this.setStartPosition(g.details,x),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===D.State.IDLE&&((0,b.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),g.details=void 0))}}},u._handleFragmentLoadComplete=function(f){var v=this,t=f.frag,r=f.payload,e=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&e&&e.key&&e.iv&&"AES-128"===e.method){var p=performance.now();this.decrypter.decrypt(new Uint8Array(r),e.key.buffer,e.iv.buffer).then(function(g){var x=performance.now();s.trigger(F.Events.FRAG_DECRYPTED,{frag:t,payload:g,stats:{tstart:p,tdecrypt:x}})}).catch(function(g){v.warn(g.name+": "+g.message),v.state=D.State.IDLE})}},u.doTick=function(){if(this.media){if(this.state===D.State.IDLE){var f=this.currentTrackId,v=this.levels;if(!v.length||!v[f]||!v[f].details)return;var t=v[f].details,r=t.targetduration,e=this.config,s=this.getLoadPosition(),p=A.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s-r,e.maxBufferHole),g=p.end,x=p.len,O=this.getFwdBufferInfo(this.media,S.PlaylistLevelType.MAIN);if(x>this.getMaxBufferLength(O?.len)+r)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var C=t.fragments,M=C.length,w=null,K=this.fragPrevious;if(g<t.edge){var N=e.maxFragLookUpTolerance;!(w=(0,b.findFragmentByPTS)(K,C,Math.max(C[0].start,g),N))&&K&&K.start<C[0].start&&(w=C[0])}else w=C[M-1];if(!w)return;w=this.mapToInitFragWhenRequired(w),this.fragmentTracker.getState(w)===P.FragmentState.NOT_LOADED&&this.loadFragment(w,t,g)}}else this.state=D.State.IDLE},u.getMaxBufferLength=function(f){var v=c.prototype.getMaxBufferLength.call(this);return f?Math.max(v,f):v},u.loadFragment=function(f,v,t){this.fragCurrent=f,"initSegment"===f.sn?this._loadInitSegment(f,v):(this.startFragRequested=!0,c.prototype.loadFragment.call(this,f,v,t))},function h(c,i,u){i&&_(c.prototype,i),u&&_(c,u),Object.defineProperty(c,"prototype",{writable:!1})}(i,[{key:"mediaBufferTimeRanges",get:function(){return new d(this.tracksBuffered[this.currentTrackId]||[])}}]),i}(D.default),d=function(i){this.buffered=void 0;var u=function(f,v,t){if((v>>>=0)>t-1)throw new DOMException("Failed to execute '"+f+"' on 'TimeRanges': The index provided ("+v+") is greater than the maximum bound ("+t+")");return i[v][f]};this.buffered={get length(){return i.length},end:function(f){return u("end",f,i.length)},start:function(f){return u("start",f,i.length)}}}},"./src/controller/subtitle-track-controller.ts":
/*!*****************************************************!*\
          !*** ./src/controller/subtitle-track-controller.ts ***!
          \*****************************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>m});var F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../utils/texttrack-utils */
"./src/utils/texttrack-utils.ts"),b=L(
/*! ./base-playlist-controller */
"./src/controller/base-playlist-controller.ts"),R=L(
/*! ../types/loader */
"./src/types/loader.ts");function k(l,a){for(var o=0;o<a.length;o++){var n=a[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(l,D(n.key),n)}}function D(l){var a=function S(l,a){if("object"!=typeof l||null===l)return l;var o=l[Symbol.toPrimitive];if(void 0!==o){var n=o.call(l,a||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(l)}(l,"string");return"symbol"==typeof a?a:String(a)}function _(l,a){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,d){return n.__proto__=d,n})(l,a)}function y(l){for(var a=[],o=0;o<l.length;o++){var n=l[o];"subtitles"===n.kind&&n.label&&a.push(l[o])}return a}const m=function(l){function a(n){var d;return(d=l.call(this,n,"[subtitle-track-controller]")||this).media=null,d.tracks=[],d.groupId=null,d.tracksInGroup=[],d.trackId=-1,d.selectDefaultTrack=!0,d.queuedDefaultTrack=-1,d.trackChangeListener=function(){return d.onTextTracksChanged()},d.asyncPollTrackChange=function(){return d.pollTrackChange(0)},d.useTextTrackPolling=!1,d.subtitlePollingInterval=-1,d._subtitleDisplay=!0,d.registerListeners(),d}!function T(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,_(l,a)}(a,l);var o=a.prototype;return o.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,l.prototype.destroy.call(this)},o.registerListeners=function(){var d=this.hls;d.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),d.on(F.Events.ERROR,this.onError,this)},o.unregisterListeners=function(){var d=this.hls;d.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),d.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),d.off(F.Events.ERROR,this.onError,this)},o.onMediaAttached=function(d,c){this.media=c.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},o.pollTrackChange=function(d){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,d)},o.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),y(this.media.textTracks).forEach(function(c){(0,A.clearCurrentCues)(c)}),this.subtitleTrack=-1,this.media=null)},o.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},o.onManifestParsed=function(d,c){this.tracks=c.subtitleTracks},o.onSubtitleTrackLoaded=function(d,c){var i=c.id,u=c.details,f=this.tracksInGroup[this.trackId];if(f){var v=f.details;f.details=c.details,this.log("subtitle track "+i+" loaded ["+u.startSN+"-"+u.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,c,v))}else this.warn("Invalid subtitle track id "+i)},o.onLevelLoading=function(d,c){this.switchLevel(c.level)},o.onLevelSwitching=function(d,c){this.switchLevel(c.level)},o.switchLevel=function(d){var c=this.hls.levels[d];if(null!=c&&c.textGroupIds){var i=c.textGroupIds[c.urlId];if(this.groupId!==i){var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,E=this.tracks.filter(function(t){return!i||t.groupId===i});this.tracksInGroup=E;var f=this.findTrackId(u?.name)||this.findTrackId();this.groupId=i;var v={subtitleTracks:E};this.log("Updating subtitle tracks, "+E.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(F.Events.SUBTITLE_TRACKS_UPDATED,v),-1!==f&&this.setSubtitleTrack(f,u)}}},o.findTrackId=function(d){for(var c=this.tracksInGroup,i=0;i<c.length;i++){var u=c[i];if((!this.selectDefaultTrack||u.default)&&(!d||d===u.name))return u.id}return-1},o.onError=function(d,c){l.prototype.onError.call(this,d,c),!c.fatal&&c.context&&c.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},o.loadPlaylist=function(d){l.prototype.loadPlaylist.call(this);var c=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(c)){var i=c.id,u=c.groupId,E=c.url;if(d)try{E=d.addDirectives(E)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(F.Events.SUBTITLE_TRACK_LOADING,{url:E,id:i,groupId:u,deliveryDirectives:d||null})}},o.toggleTrackModes=function(d){var c=this,i=this.media,u=this.trackId;if(i){var E=y(i.textTracks),f=E.filter(function(r){return r.groupId===c.groupId});if(-1===d)[].slice.call(E).forEach(function(r){r.mode="disabled"});else{var v=f[u];v&&(v.mode="disabled")}var t=f[d];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}},o.setSubtitleTrack=function(d,c){var i,u=this.tracksInGroup;if(this.media){if(this.trackId!==d&&this.toggleTrackModes(d),!(this.trackId===d&&(-1===d||null!==(i=u[d])&&void 0!==i&&i.details)||d<-1||d>=u.length)){this.clearTimer();var E=u[d];if(this.log("Switching to subtitle track "+d),this.trackId=d,E){var v=E.groupId;this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:E.id,groupId:void 0===v?"":v,name:E.name,type:E.type,url:E.url});var p=this.switchParams(E.url,c?.details);this.loadPlaylist(p)}else this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:d})}}else this.queuedDefaultTrack=d},o.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var d=-1,c=y(this.media.textTracks),i=0;i<c.length;i++)if("hidden"===c[i].mode)d=i;else if("showing"===c[i].mode){d=i;break}this.subtitleTrack!==d&&(this.subtitleTrack=d)}},function P(l,a,o){a&&k(l.prototype,a),o&&k(l,o),Object.defineProperty(l,"prototype",{writable:!1})}(a,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(d){this._subtitleDisplay=d,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(d){this.selectDefaultTrack=!1,this.setSubtitleTrack(d,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}]),a}(b.default)},"./src/controller/timeline-controller.ts":
/*!***********************************************!*\
          !*** ./src/controller/timeline-controller.ts ***!
          \***********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{TimelineController:()=>h});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../utils/cea-608-parser */
"./src/utils/cea-608-parser.ts"),R=L(
/*! ../utils/output-filter */
"./src/utils/output-filter.ts"),k=L(
/*! ../utils/webvtt-parser */
"./src/utils/webvtt-parser.ts"),P=L(
/*! ../utils/texttrack-utils */
"./src/utils/texttrack-utils.ts"),D=L(
/*! ../utils/imsc1-ttml-parser */
"./src/utils/imsc1-ttml-parser.ts"),S=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),T=L(
/*! ../types/loader */
"./src/types/loader.ts"),_=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),h=function(){function a(n){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=n,this.config=n.config,this.Cues=n.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var d=new R.default(this,"textTrack1"),c=new R.default(this,"textTrack2"),i=new R.default(this,"textTrack3"),u=new R.default(this,"textTrack4");this.cea608Parser1=new b.default(1,d,c),this.cea608Parser2=new b.default(3,i,u)}n.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.on(A.Events.FRAG_LOADING,this.onFragLoading,this),n.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.on(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),n.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=a.prototype;return o.destroy=function(){var d=this.hls;d.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),d.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),d.off(A.Events.FRAG_LOADING,this.onFragLoading,this),d.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),d.off(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),d.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),d.off(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),d.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},o.addCues=function(d,c,i,u,E){for(var f=!1,v=E.length;v--;){var t=E[v],r=m(t[0],t[1],c,i);if(r>=0&&(t[0]=Math.min(t[0],c),t[1]=Math.max(t[1],i),f=!0,r/(i-c)>.5))return}if(f||E.push([c,i]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[d],c,i,u);else{var s=this.Cues.newCue(null,c,i,u);this.hls.trigger(A.Events.CUES_PARSED,{type:"captions",cues:s,track:d})}},o.onInitPtsFound=function(d,c){var i=this,u=c.frag,v=c.timescale,t=this.unparsedVttFrags;"main"===c.id&&(this.initPTS[u.cc]=c.initPTS,this.timescale[u.cc]=v),t.length&&(this.unparsedVttFrags=[],t.forEach(function(r){i.onFragLoaded(A.Events.FRAG_LOADED,r)}))},o.getExistingTrack=function(d){var c=this.media;if(c)for(var i=0;i<c.textTracks.length;i++){var u=c.textTracks[i];if(u[d])return u}return null},o.createCaptionsTrack=function(d){this.config.renderTextTracksNatively?this.createNativeTrack(d):this.createNonNativeTrack(d)},o.createNativeTrack=function(d){if(!this.captionsTracks[d]){var i=this.captionsTracks,u=this.media,E=this.captionsProperties[d],f=E.label,v=E.languageCode,t=this.getExistingTrack(d);if(t)i[d]=t,(0,P.clearCurrentCues)(i[d]),(0,P.sendAddTrackEvent)(i[d],u);else{var r=this.createTextTrack("captions",f,v);r&&(r[d]=!0,i[d]=r)}}},o.createNonNativeTrack=function(d){if(!this.nonNativeCaptionsTracks[d]){var c=this.captionsProperties[d];if(c){var u={_id:d,label:c.label,kind:"captions",default:!!c.media&&!!c.media.default,closedCaptions:c.media};this.nonNativeCaptionsTracks[d]=u,this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[u]})}}},o.createTextTrack=function(d,c,i){var u=this.media;if(u)return u.addTextTrack(d,c,i)},o.onMediaAttaching=function(d,c){this.media=c.media,this._cleanTracks()},o.onMediaDetaching=function(){var d=this.captionsTracks;Object.keys(d).forEach(function(c){(0,P.clearCurrentCues)(d[c]),delete d[c]}),this.nonNativeCaptionsTracks={}},o.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var d=this.media;if(d){var c=d.textTracks;if(c)for(var i=0;i<c.length;i++)(0,P.clearCurrentCues)(c[i])}},o.onSubtitleTracksUpdated=function(d,c){var i=this;this.textTracks=[];var u=c.subtitleTracks||[],E=u.some(function(r){return r.textCodec===D.IMSC1_CODEC});if(this.config.enableWebVTT||E&&this.config.enableIMSC1){var f=this.tracks&&u&&this.tracks.length===u.length;if(this.tracks=u||[],this.config.renderTextTracksNatively){var v=this.media?this.media.textTracks:[];this.tracks.forEach(function(r,e){var s;if(e<v.length){for(var p=null,g=0;g<v.length;g++)if(y(v[g],r)){p=v[g];break}p&&(s=p)}if(s)(0,P.clearCurrentCues)(s);else{var x=i._captionsOrSubtitlesFromCharacteristics(r);(s=i.createTextTrack(x,r.name,r.lang))&&(s.mode="disabled")}s&&(s.groupId=r.groupId,i.textTracks.push(s))})}else if(!f&&this.tracks&&this.tracks.length){var t=this.tracks.map(function(r){return{label:r.name,kind:r.type.toLowerCase(),default:r.default,subtitleTrack:r}});this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}},o._captionsOrSubtitlesFromCharacteristics=function(d){var c;if(null!==(c=d.attrs)&&void 0!==c&&c.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(d.attrs.CHARACTERISTICS),u=/describes-music-and-sound/gi.test(d.attrs.CHARACTERISTICS);if(i&&u)return"captions"}return"subtitles"},o.onManifestLoaded=function(d,c){var i=this;this.config.enableCEA708Captions&&c.captions&&c.captions.forEach(function(u){var E=/(?:CC|SERVICE)([1-4])/.exec(u.instreamId);if(E){var v=i.captionsProperties["textTrack"+E[1]];v&&(v.label=u.name,u.lang&&(v.languageCode=u.lang),v.media=u)}})},o.closedCaptionsForLevel=function(d){return this.hls.levels[d.level]?.attrs["CLOSED-CAPTIONS"]},o.onFragLoading=function(d,c){var i=this.cea608Parser1,u=this.cea608Parser2,E=this.lastSn;if(this.enabled&&i&&u&&c.frag.type===T.PlaylistLevelType.MAIN){var v,t,r=c.frag.sn,e=null!=(v=null==c||null===(t=c.part)||void 0===t?void 0:t.index)?v:-1;r===E+1||r===E&&e===this.lastPartIndex+1||(i.reset(),u.reset()),this.lastSn=r,this.lastPartIndex=e}},o.onFragLoaded=function(d,c){var i=c.frag,u=c.payload,E=this.initPTS,f=this.unparsedVttFrags;if(i.type===T.PlaylistLevelType.SUBTITLE)if(u.byteLength){if(!(0,F.isFiniteNumber)(E[i.cc]))return f.push(c),void(E.length&&this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var v=i.decryptdata;if(null==v||!v.encrypted||"stats"in c){var r=this.tracks[i.level],e=this.vttCCs;e[i.cc]||(e[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),r&&r.textCodec===D.IMSC1_CODEC?this._parseIMSC1(i,u):this._parseVTTs(i,u,e)}}else this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(d,c){var i=this,u=this.hls;(0,D.parseIMSC1)(c,this.initPTS[d.cc],this.timescale[d.cc],function(E){i._appendCues(E,d.level),u.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(E){_.logger.log("Failed to parse IMSC1: "+E),u.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:E})})},o._parseVTTs=function(d,c,i){var u,E=this,f=this.hls,v=null!==(u=d.initSegment)&&void 0!==u&&u.data?(0,S.appendUint8Array)(d.initSegment.data,new Uint8Array(c)):c;(0,k.parseWebVTT)(v,this.initPTS[d.cc],this.timescale[d.cc],i,d.cc,d.start,function(t){E._appendCues(t,d.level),f.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(t){E._fallbackToIMSC1(d,c),_.logger.log("Failed to parse VTT cue: "+t),f.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:t})})},o._fallbackToIMSC1=function(d,c){var i=this,u=this.tracks[d.level];u.textCodec||(0,D.parseIMSC1)(c,this.initPTS[d.cc],this.timescale[d.cc],function(){u.textCodec=D.IMSC1_CODEC,i._parseIMSC1(d,c)},function(){u.textCodec="wvtt"})},o._appendCues=function(d,c){var i=this.hls;if(this.config.renderTextTracksNatively){var u=this.textTracks[c];if(!u||"disabled"===u.mode)return;d.forEach(function(v){return(0,P.addCueToTrack)(u,v)})}else{var E=this.tracks[c];if(!E)return;i.trigger(A.Events.CUES_PARSED,{type:"subtitles",cues:d,track:E.default?"default":"subtitles"+c})}},o.onFragDecrypted=function(d,c){var i=c.frag;if(i.type===T.PlaylistLevelType.SUBTITLE){if(!(0,F.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(c);this.onFragLoaded(A.Events.FRAG_LOADED,c)}},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(d,c){var i=this.cea608Parser1,u=this.cea608Parser2;if(this.enabled&&i&&u){var E=c.frag,f=c.samples;if(E.type!==T.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(E))for(var v=0;v<f.length;v++){var t=f[v].bytes;if(t){var r=this.extractCea608Data(t);i.addData(f[v].pts,r[0]),u.addData(f[v].pts,r[1])}}}},o.onBufferFlushing=function(d,c){var i=c.startOffset,u=c.endOffset,E=c.endOffsetSubtitles,f=c.type,v=this.media;if(v&&!(v.currentTime<u)){if(!f||"video"===f){var t=this.captionsTracks;Object.keys(t).forEach(function(e){return(0,P.removeCuesInRange)(t[e],i,u)})}if(this.config.renderTextTracksNatively&&0===i&&void 0!==E){var r=this.textTracks;Object.keys(r).forEach(function(e){return(0,P.removeCuesInRange)(r[e],i,E)})}}},o.extractCea608Data=function(d){for(var c=[[],[]],i=31&d[0],u=2,E=0;E<i;E++){var f=d[u++],v=127&d[u++],t=127&d[u++];if((0!==v||0!==t)&&0!=(4&f)){var e=3&f;(0===e||1===e)&&(c[e].push(v),c[e].push(t))}}return c},a}();function y(a,o){return a&&a.label===o.name&&!(a.textTrack1||a.textTrack2)}function m(a,o,n,d){return Math.min(o,d)-Math.max(a,n)}},"./src/crypt/aes-crypto.ts":
/*!*********************************!*\
          !*** ./src/crypt/aes-crypto.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>F});var F=function(){function A(R,k){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=k}return A.prototype.decrypt=function(k,P){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},P,k)},A}()},"./src/crypt/aes-decryptor.ts":
/*!************************************!*\
          !*** ./src/crypt/aes-decryptor.ts ***!
          \************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>b,removePadding:()=>A});var F=L(
/*! ../utils/typed-array */
"./src/utils/typed-array.ts");function A(R){var k=R.byteLength,P=k&&new DataView(R.buffer).getUint8(k-1);return P?(0,F.sliceUint8)(R,0,k-P):R}var b=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var k=R.prototype;return k.uint8ArrayToUint32Array_=function(D){for(var S=new DataView(D),T=new Uint32Array(4),_=0;_<4;_++)T[_]=S.getUint32(4*_);return T},k.initTable=function(){var D=this.sBox,S=this.invSBox,T=this.subMix,_=T[0],h=T[1],y=T[2],m=T[3],l=this.invSubMix,a=l[0],o=l[1],n=l[2],d=l[3],c=new Uint32Array(256),i=0,u=0,E=0;for(E=0;E<256;E++)c[E]=E<128?E<<1:E<<1^283;for(E=0;E<256;E++){var f=u^u<<1^u<<2^u<<3^u<<4;D[i]=f=f>>>8^255&f^99,S[f]=i;var v=c[i],t=c[v],r=c[t],e=257*c[f]^16843008*f;_[i]=e<<24|e>>>8,h[i]=e<<16|e>>>16,y[i]=e<<8|e>>>24,m[i]=e,a[f]=(e=16843009*r^65537*t^257*v^16843008*i)<<24|e>>>8,o[f]=e<<16|e>>>16,n[f]=e<<8|e>>>24,d[f]=e,i?(i=v^c[c[c[r^v]]],u^=c[c[u]]):i=u=1}},k.expandKey=function(D){for(var S=this.uint8ArrayToUint32Array_(D),T=!0,_=0;_<S.length&&T;)T=S[_]===this.key[_],_++;if(!T){this.key=S;var h=this.keySize=S.length;if(4!==h&&6!==h&&8!==h)throw new Error("Invalid aes key size="+h);var m,l,v,t,y=this.ksRows=4*(h+6+1),a=this.keySchedule=new Uint32Array(y),o=this.invKeySchedule=new Uint32Array(y),n=this.sBox,d=this.rcon,c=this.invSubMix,i=c[0],u=c[1],E=c[2],f=c[3];for(m=0;m<y;m++)m<h?v=a[m]=S[m]:(t=v,m%h==0?(t=n[(t=t<<8|t>>>24)>>>24]<<24|n[t>>>16&255]<<16|n[t>>>8&255]<<8|n[255&t],t^=d[m/h|0]<<24):h>6&&m%h==4&&(t=n[t>>>24]<<24|n[t>>>16&255]<<16|n[t>>>8&255]<<8|n[255&t]),a[m]=v=(a[m-h]^t)>>>0);for(l=0;l<y;l++)m=y-l,t=3&l?a[m]:a[m-4],o[l]=l<4||m<=4?t:i[n[t>>>24]]^u[n[t>>>16&255]]^E[n[t>>>8&255]]^f[n[255&t]],o[l]=o[l]>>>0}},k.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},k.decrypt=function(D,S,T){for(var r,e,s,p,g,x,O,I,C,M,U,w,K,_=this.keySize+6,h=this.invKeySchedule,y=this.invSBox,m=this.invSubMix,l=m[0],a=m[1],o=m[2],n=m[3],d=this.uint8ArrayToUint32Array_(T),c=d[0],i=d[1],u=d[2],E=d[3],f=new Int32Array(D),v=new Int32Array(f.length),N=this.networkToHostOrderSwap;S<f.length;){for(I=N(f[S]),C=N(f[S+1]),M=N(f[S+2]),U=N(f[S+3]),p=I^h[0],g=U^h[1],x=M^h[2],O=C^h[3],w=4,K=1;K<_;K++)r=l[g>>>24]^a[x>>16&255]^o[O>>8&255]^n[255&p]^h[w+1],e=l[x>>>24]^a[O>>16&255]^o[p>>8&255]^n[255&g]^h[w+2],s=l[O>>>24]^a[p>>16&255]^o[g>>8&255]^n[255&x]^h[w+3],p=l[p>>>24]^a[g>>16&255]^o[x>>8&255]^n[255&O]^h[w],g=r,x=e,O=s,w+=4;r=y[g>>>24]<<24^y[x>>16&255]<<16^y[O>>8&255]<<8^y[255&p]^h[w+1],e=y[x>>>24]<<24^y[O>>16&255]<<16^y[p>>8&255]<<8^y[255&g]^h[w+2],s=y[O>>>24]<<24^y[p>>16&255]<<16^y[g>>8&255]<<8^y[255&x]^h[w+3],v[S]=N(y[p>>>24]<<24^y[g>>16&255]<<16^y[x>>8&255]<<8^y[255&O]^h[w]^c),v[S+1]=N(s^i),v[S+2]=N(e^u),v[S+3]=N(r^E),c=I,i=C,u=M,E=U,S+=4}return v.buffer},R}()},"./src/crypt/decrypter.ts":
/*!********************************!*\
          !*** ./src/crypt/decrypter.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>S});var F=L(
/*! ./aes-crypto */
"./src/crypt/aes-crypto.ts"),A=L(
/*! ./fast-aes-key */
"./src/crypt/fast-aes-key.ts"),b=L(
/*! ./aes-decryptor */
"./src/crypt/aes-decryptor.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),k=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),P=L(
/*! ../utils/typed-array */
"./src/utils/typed-array.ts"),S=function(){function T(h,y){var l=(void 0===y?{}:y).removePKCS7Padding,a=void 0===l||l;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=h.enableSoftwareAES,this.removePKCS7Padding=a,a)try{var o=self.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch{}null===this.subtle&&(this.useSoftware=!0)}var _=T.prototype;return _.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},_.isSync=function(){return this.useSoftware},_.flush=function(){var y=this.currentResult;if(!y||this.remainderData)return this.reset(),null;var l=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?(0,b.removePadding)(l):l},_.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},_.decrypt=function(y,m,l){var a=this;return this.useSoftware?new Promise(function(o,n){a.softwareDecrypt(new Uint8Array(y),m,l);var d=a.flush();d?o(d.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(y),m,l)},_.softwareDecrypt=function(y,m,l){var a=this.currentIV,o=this.currentResult,n=this.remainderData;this.logOnce("JS AES decrypt"),n&&(y=(0,k.appendUint8Array)(n,y),this.remainderData=null);var d=this.getValidChunk(y);if(!d.length)return null;a&&(l=a);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new b.default),c.expandKey(m);var i=o;return this.currentResult=c.decrypt(d.buffer,0,l),this.currentIV=(0,P.sliceUint8)(d,-16).buffer,i||null},_.webCryptoDecrypt=function(y,m,l){var a=this,o=this.subtle;return(this.key!==m||!this.fastAesKey)&&(this.key=m,this.fastAesKey=new A.default(o,m)),this.fastAesKey.expandKey().then(function(n){return o?(a.logOnce("WebCrypto AES decrypt"),new F.default(o,new Uint8Array(l)).decrypt(y.buffer,n)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(n){return R.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+n.name+": "+n.message),a.onWebCryptoError(y,m,l)})},_.onWebCryptoError=function(y,m,l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(y,m,l);var a=this.flush();if(a)return a.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},_.getValidChunk=function(y){var m=y,l=y.length-y.length%16;return l!==y.length&&(m=(0,P.sliceUint8)(y,0,l),this.remainderData=(0,P.sliceUint8)(y,l)),m},_.logOnce=function(y){this.logEnabled&&(R.logger.log("[decrypter]: "+y),this.logEnabled=!1)},T}()},"./src/crypt/fast-aes-key.ts":
/*!***********************************!*\
          !*** ./src/crypt/fast-aes-key.ts ***!
          \***********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>F});var F=function(){function A(R,k){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=k}return A.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},A}()},"./src/demux/aacdemuxer.ts":
/*!*********************************!*\
          !*** ./src/demux/aacdemuxer.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>S});var F=L(
/*! ./base-audio-demuxer */
"./src/demux/base-audio-demuxer.ts"),A=L(
/*! ./adts */
"./src/demux/adts.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),R=L(
/*! ../demux/id3 */
"./src/demux/id3.ts");function P(T,_){return(P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,m){return y.__proto__=m,y})(T,_)}const S=function(T){function _(y,m){var l;return(l=T.call(this)||this).observer=void 0,l.config=void 0,l.observer=y,l.config=m,l}!function k(T,_){T.prototype=Object.create(_.prototype),T.prototype.constructor=T,P(T,_)}(_,T);var h=_.prototype;return h.resetInitSegment=function(m,l,a,o){T.prototype.resetInitSegment.call(this,m,l,a,o),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:o,inputTimeScale:9e4,dropped:0}},_.probe=function(m){if(!m)return!1;for(var a=(R.getID3Data(m,0)||[]).length,o=m.length;a<o;a++)if(A.probe(m,a))return b.logger.log("ADTS sync word found !"),!0;return!1},h.canParse=function(m,l){return A.canParse(m,l)},h.appendFrame=function(m,l,a){A.initTrackConfig(m,this.observer,l,a,m.manifestCodec);var o=A.appendFrame(m,l,a,this.basePTS,this.frameIndex);if(o&&0===o.missing)return o},_}(F.default)},"./src/demux/adts.ts":
/*!***************************!*\
          !*** ./src/demux/adts.ts ***!
          \***************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{appendFrame:()=>a,canGetFrameLength:()=>S,canParse:()=>_,getAudioConfig:()=>R,getFrameDuration:()=>m,getFullFrameLength:()=>D,getHeaderLength:()=>P,initTrackConfig:()=>y,isHeader:()=>T,isHeaderPattern:()=>k,parseFrameHeader:()=>l,probe:()=>h});var F=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),A=L(
/*! ../errors */
"./src/errors.ts"),b=L(
/*! ../events */
"./src/events.ts");function R(o,n,d,c){var i,u,E,f,v=navigator.userAgent.toLowerCase(),t=c,r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&n[d+2])>>>6);var e=(60&n[d+2])>>>2;if(!(e>r.length-1))return E=(1&n[d+2])<<2,E|=(192&n[d+3])>>>6,F.logger.log("manifest codec:"+c+", ADTS type:"+i+", samplingIndex:"+e),/firefox/i.test(v)?e>=6?(i=5,f=new Array(4),u=e-3):(i=2,f=new Array(2),u=e):-1!==v.indexOf("android")?(i=2,f=new Array(2),u=e):(i=5,f=new Array(4),c&&(-1!==c.indexOf("mp4a.40.29")||-1!==c.indexOf("mp4a.40.5"))||!c&&e>=6?u=e-3:((c&&-1!==c.indexOf("mp4a.40.2")&&(e>=6&&1===E||/vivaldi/i.test(v))||!c&&1===E)&&(i=2,f=new Array(2)),u=e)),f[0]=i<<3,f[0]|=(14&e)>>1,f[1]|=(1&e)<<7,f[1]|=E<<3,5===i&&(f[1]|=(14&u)>>1,f[2]=(1&u)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:r[e],channelCount:E,codec:"mp4a.40."+i,manifestCodec:t};o.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e})}function k(o,n){return 255===o[n]&&240==(246&o[n+1])}function P(o,n){return 1&o[n+1]?7:9}function D(o,n){return(3&o[n+3])<<11|o[n+4]<<3|(224&o[n+5])>>>5}function S(o,n){return n+5<o.length}function T(o,n){return n+1<o.length&&k(o,n)}function _(o,n){return S(o,n)&&k(o,n)&&D(o,n)<=o.length-n}function h(o,n){if(T(o,n)){var d=P(o,n);if(n+d>=o.length)return!1;var c=D(o,n);if(c<=d)return!1;var i=n+c;return i===o.length||T(o,i)}return!1}function y(o,n,d,c,i){if(!o.samplerate){var u=R(n,d,c,i);if(!u)return;o.config=u.config,o.samplerate=u.samplerate,o.channelCount=u.channelCount,o.codec=u.codec,o.manifestCodec=u.manifestCodec,F.logger.log("parsed codec:"+o.codec+", rate:"+u.samplerate+", channels:"+u.channelCount)}}function m(o){return 9216e4/o}function l(o,n){var d=P(o,n);if(n+d<=o.length){var c=D(o,n)-d;if(c>0)return{headerLength:d,frameLength:c}}}function a(o,n,d,c,i){var v,E=c+i*m(o.samplerate),f=l(n,d);if(f){var r=f.headerLength,e=r+f.frameLength,s=Math.max(0,d+e-n.length);s?(v=new Uint8Array(e-r)).set(n.subarray(d+r,n.length),0):v=n.subarray(d+r,d+e);var p={unit:v,pts:E};return s||o.samples.push(p),{sample:p,length:e,missing:s}}var g=n.length-d;return(v=new Uint8Array(g)).set(n.subarray(d,n.length),0),{sample:{unit:v,pts:E},length:g,missing:-1}}},"./src/demux/base-audio-demuxer.ts":
/*!*****************************************!*\
          !*** ./src/demux/base-audio-demuxer.ts ***!
          \*****************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>T,initPTSFn:()=>S});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../demux/id3 */
"./src/demux/id3.ts"),b=L(
/*! ../types/demuxer */
"./src/types/demuxer.ts"),R=L(
/*! ./dummy-demuxed-track */
"./src/demux/dummy-demuxed-track.ts"),k=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),P=L(
/*! ../utils/typed-array */
"./src/utils/typed-array.ts"),D=function(){function _(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var h=_.prototype;return h.resetInitSegment=function(m,l,a,o){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},h.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},h.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},h.canParse=function(m,l){return!1},h.appendFrame=function(m,l,a){},h.demux=function(m,l){this.cachedData&&(m=(0,k.appendUint8Array)(this.cachedData,m),this.cachedData=null);var n,a=A.getID3Data(m,0),o=a?a.length:0,d=this._audioTrack,c=this._id3Track,i=a?A.getTimeStamp(a):void 0,u=m.length;for((null===this.basePTS||0===this.frameIndex&&(0,F.isFiniteNumber)(i))&&(this.basePTS=S(i,l,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),a&&a.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});o<u;){if(this.canParse(m,o)){var E=this.appendFrame(d,m,o);E?(this.frameIndex++,this.lastPTS=E.sample.pts,n=o+=E.length):o=u}else A.canParse(m,o)?(a=A.getID3Data(m,o),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),n=o+=a.length):o++;if(o===u&&n!==u){var f=(0,P.sliceUint8)(m,n);this.cachedData=this.cachedData?(0,k.appendUint8Array)(this.cachedData,f):f}}return{audioTrack:d,videoTrack:(0,R.dummyTrack)(),id3Track:c,textTrack:(0,R.dummyTrack)()}},h.demuxSampleAes=function(m,l,a){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},h.flush=function(m){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,R.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,R.dummyTrack)()}},h.destroy=function(){},_}(),S=function(h,y,m){return(0,F.isFiniteNumber)(h)?90*h:9e4*y+(m||0)};const T=D},"./src/demux/chunk-cache.ts":
/*!**********************************!*\
          !*** ./src/demux/chunk-cache.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>F});var F=function(){function b(){this.chunks=[],this.dataLength=0}var R=b.prototype;return R.push=function(P){this.chunks.push(P),this.dataLength+=P.length},R.flush=function(){var S,P=this.chunks;return P.length?(S=1===P.length?P[0]:function A(b,R){for(var k=new Uint8Array(R),P=0,D=0;D<b.length;D++){var S=b[D];k.set(S,P),P+=S.length}return k}(P,this.dataLength),this.reset(),S):new Uint8Array(0)},R.reset=function(){this.chunks.length=0,this.dataLength=0},b}()},"./src/demux/dummy-demuxed-track.ts":
/*!******************************************!*\
          !*** ./src/demux/dummy-demuxed-track.ts ***!
          \******************************************/(Y,B,L)=>{"use strict";function F(A,b){return void 0===A&&(A=""),void 0===b&&(b=9e4),{type:A,id:-1,pid:-1,inputTimeScale:b,sequenceNumber:-1,samples:[],dropped:0}}L.r(B),L.d(B,{dummyTrack:()=>F})},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
          !*** ./src/demux/exp-golomb.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>b});var F=L(
/*! ../utils/logger */
"./src/utils/logger.ts");const b=function(){function R(P){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=P,this.bytesAvailable=P.byteLength,this.word=0,this.bitsAvailable=0}var k=R.prototype;return k.loadWord=function(){var D=this.data,S=this.bytesAvailable,T=D.byteLength-S,_=new Uint8Array(4),h=Math.min(4,S);if(0===h)throw new Error("no bytes available");_.set(D.subarray(T,T+h)),this.word=new DataView(_.buffer).getUint32(0),this.bitsAvailable=8*h,this.bytesAvailable-=h},k.skipBits=function(D){var S;D=Math.min(D,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>D?(this.word<<=D,this.bitsAvailable-=D):(D-=this.bitsAvailable,D-=(S=D>>3)<<3,this.bytesAvailable-=S,this.loadWord(),this.word<<=D,this.bitsAvailable-=D)},k.readBits=function(D){var S=Math.min(this.bitsAvailable,D),T=this.word>>>32-S;if(D>32&&F.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=S,this.bitsAvailable>0)this.word<<=S;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(S=D-S)>0&&this.bitsAvailable?T<<S|this.readBits(S):T},k.skipLZ=function(){var D;for(D=0;D<this.bitsAvailable;++D)if(this.word&2147483648>>>D)return this.word<<=D,this.bitsAvailable-=D,D;return this.loadWord(),D+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var D=this.skipLZ();return this.readBits(D+1)-1},k.readEG=function(){var D=this.readUEG();return 1&D?1+D>>>1:-1*(D>>>1)},k.readBoolean=function(){return 1===this.readBits(1)},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(D){for(var S=8,T=8,h=0;h<D;h++)0!==T&&(T=(S+this.readEG()+256)%256),S=0===T?S:T},k.readSPS=function(){var h,y,m,D=0,S=0,T=0,_=0,l=this.readUByte.bind(this),a=this.readBits.bind(this),o=this.readUEG.bind(this),n=this.readBoolean.bind(this),d=this.skipBits.bind(this),c=this.skipEG.bind(this),i=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);l();var E=l();if(a(5),d(3),l(),i(),100===E||110===E||122===E||244===E||44===E||83===E||86===E||118===E||128===E){var f=o();if(3===f&&d(1),i(),i(),d(1),n())for(y=3!==f?8:12,m=0;m<y;m++)n()&&u(m<6?16:64)}i();var v=o();if(0===v)o();else if(1===v)for(d(1),c(),c(),h=o(),m=0;m<h;m++)c();i(),d(1);var t=o(),r=o(),e=a(1);0===e&&d(1),d(1),n()&&(D=o(),S=o(),T=o(),_=o());var s=[1,1];if(n()&&n())switch(l()){case 1:s=[1,1];break;case 2:s=[12,11];break;case 3:s=[10,11];break;case 4:s=[16,11];break;case 5:s=[40,33];break;case 6:s=[24,11];break;case 7:s=[20,11];break;case 8:s=[32,11];break;case 9:s=[80,33];break;case 10:s=[18,11];break;case 11:s=[15,11];break;case 12:s=[64,33];break;case 13:s=[160,99];break;case 14:s=[4,3];break;case 15:s=[3,2];break;case 16:s=[2,1];break;case 255:s=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(t+1)-2*D-2*S),height:(2-e)*(r+1)*16-(e?2:4)*(T+_),pixelRatio:s}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},R}()},"./src/demux/id3.ts":
/*!**************************!*\
          !*** ./src/demux/id3.ts ***!
          \**************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{canParse:()=>k,decodeFrame:()=>_,getID3Data:()=>b,getID3Frames:()=>T,getTimeStamp:()=>P,isFooter:()=>A,isHeader:()=>F,isTimeStampFrame:()=>D,testables:()=>o,utf8ArrayToStr:()=>a});var n,F=function(i,u){return u+10<=i.length&&73===i[u]&&68===i[u+1]&&51===i[u+2]&&i[u+3]<255&&i[u+4]<255&&i[u+6]<128&&i[u+7]<128&&i[u+8]<128&&i[u+9]<128},A=function(i,u){return u+10<=i.length&&51===i[u]&&68===i[u+1]&&73===i[u+2]&&i[u+3]<255&&i[u+4]<255&&i[u+6]<128&&i[u+7]<128&&i[u+8]<128&&i[u+9]<128},b=function(i,u){for(var E=u,f=0;F(i,u);)f+=10,f+=R(i,u+6),A(i,u+10)&&(f+=10),u+=f;if(f>0)return i.subarray(E,E+f)},R=function(i,u){var E=0;return E=(127&i[u])<<21,E|=(127&i[u+1])<<14,(E|=(127&i[u+2])<<7)|127&i[u+3]},k=function(i,u){return F(i,u)&&R(i,u+6)+10<=i.length-u},P=function(i){for(var u=T(i),E=0;E<u.length;E++){var f=u[E];if(D(f))return l(f)}},D=function(i){return i&&"PRIV"===i.key&&"com.apple.streaming.transportStreamTimestamp"===i.info},S=function(i){var u=String.fromCharCode(i[0],i[1],i[2],i[3]),E=R(i,4);return{type:u,size:E,data:i.subarray(10,10+E)}},T=function(i){for(var u=0,E=[];F(i,u);){for(var f=R(i,u+6),v=(u+=10)+f;u+8<v;){var t=S(i.subarray(u)),r=_(t);r&&E.push(r),u+=t.size+10}A(i,u)&&(u+=10)}return E},_=function(i){return"PRIV"===i.type?h(i):"W"===i.type[0]?m(i):y(i)},h=function(i){if(!(i.size<2)){var u=a(i.data,!0),E=new Uint8Array(i.data.subarray(u.length+1));return{key:i.type,info:u,data:E.buffer}}},y=function(i){if(!(i.size<2)){if("TXXX"===i.type){var u=1,E=a(i.data.subarray(u),!0),f=a(i.data.subarray(u+=E.length+1));return{key:i.type,info:E,data:f}}var v=a(i.data.subarray(1));return{key:i.type,data:v}}},m=function(i){if("WXXX"===i.type){if(i.size<2)return;var u=1,E=a(i.data.subarray(u),!0),f=a(i.data.subarray(u+=E.length+1));return{key:i.type,info:E,data:f}}var v=a(i.data);return{key:i.type,data:v}},l=function(i){if(8===i.data.byteLength){var u=new Uint8Array(i.data),f=(u[4]<<23)+(u[5]<<15)+(u[6]<<7)+u[7];return f/=45,1&u[3]&&(f+=47721858.84),Math.round(f)}},a=function(i,u){void 0===u&&(u=!1);var E=function d(){return!n&&typeof self.TextDecoder<"u"&&(n=new self.TextDecoder("utf-8")),n}();if(E){var f=E.decode(i);if(u){var v=f.indexOf("\0");return-1!==v?f.substring(0,v):f}return f.replace(/\0/g,"")}for(var r,e,s,t=i.length,p="",g=0;g<t;){if(0===(r=i[g++])&&u)return p;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:p+=String.fromCharCode(r);break;case 12:case 13:e=i[g++],p+=String.fromCharCode((31&r)<<6|63&e);break;case 14:e=i[g++],s=i[g++],p+=String.fromCharCode((15&r)<<12|(63&e)<<6|(63&s)<<0)}}return p},o={decodeTextFrame:y}},"./src/demux/mp3demuxer.ts":
/*!*********************************!*\
          !*** ./src/demux/mp3demuxer.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>S});var F=L(
/*! ./base-audio-demuxer */
"./src/demux/base-audio-demuxer.ts"),A=L(
/*! ../demux/id3 */
"./src/demux/id3.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),R=L(
/*! ./mpegaudio */
"./src/demux/mpegaudio.ts");function P(T,_){return(P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,m){return y.__proto__=m,y})(T,_)}const S=function(T){function _(){return T.apply(this,arguments)||this}!function k(T,_){T.prototype=Object.create(_.prototype),T.prototype.constructor=T,P(T,_)}(_,T);var h=_.prototype;return h.resetInitSegment=function(m,l,a,o){T.prototype.resetInitSegment.call(this,m,l,a,o),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:o,inputTimeScale:9e4,dropped:0}},_.probe=function(m){if(!m)return!1;for(var a=(A.getID3Data(m,0)||[]).length,o=m.length;a<o;a++)if(R.probe(m,a))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},h.canParse=function(m,l){return R.canParse(m,l)},h.appendFrame=function(m,l,a){if(null!==this.basePTS)return R.appendFrame(m,l,a,this.basePTS,this.frameIndex)},_}(F.default)},"./src/demux/mp4demuxer.ts":
/*!*********************************!*\
          !*** ./src/demux/mp4demuxer.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>D});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../types/demuxer */
"./src/types/demuxer.ts"),b=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),R=L(
/*! ./dummy-demuxed-track */
"./src/demux/dummy-demuxed-track.ts"),k=/\/emsg[-/]ID3/i;const D=function(){function S(_,h){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=h}var T=S.prototype;return T.resetTimeStamp=function(){},T.resetInitSegment=function(h,y,m,l){var a=this.videoTrack=(0,R.dummyTrack)("video",1),o=this.audioTrack=(0,R.dummyTrack)("audio",1),n=this.txtTrack=(0,R.dummyTrack)("text",1);if(this.id3Track=(0,R.dummyTrack)("id3",1),this.timeOffset=0,h&&h.byteLength){var d=(0,b.parseInitSegment)(h);if(d.video){var c=d.video,u=c.timescale,E=c.codec;a.id=c.id,a.timescale=n.timescale=u,a.codec=E}if(d.audio){var f=d.audio,t=f.timescale,r=f.codec;o.id=f.id,o.timescale=t,o.codec=r}n.id=b.RemuxerTrackIdConfig.text,a.sampleDuration=0,a.duration=o.duration=l}},T.resetContiguity=function(){},S.probe=function(h){return h=h.length>16384?h.subarray(0,16384):h,(0,b.findBox)(h,["moof"]).length>0},T.demux=function(h,y){this.timeOffset=y;var m=h,l=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=(0,b.appendUint8Array)(this.remainderData,h));var o=(0,b.segmentValidRange)(m);this.remainderData=o.remainder,l.samples=o.valid||new Uint8Array}else l.samples=m;var n=this.extractID3Track(l,y);return a.samples=(0,b.parseSamples)(y,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}},T.flush=function(){var h=this.timeOffset,y=this.videoTrack,m=this.txtTrack;y.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(y,this.timeOffset);return m.samples=(0,b.parseSamples)(h,y),{videoTrack:y,audioTrack:(0,R.dummyTrack)(),id3Track:l,textTrack:(0,R.dummyTrack)()}},T.extractID3Track=function(h,y){var m=this.id3Track;if(h.samples.length){var l=(0,b.findBox)(h.samples,["emsg"]);l&&l.forEach(function(a){var o=(0,b.parseEmsg)(a);if(k.test(o.schemeIdUri)){var n=(0,F.isFiniteNumber)(o.presentationTime)?o.presentationTime/o.timeScale:y+o.presentationTimeDelta/o.timeScale,d=4294967295===o.eventDuration?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var c=o.payload;m.samples.push({data:c,len:c.byteLength,dts:n,pts:n,type:A.MetadataSchema.emsg,duration:d})}})}return m},T.demuxSampleAes=function(h,y,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},T.destroy=function(){},S}()},"./src/demux/mpegaudio.ts":
/*!********************************!*\
          !*** ./src/demux/mpegaudio.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{appendFrame:()=>P,canParse:()=>_,isHeader:()=>T,isHeaderPattern:()=>S,parseHeader:()=>D,probe:()=>h});var F=null,A=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],k=[0,1,1,4];function P(y,m,l,a,o){if(!(l+24>m.length)){var n=D(m,l);if(n&&l+n.frameLength<=m.length){var c=a+o*(9e4*n.samplesPerFrame/n.sampleRate),i={unit:m.subarray(l,l+n.frameLength),pts:c,dts:c};return y.config=[],y.channelCount=n.channelCount,y.samplerate=n.sampleRate,y.samples.push(i),{sample:i,length:n.frameLength,missing:0}}}}function D(y,m){var l=y[m+1]>>3&3,a=y[m+1]>>1&3,o=y[m+2]>>4&15,n=y[m+2]>>2&3;if(1!==l&&0!==o&&15!==o&&3!==n){var c=y[m+3]>>6,u=1e3*A[14*(3===l?3-a:3===a?3:4)+o-1],f=b[3*(3===l?0:2===l?1:2)+n],v=3===c?1:2,t=R[l][a],r=k[a],e=8*t*r,s=Math.floor(t*u/f+(y[m+2]>>1&1))*r;if(null===F){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);F=g?parseInt(g[1]):0}return!!F&&F<=87&&2===a&&u>=224e3&&0===c&&(y[m+3]=128|y[m+3]),{sampleRate:f,channelCount:v,frameLength:s,samplesPerFrame:e}}}function S(y,m){return 255===y[m]&&224==(224&y[m+1])&&0!=(6&y[m+1])}function T(y,m){return m+1<y.length&&S(y,m)}function _(y,m){return S(y,m)&&4<=y.length-m}function h(y,m){if(m+1<y.length&&S(y,m)){var a=D(y,m),o=4;null!=a&&a.frameLength&&(o=a.frameLength);var n=m+o;return n===y.length||T(y,n)}return!1}},"./src/demux/sample-aes.ts":
/*!*********************************!*\
          !*** ./src/demux/sample-aes.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>R});var F=L(
/*! ../crypt/decrypter */
"./src/crypt/decrypter.ts"),A=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts");const R=function(){function k(D,S,T){this.keyData=void 0,this.decrypter=void 0,this.keyData=T,this.decrypter=new F.default(S,{removePKCS7Padding:!1})}var P=k.prototype;return P.decryptBuffer=function(S){return this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer)},P.decryptAacSample=function(S,T,_){var h=this,y=S[T].unit;if(!(y.length<=16)){var m=y.subarray(16,y.length-y.length%16),l=m.buffer.slice(m.byteOffset,m.byteOffset+m.length);this.decryptBuffer(l).then(function(a){var o=new Uint8Array(a);y.set(o,16),h.decrypter.isSync()||h.decryptAacSamples(S,T+1,_)})}},P.decryptAacSamples=function(S,T,_){for(;;T++){if(T>=S.length)return void _();if(!(S[T].unit.length<32||(this.decryptAacSample(S,T,_),this.decrypter.isSync())))return}},P.getAvcEncryptedData=function(S){for(var T=16*Math.floor((S.length-48)/160)+16,_=new Int8Array(T),h=0,y=32;y<S.length-16;y+=160,h+=16)_.set(S.subarray(y,y+16),h);return _},P.getAvcDecryptedUnit=function(S,T){for(var _=new Uint8Array(T),h=0,y=32;y<S.length-16;y+=160,h+=16)S.set(_.subarray(h,h+16),y);return S},P.decryptAvcSample=function(S,T,_,h,y){var m=this,l=(0,A.discardEPB)(y.data),a=this.getAvcEncryptedData(l);this.decryptBuffer(a.buffer).then(function(o){y.data=m.getAvcDecryptedUnit(l,o),m.decrypter.isSync()||m.decryptAvcSamples(S,T,_+1,h)})},P.decryptAvcSamples=function(S,T,_,h){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,_=0){if(T>=S.length)return void h();for(var y=S[T].units;!(_>=y.length);_++){var m=y[_];if(!(m.data.length<=48||1!==m.type&&5!==m.type||(this.decryptAvcSample(S,T,_,h,m),this.decrypter.isSync())))return}}},k}()},"./src/demux/transmuxer-interface.ts":
/*!*******************************************!*\
          !*** ./src/demux/transmuxer-interface.ts ***!
          \*******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>_});var F=L(
/*! ./webworkify-webpack */
"./src/demux/webworkify-webpack.js"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../demux/transmuxer */
"./src/demux/transmuxer.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),k=L(
/*! ../errors */
"./src/errors.ts"),P=L(
/*! ../utils/mediasource-helper */
"./src/utils/mediasource-helper.ts"),D=L(
/*! eventemitter3 */
"./node_modules/eventemitter3/index.js"),T=(0,P.getMediaSource)()||{isTypeSupported:function(){return!1}},_=function(){function h(m,l,a,o){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var d=m.config;this.hls=m,this.id=l,this.useWorker=!!d.enableWorker,this.onTransmuxComplete=a,this.onFlush=o;var c=function(v,t){(t=t||{}).frag=n.frag,t.id=n.id,n.hls.trigger(v,t)};this.observer=new D.EventEmitter,this.observer.on(A.Events.FRAG_DECRYPTED,c),this.observer.on(A.Events.ERROR,c);var i={mp4:T.isTypeSupported("video/mp4"),mpeg:T.isTypeSupported("audio/mpeg"),mp3:T.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){var E;R.logger.log("demuxing in webworker");try{E=this.worker=(0,F.default)(
/*! ../demux/transmuxer-worker.ts */
"./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(f){n.useWorker=!1,R.logger.warn("Exception in webworker, fallback to inline"),n.hls.trigger(A.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(f.message+"  ("+f.filename+":"+f.lineno+")")})},E.postMessage({cmd:"init",typeSupported:i,vendor:u,id:l,config:JSON.stringify(d)})}catch(f){R.logger.warn("Error in worker:",f),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new b.default(this.observer,i,d,u,l),this.worker=null}}else this.transmuxer=new b.default(this.observer,i,d,u,l)}var y=h.prototype;return y.destroy=function(){var l=this.worker;if(l)l.removeEventListener("message",this.onwmsg),l.terminate(),this.worker=null,this.onwmsg=void 0;else{var a=this.transmuxer;a&&(a.destroy(),this.transmuxer=null)}var o=this.observer;o&&o.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},y.push=function(l,a,o,n,d,c,i,u,E,f){var v,t,r=this;E.transmuxing.start=self.performance.now();var e=this.transmuxer,s=this.worker,p=c?c.start:d.start,g=d.decryptdata,x=this.frag,O=!(x&&d.cc===x.cc),I=!(x&&E.level===x.level),C=x?E.sn-x.sn:-1,M=this.part?E.part-this.part.index:-1,w=!I&&(1===C||0===C&&(1===M||0===C&&E.id>1&&E.id===x?.stats.chunkCount&&M<=0)),K=self.performance.now();(I||C||0===d.stats.parsing.start)&&(d.stats.parsing.start=K),c&&(M||!w)&&(c.stats.parsing.start=K);var N=!(x&&(null===(v=d.initSegment)||void 0===v?void 0:v.url)===(null===(t=x.initSegment)||void 0===t?void 0:t.url)),W=new b.TransmuxState(O,w,u,I,p,N);if(!w||O||N){R.logger.log("[transmuxer-interface, "+d.type+"]: Starting new transmux session for sn: "+E.sn+" p: "+E.part+" level: "+E.level+" id: "+E.id+"\n        discontinuity: "+O+"\n        trackSwitch: "+I+"\n        contiguous: "+w+"\n        accurateTimeOffset: "+u+"\n        timeOffset: "+p+"\n        initSegmentChange: "+N);var G=new b.TransmuxConfig(o,n,a,i,f);this.configureTransmuxer(G)}if(this.frag=d,this.part=c,s)s.postMessage({cmd:"demux",data:l,decryptdata:g,chunkMeta:E,state:W},l instanceof ArrayBuffer?[l]:[]);else if(e){var V=e.push(l,g,E,W);(0,b.isPromise)(V)?(e.async=!0,V.then(function(H){r.handleTransmuxComplete(H)}).catch(function(H){r.transmuxerError(H,E,"transmuxer-interface push error")})):(e.async=!1,this.handleTransmuxComplete(V))}},y.flush=function(l){var a=this;l.transmuxing.start=self.performance.now();var o=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:l});else if(o){var d=o.flush(l);(0,b.isPromise)(d)||o.async?((0,b.isPromise)(d)||(d=Promise.resolve(d)),d.then(function(i){a.handleFlushResult(i,l)}).catch(function(i){a.transmuxerError(i,l,"transmuxer-interface flush error")})):this.handleFlushResult(d,l)}},y.transmuxerError=function(l,a,o){this.hls&&this.hls.trigger(A.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:a,fatal:!1,error:l,err:l,reason:o})},y.handleFlushResult=function(l,a){var o=this;l.forEach(function(n){o.handleTransmuxComplete(n)}),this.onFlush(a)},y.onWorkerMessage=function(l){var a=l.data,o=this.hls;switch(a.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(a.data);break;case"flush":this.onFlush(a.data);break;case"workerLog":R.logger[a.data.logType]&&R.logger[a.data.logType](a.data.message);break;default:a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,o.trigger(a.event,a.data)}},y.configureTransmuxer=function(l){var a=this.worker,o=this.transmuxer;a?a.postMessage({cmd:"configure",config:l}):o&&o.configure(l)},y.handleTransmuxComplete=function(l){l.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(l)},h}()},"./src/demux/transmuxer-worker.ts":
/*!****************************************!*\
          !*** ./src/demux/transmuxer-worker.ts ***!
          \****************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>D});var F=L(
/*! ../demux/transmuxer */
"./src/demux/transmuxer.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),R=L(
/*! eventemitter3 */
"./node_modules/eventemitter3/index.js"),P=L(
/*! ../errors */
"./src/errors.ts");function D(y){var m=new R.EventEmitter,l=function(n,d){y.postMessage({event:n,data:d})};m.on(A.Events.FRAG_DECRYPTED,l),m.on(A.Events.ERROR,l),y.addEventListener("message",function(o){var n=o.data;switch(n.cmd){case"init":var d=JSON.parse(n.config);y.transmuxer=new F.default(m,n.typeSupported,d,n.vendor,n.id),(0,b.enableLogs)(d.debug,n.id),function(){var n=function(i){b.logger[i]=function(f){l("workerLog",{logType:i,message:f})}};for(var d in b.logger)n(d)}(),l("init",null);break;case"configure":y.transmuxer.configure(n.config);break;case"demux":var c=y.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);(0,F.isPromise)(c)?(y.transmuxer.async=!0,c.then(function(f){S(y,f)}).catch(function(f){l(A.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:n.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker push error"})})):(y.transmuxer.async=!1,S(y,c));break;case"flush":var i=n.chunkMeta,u=y.transmuxer.flush(i);(0,F.isPromise)(u)||y.transmuxer.async?((0,F.isPromise)(u)||(u=Promise.resolve(u)),u.then(function(f){_(y,f,i)}).catch(function(f){l(A.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:n.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker flush error"})})):_(y,u,i)}})}function S(y,m){if(function h(y){return!(y.audio||y.video||y.text||y.id3||y.initSegment)}(m.remuxResult))return!1;var l=[],a=m.remuxResult,o=a.audio,n=a.video;return o&&T(l,o),n&&T(l,n),y.postMessage({event:"transmuxComplete",data:m},l),!0}function T(y,m){m.data1&&y.push(m.data1.buffer),m.data2&&y.push(m.data2.buffer)}function _(y,m,l){m.reduce(function(o,n){return S(y,n)||o},!1)||y.postMessage({event:"transmuxComplete",data:m[0]}),y.postMessage({event:"flush",data:l})}},"./src/demux/transmuxer.ts":
/*!*********************************!*\
          !*** ./src/demux/transmuxer.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{TransmuxConfig:()=>n,TransmuxState:()=>d,default:()=>m,isPromise:()=>o});var h,F=L(
/*! ../events */
"./src/events.ts"),A=L(
/*! ../errors */
"./src/errors.ts"),b=L(
/*! ../crypt/decrypter */
"./src/crypt/decrypter.ts"),R=L(
/*! ../demux/aacdemuxer */
"./src/demux/aacdemuxer.ts"),k=L(
/*! ../demux/mp4demuxer */
"./src/demux/mp4demuxer.ts"),P=L(
/*! ../demux/tsdemuxer */
"./src/demux/tsdemuxer.ts"),D=L(
/*! ../demux/mp3demuxer */
"./src/demux/mp3demuxer.ts"),S=L(
/*! ../remux/mp4-remuxer */
"./src/remux/mp4-remuxer.ts"),T=L(
/*! ../remux/passthrough-remuxer */
"./src/remux/passthrough-remuxer.ts"),_=L(
/*! ../utils/logger */
"./src/utils/logger.ts");try{h=self.performance.now.bind(self.performance)}catch{_.logger.debug("Unable to use Performance API on this environment"),h=self.Date.now}var y=[{demux:k.default,remux:T.default},{demux:P.default,remux:S.default},{demux:R.default,remux:S.default},{demux:D.default,remux:S.default}],m=function(){function c(u,E,f,v,t){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=u,this.typeSupported=E,this.config=f,this.vendor=v,this.id=t}var i=c.prototype;return i.configure=function(E){this.transmuxConfig=E,this.decrypter&&this.decrypter.reset()},i.push=function(E,f,v,t){var r=this,e=v.transmuxing;e.executeStart=h();var s=new Uint8Array(E),p=this.currentTransmuxState,g=this.transmuxConfig;t&&(this.currentTransmuxState=t);var x=t||p,O=x.contiguous,I=x.discontinuity,C=x.trackSwitch,M=x.accurateTimeOffset,U=x.timeOffset,w=x.initSegmentChange,K=g.audioCodec,N=g.videoCodec,W=g.defaultInitPts,G=g.duration,V=g.initSegmentData,H=function l(c,i){var u=null;return c.byteLength>0&&null!=i&&null!=i.key&&null!==i.iv&&null!=i.method&&(u=i),u}(s,f);if(H&&"AES-128"===H.method){var j=this.getDecrypter();if(!j.isSync())return this.decryptionPromise=j.webCryptoDecrypt(s,H.key.buffer,H.iv.buffer).then(function(J){var q=r.push(J,null,v);return r.decryptionPromise=null,q}),this.decryptionPromise;var X=j.softwareDecrypt(s,H.key.buffer,H.iv.buffer);if(v.part>-1&&(X=j.flush()),!X)return e.executeEnd=h(),a(v);s=new Uint8Array(X)}var Q=this.needsProbing(I,C);Q&&this.configureTransmuxer(s),(I||C||w||Q)&&this.resetInitSegment(V,K,N,G,f),(I||w||Q)&&this.resetInitialTimestamp(W),O||this.resetContiguity();var z=this.transmux(s,H,U,M,v),$=this.currentTransmuxState;return $.contiguous=!0,$.discontinuity=!1,$.trackSwitch=!1,e.executeEnd=h(),z},i.flush=function(E){var f=this,v=E.transmuxing;v.executeStart=h();var t=this.decrypter,r=this.currentTransmuxState,e=this.decryptionPromise;if(e)return e.then(function(){return f.flush(E)});var s=[],p=r.timeOffset;if(t){var g=t.flush();g&&s.push(this.push(g,null,E))}var x=this.demuxer;if(!x||!this.remuxer)return this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=h(),[a(E)];var I=x.flush(p);return o(I)?I.then(function(C){return f.flushRemux(s,C,E),s}):(this.flushRemux(s,I,E),s)},i.flushRemux=function(E,f,v){var t=f.audioTrack,r=f.videoTrack,e=f.id3Track,s=f.textTrack,p=this.currentTransmuxState,g=p.accurateTimeOffset,x=p.timeOffset;_.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var O=this.remuxer.remux(t,r,e,s,x,g,!0,this.id);E.push({remuxResult:O,chunkMeta:v}),v.transmuxing.executeEnd=h()},i.resetInitialTimestamp=function(E){var f=this.demuxer,v=this.remuxer;!f||!v||(f.resetTimeStamp(E),v.resetTimeStamp(E))},i.resetContiguity=function(){var E=this.demuxer,f=this.remuxer;!E||!f||(E.resetContiguity(),f.resetNextTimestamp())},i.resetInitSegment=function(E,f,v,t,r){var e=this.demuxer,s=this.remuxer;!e||!s||(e.resetInitSegment(E,f,v,t),s.resetInitSegment(E,f,v,r))},i.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},i.transmux=function(E,f,v,t,r){return f&&"SAMPLE-AES"===f.method?this.transmuxSampleAes(E,f,v,t,r):this.transmuxUnencrypted(E,v,t,r)},i.transmuxUnencrypted=function(E,f,v,t){var r=this.demuxer.demux(E,f,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r.audioTrack,r.videoTrack,r.id3Track,r.textTrack,f,v,!1,this.id),chunkMeta:t}},i.transmuxSampleAes=function(E,f,v,t,r){var e=this;return this.demuxer.demuxSampleAes(E,f,v).then(function(s){return{remuxResult:e.remuxer.remux(s.audioTrack,s.videoTrack,s.id3Track,s.textTrack,v,t,!1,e.id),chunkMeta:r}})},i.configureTransmuxer=function(E){for(var e,f=this.config,v=this.observer,t=this.typeSupported,r=this.vendor,s=0,p=y.length;s<p;s++)if(y[s].demux.probe(E)){e=y[s];break}e||(_.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:k.default,remux:T.default});var g=this.demuxer,x=this.remuxer,O=e.remux,I=e.demux;(!x||!(x instanceof O))&&(this.remuxer=new O(v,f,t,r)),(!g||!(g instanceof I))&&(this.demuxer=new I(v,f,t),this.probe=I.probe)},i.needsProbing=function(E,f){return!this.demuxer||!this.remuxer||E||f},i.getDecrypter=function(){var E=this.decrypter;return E||(E=this.decrypter=new b.default(this.config)),E},c}(),a=function(i){return{remuxResult:{},chunkMeta:i}};function o(c){return"then"in c&&c.then instanceof Function}var n=function(i,u,E,f,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=i,this.videoCodec=u,this.initSegmentData=E,this.duration=f,this.defaultInitPts=v},d=function(i,u,E,f,v,t){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=i,this.contiguous=u,this.accurateTimeOffset=E,this.trackSwitch=f,this.timeOffset=v,this.initSegmentChange=t}},"./src/demux/tsdemuxer.ts":
/*!********************************!*\
          !*** ./src/demux/tsdemuxer.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>c});var F=L(
/*! ./adts */
"./src/demux/adts.ts"),A=L(
/*! ./mpegaudio */
"./src/demux/mpegaudio.ts"),b=L(
/*! ./exp-golomb */
"./src/demux/exp-golomb.ts"),R=L(
/*! ./sample-aes */
"./src/demux/sample-aes.ts"),k=L(
/*! ../events */
"./src/events.ts"),P=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),D=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),S=L(
/*! ../errors */
"./src/errors.ts"),T=L(
/*! ../types/demuxer */
"./src/types/demuxer.ts");function _(){return _=Object.assign?Object.assign.bind():function(i){for(var u=1;u<arguments.length;u++){var E=arguments[u];for(var f in E)Object.prototype.hasOwnProperty.call(E,f)&&(i[f]=E[f])}return i},_.apply(this,arguments)}var h=188;function m(i,u,E,f){return{key:i,frame:!1,pts:u,dts:E,units:[],debug:f,length:0}}function l(i,u){return((31&i[u+1])<<8)+i[u+2]}function a(i,u){return(31&i[u+10])<<8|i[u+11]}function o(i,u,E,f){var v={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},r=u+3+((15&i[u+1])<<8|i[u+2])-4;for(u+=12+((15&i[u+10])<<8|i[u+11]);u<r;){var s=l(i,u);switch(i[u]){case 207:if(!f){D.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===v.audio&&(v.audio=s);break;case 21:-1===v.id3&&(v.id3=s);break;case 219:if(!f){D.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===v.avc&&(v.avc=s);break;case 3:case 4:!0!==E.mpeg&&!0!==E.mp3?D.logger.log("MPEG audio found, not supported in this browser"):-1===v.audio&&(v.audio=s,v.segmentCodec="mp3");break;case 36:D.logger.warn("Unsupported HEVC stream type found")}u+=5+((15&i[u+3])<<8|i[u+4])}return v}function n(i){var E,f,v,t,r,u=0,e=i.data;if(!i||0===i.size)return null;for(;e[0].length<19&&e.length>1;){var s=new Uint8Array(e[0].length+e[1].length);s.set(e[0]),s.set(e[1],e[0].length),e[0]=s,e.splice(1,1)}if(1===((E=e[0])[0]<<16)+(E[1]<<8)+E[2]){if((f=(E[4]<<8)+E[5])&&f>i.size-6)return null;var g=E[7];192&g&&(t=536870912*(14&E[9])+4194304*(255&E[10])+16384*(254&E[11])+128*(255&E[12])+(254&E[13])/2,64&g?t-(r=536870912*(14&E[14])+4194304*(255&E[15])+16384*(254&E[16])+128*(255&E[17])+(254&E[18])/2)>54e5&&(D.logger.warn(Math.round((t-r)/9e4)+"s delta between PTS and DTS, align them"),t=r):r=t);var x=(v=E[8])+9;if(i.size<=x)return null;i.size-=x;for(var O=new Uint8Array(i.size),I=0,C=e.length;I<C;I++){var M=(E=e[I]).byteLength;if(x){if(x>M){x-=M;continue}E=E.subarray(x),M-=x,x=0}O.set(E,u),u+=M}return f&&(f-=v+3),{data:O,pts:t,dts:r,len:f}}return null}function d(i,u){if(i.units.length&&i.frame){if(void 0===i.pts){var E=u.samples,f=E.length;if(!f)return void u.dropped++;var v=E[f-1];i.pts=v.pts,i.dts=v.dts}u.samples.push(i)}i.debug.length&&D.logger.log(i.pts+"/"+i.dts+":"+i.debug)}const c=function(){function i(E,f,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=E,this.config=f,this.typeSupported=v}i.probe=function(f){var v=i.syncOffset(f);return v>0&&D.logger.warn("MPEG2-TS detected but first sync word found @ offset "+v),-1!==v},i.syncOffset=function(f){for(var v=f.length,t=Math.min(940,f.length-h)+1,r=0;r<t;){for(var e=!1,s=r;s<v&&71===f[s];s+=h)if(!e&&0===l(f,s)&&(e=!0),e&&s+h>t)return r;r++}return-1},i.createTrack=function(f,v){return{container:"video"===f||"audio"===f?"video/mp2t":void 0,type:f,id:P.RemuxerTrackIdConfig[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===f?v:void 0}};var u=i.prototype;return u.resetInitSegment=function(f,v,t,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=i.createTrack("video"),this._audioTrack=i.createTrack("audio",r),this._id3Track=i.createTrack("id3"),this._txtTrack=i.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=v,this.videoCodec=t,this._duration=r},u.resetTimeStamp=function(){},u.resetContiguity=function(){var f=this._audioTrack,v=this._avcTrack,t=this._id3Track;f&&(f.pesData=null),v&&(v.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},u.demux=function(f,v,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1),t||(this.sampleAes=null);var e,s=this._avcTrack,p=this._audioTrack,g=this._id3Track,x=this._txtTrack,O=s.pid,I=s.pesData,C=p.pid,M=g.pid,U=p.pesData,w=g.pesData,K=null,N=this.pmtParsed,W=this._pmtId,G=f.length;if(this.remainderData&&(G=(f=(0,P.appendUint8Array)(this.remainderData,f)).length,this.remainderData=null),G<h&&!r)return this.remainderData=f,{audioTrack:p,videoTrack:s,id3Track:g,textTrack:x};var V=Math.max(0,i.syncOffset(f));(G-=(G-V)%h)<f.byteLength&&!r&&(this.remainderData=new Uint8Array(f.buffer,G,f.buffer.byteLength-G));for(var H=0,j=V;j<G;j+=h)if(71===f[j]){var X=!!(64&f[j+1]),Z=l(f,j),z=void 0;if((48&f[j+3])>>4>1){if((z=j+5+f[j+4])===j+h)continue}else z=j+4;switch(Z){case O:X&&(I&&(e=n(I))&&this.parseAVCPES(s,x,e,!1),I={data:[],size:0}),I&&(I.data.push(f.subarray(z,j+h)),I.size+=j+h-z);break;case C:if(X){if(U&&(e=n(U)))switch(p.segmentCodec){case"aac":this.parseAACPES(p,e);break;case"mp3":this.parseMPEGPES(p,e)}U={data:[],size:0}}U&&(U.data.push(f.subarray(z,j+h)),U.size+=j+h-z);break;case M:X&&(w&&(e=n(w))&&this.parseID3PES(g,e),w={data:[],size:0}),w&&(w.data.push(f.subarray(z,j+h)),w.size+=j+h-z);break;case 0:X&&(z+=f[z]+1),W=this._pmtId=a(f,z);break;case W:X&&(z+=f[z]+1);var $=o(f,z,this.typeSupported,t);(O=$.avc)>0&&(s.pid=O),(C=$.audio)>0&&(p.pid=C,p.segmentCodec=$.segmentCodec),(M=$.id3)>0&&(g.pid=M),null!==K&&!N&&(D.logger.warn("MPEG-TS PMT found at "+j+" after unknown PID '"+K+"'. Backtracking to sync byte @"+V+" to parse all TS packets."),K=null,j=V-188),N=this.pmtParsed=!0;break;case 17:case 8191:break;default:K=Z}}else H++;H>0&&this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+H+" TS packet/s that do not start with 0x47"}),s.pesData=I,p.pesData=U,g.pesData=w;var J={audioTrack:p,videoTrack:s,id3Track:g,textTrack:x};return r&&this.extractRemainingSamples(J),J},u.flush=function(){var v,f=this.remainderData;return this.remainderData=null,v=f?this.demux(f,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},u.extractRemainingSamples=function(f){var x,v=f.audioTrack,t=f.videoTrack,r=f.id3Track,e=f.textTrack,s=t.pesData,p=v.pesData,g=r.pesData;if(s&&(x=n(s))?(this.parseAVCPES(t,e,x,!0),t.pesData=null):t.pesData=s,p&&(x=n(p))){switch(v.segmentCodec){case"aac":this.parseAACPES(v,x);break;case"mp3":this.parseMPEGPES(v,x)}v.pesData=null}else null!=p&&p.size&&D.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=p;g&&(x=n(g))?(this.parseID3PES(r,x),r.pesData=null):r.pesData=g},u.demuxSampleAes=function(f,v,t){var r=this.demux(f,t,!0,!this.config.progressive),e=this.sampleAes=new R.default(this.observer,this.config,v);return this.decrypt(r,e)},u.decrypt=function(f,v){return new Promise(function(t){var r=f.audioTrack,e=f.videoTrack;r.samples&&"aac"===r.segmentCodec?v.decryptAacSamples(r.samples,0,function(){e.samples?v.decryptAvcSamples(e.samples,0,0,function(){t(f)}):t(f)}):e.samples&&v.decryptAvcSamples(e.samples,0,0,function(){t(f)})})},u.destroy=function(){this._duration=0},u.parseAVCPES=function(f,v,t,r){var x,e=this,s=this.parseAVCNALu(f,t.data),g=this.avcSample,O=!1;t.data=null,g&&s.length&&!f.audFound&&(d(g,f),g=this.avcSample=m(!1,t.pts,t.dts,"")),s.forEach(function(I){switch(I.type){case 1:x=!0,g||(g=e.avcSample=m(!0,t.pts,t.dts,"")),g.frame=!0;var C=I.data;if(O&&C.length>4){var M=new b.default(C).readSliceType();(2===M||4===M||7===M||9===M)&&(g.key=!0)}break;case 5:x=!0,g||(g=e.avcSample=m(!0,t.pts,t.dts,"")),g.key=!0,g.frame=!0;break;case 6:x=!0,(0,P.parseSEIMessageFromNALu)(I.data,1,t.pts,v.samples);break;case 7:if(x=!0,O=!0,!f.sps){var w=new b.default(I.data).readSPS();f.width=w.width,f.height=w.height,f.pixelRatio=w.pixelRatio,f.sps=[I.data],f.duration=e._duration;for(var K=I.data.subarray(1,4),N="avc1.",W=0;W<3;W++){var G=K[W].toString(16);G.length<2&&(G="0"+G),N+=G}f.codec=N}break;case 8:x=!0,f.pps||(f.pps=[I.data]);break;case 9:x=!1,f.audFound=!0,g&&d(g,f),g=e.avcSample=m(!1,t.pts,t.dts,"");break;case 12:x=!0;break;default:x=!1,g&&(g.debug+="unknown NAL "+I.type+" ")}g&&x&&g.units.push(I)}),r&&g&&(d(g,f),this.avcSample=null)},u.getLastNalUnit=function(f){var v,r,t=this.avcSample;if((!t||0===t.units.length)&&(t=f[f.length-1]),null!==(v=t)&&void 0!==v&&v.units){var e=t.units;r=e[e.length-1]}return r},u.parseAVCNALu=function(f,v){var g,x,t=v.byteLength,r=f.naluState||0,e=r,s=[],p=0,I=-1,C=0;for(-1===r&&(I=0,C=31&v[0],r=0,p=1);p<t;)if(g=v[p++],r)if(1!==r)if(g)if(1===g){if(I>=0){var M={data:v.subarray(I,p-r-1),type:C};s.push(M)}else{var U=this.getLastNalUnit(f.samples);if(U&&(e&&p<=4-e&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-e)),(x=p-r-1)>0)){var w=new Uint8Array(U.data.byteLength+x);w.set(U.data,0),w.set(v.subarray(0,x),U.data.byteLength),U.data=w,U.state=0}}p<t?(I=p,C=31&v[p],r=0):r=-1}else r=0;else r=3;else r=g?0:2;else r=g?0:1;if(I>=0&&r>=0){var K={data:v.subarray(I,t),type:C,state:r};s.push(K)}if(0===s.length){var N=this.getLastNalUnit(f.samples);if(N){var W=new Uint8Array(N.data.byteLength+v.byteLength);W.set(N.data,0),W.set(v,N.data.byteLength),N.data=W}}return f.naluState=r,s},u.parseAACPES=function(f,v){var O,I,C,M,U,t=0,r=this.aacOverFlow,e=v.data;if(r){this.aacOverFlow=null;var s=r.missing,p=r.sample.unit.byteLength;if(-1===s){var g=new Uint8Array(p+e.byteLength);g.set(r.sample.unit,0),g.set(e,p),e=g}else{var x=p-s;r.sample.unit.set(e.subarray(0,s),x),f.samples.push(r.sample),t=r.missing}}for(O=t,I=e.length;O<I-1&&!F.isHeader(e,O);O++);if(O===t||(O<I-1?(C="AAC PES did not start with ADTS header,offset:"+O,M=!1):(C="no ADTS header found in AAC PES",M=!0),D.logger.warn("parsing error:"+C),this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:M,reason:C}),!M)){if(F.initTrackConfig(f,this.observer,e,O,this.audioCodec),void 0!==v.pts)U=v.pts;else{if(!r)return void D.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var w=F.getFrameDuration(f.samplerate);U=r.sample.pts+w}for(var N,K=0;O<I;){if(O+=(N=F.appendFrame(f,e,O,U,K)).length,N.missing){this.aacOverFlow=N;break}for(K++;O<I-1&&!F.isHeader(e,O);O++);}}},u.parseMPEGPES=function(f,v){var t=v.data,r=t.length,e=0,s=0,p=v.pts;if(void 0!==p)for(;s<r;)if(A.isHeader(t,s)){var g=A.appendFrame(f,t,s,p,e);if(!g)break;s+=g.length,e++}else s++;else D.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},u.parseID3PES=function(f,v){if(void 0!==v.pts){var t=_({},v,{type:this._avcTrack?T.MetadataSchema.emsg:T.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});f.samples.push(t)}else D.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},i}()},"./src/demux/webworkify-webpack.js":
/*!*****************************************!*\
          !*** ./src/demux/webworkify-webpack.js ***!
          \*****************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>h});var A=function(){var m=ENTRY_MODULE,l={},a=function n(d){var c=l[d];if(void 0!==c)return c.exports;var i=l[d]={exports:{}};return m[d].call(i.exports,i,i.exports,n),i.exports};a.m=m,a.n=function(n){var d=n&&n.__esModule?function(){return n.default}:function(){return n};return a.d(d,{a:d}),d},a.d=function(n,d){for(var c in d)a.o(d,c)&&!a.o(n,c)&&Object.defineProperty(n,c,{enumerable:!0,get:d[c]})},a.o=function(n,d){return Object.prototype.hasOwnProperty.call(n,d)},a.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var o=a(ENTRY_MODULE);return o.default||o}.toString().split("ENTRY_MODULE"),b="[\\.|\\-|\\+|\\w|/|@]+",R="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+b+").*?\\)";function k(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function P(y){return!isNaN(1*y)}function D(y,m,l){var a={};a[l]=[];var o=m.toString().replace(/^"[^"]+"/,"function"),n=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||o.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return a;for(var i,d=n[1],c=new RegExp("(\\\\n|\\W)"+k(d)+R,"g");i=c.exec(o);)"dll-reference"!==i[3]&&a[l].push(i[3]);for(c=new RegExp("\\("+k(d)+'\\("(dll-reference\\s('+b+'))"\\)\\)'+R,"g");i=c.exec(o);)y[i[2]]||(a[l].push(i[1]),y[i[2]]=L(i[1]).m),a[i[2]]=a[i[2]]||[],a[i[2]].push(i[4]);for(var u=Object.keys(a),E=0;E<u.length;E++)for(var f=0;f<a[u[E]].length;f++)P(a[u[E]][f])&&(a[u[E]][f]=1*a[u[E]][f]);return a}function S(y){return Object.keys(y).reduce(function(l,a){return l||y[a].length>0},!1)}function _(y,m,l,a){var o=y[a].map(function(n){return'"'+n+'": '+m[a][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return A[0]+"{"+o+"}"+A[1]+'"'+l+'"'+A[2]}function h(y,m){var l={main:L.m},a=(m=m||{}).all?{main:Object.keys(l.main)}:function T(y,m){for(var l={main:[m]},a={main:[]},o={main:{}};S(l);)for(var n=Object.keys(l),d=0;d<n.length;d++){var c=n[d],u=l[c].pop();if(o[c]=o[c]||{},!o[c][u]&&y[c][u]){o[c][u]=!0,a[c]=a[c]||[],a[c].push(u);for(var E=D(y,y[c][u],c),f=Object.keys(E),v=0;v<f.length;v++)l[f[v]]=l[f[v]]||[],l[f[v]]=l[f[v]].concat(E[f[v]])}}return a}(l,y),o="";Object.keys(a).filter(function(u){return"main"!==u}).forEach(function(u){for(var E=0;a[u][E];)E++;a[u].push(E),l[u][E]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+u+" = ("+_(a,l,E,modules)+")();\n"}),o=o+"new (("+_(a,l,y,"main")+")())(self);";var n=new window.Blob([o],{type:"text/javascript"}),c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(n),i=new window.Worker(c);return i.objectURL=c,i}},"./src/errors.ts":
/*!***********************!*\
          !*** ./src/errors.ts ***!
          \***********************/(Y,B,L)=>{"use strict";var F,b,A;L.r(B),L.d(B,{ErrorDetails:()=>A,ErrorTypes:()=>F}),(b=F||(F={})).NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError",function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",b.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",b.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"}(A||(A={}))},"./src/events.ts":
/*!***********************!*\
          !*** ./src/events.ts ***!
          \***********************/(Y,B,L)=>{"use strict";var F,A;L.r(B),L.d(B,{Events:()=>F}),(A=F||(F={})).MEDIA_ATTACHING="hlsMediaAttaching",A.MEDIA_ATTACHED="hlsMediaAttached",A.MEDIA_DETACHING="hlsMediaDetaching",A.MEDIA_DETACHED="hlsMediaDetached",A.BUFFER_RESET="hlsBufferReset",A.BUFFER_CODECS="hlsBufferCodecs",A.BUFFER_CREATED="hlsBufferCreated",A.BUFFER_APPENDING="hlsBufferAppending",A.BUFFER_APPENDED="hlsBufferAppended",A.BUFFER_EOS="hlsBufferEos",A.BUFFER_FLUSHING="hlsBufferFlushing",A.BUFFER_FLUSHED="hlsBufferFlushed",A.MANIFEST_LOADING="hlsManifestLoading",A.MANIFEST_LOADED="hlsManifestLoaded",A.MANIFEST_PARSED="hlsManifestParsed",A.LEVEL_SWITCHING="hlsLevelSwitching",A.LEVEL_SWITCHED="hlsLevelSwitched",A.LEVEL_LOADING="hlsLevelLoading",A.LEVEL_LOADED="hlsLevelLoaded",A.LEVEL_UPDATED="hlsLevelUpdated",A.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",A.LEVELS_UPDATED="hlsLevelsUpdated",A.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",A.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",A.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",A.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",A.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",A.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",A.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",A.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",A.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",A.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",A.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",A.CUES_PARSED="hlsCuesParsed",A.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",A.INIT_PTS_FOUND="hlsInitPtsFound",A.FRAG_LOADING="hlsFragLoading",A.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",A.FRAG_LOADED="hlsFragLoaded",A.FRAG_DECRYPTED="hlsFragDecrypted",A.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",A.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",A.FRAG_PARSING_METADATA="hlsFragParsingMetadata",A.FRAG_PARSED="hlsFragParsed",A.FRAG_BUFFERED="hlsFragBuffered",A.FRAG_CHANGED="hlsFragChanged",A.FPS_DROP="hlsFpsDrop",A.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",A.ERROR="hlsError",A.DESTROYING="hlsDestroying",A.KEY_LOADING="hlsKeyLoading",A.KEY_LOADED="hlsKeyLoaded",A.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",A.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":
/*!********************!*\
          !*** ./src/hls.ts ***!
          \********************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>E});var F=L(
/*! url-toolkit */
"./node_modules/url-toolkit/src/url-toolkit.js"),b=L(
/*! ./loader/playlist-loader */
"./src/loader/playlist-loader.ts"),R=L(
/*! ./controller/id3-track-controller */
"./src/controller/id3-track-controller.ts"),k=L(
/*! ./controller/latency-controller */
"./src/controller/latency-controller.ts"),P=L(
/*! ./controller/level-controller */
"./src/controller/level-controller.ts"),D=L(
/*! ./controller/fragment-tracker */
"./src/controller/fragment-tracker.ts"),S=L(
/*! ./loader/key-loader */
"./src/loader/key-loader.ts"),T=L(
/*! ./controller/stream-controller */
"./src/controller/stream-controller.ts"),_=L(
/*! ./is-supported */
"./src/is-supported.ts"),h=L(
/*! ./utils/logger */
"./src/utils/logger.ts"),y=L(
/*! ./config */
"./src/config.ts"),m=L(
/*! eventemitter3 */
"./node_modules/eventemitter3/index.js"),a=L(
/*! ./events */
"./src/events.ts"),o=L(
/*! ./errors */
"./src/errors.ts"),n=L(
/*! ./types/level */
"./src/types/level.ts");function d(f,v){for(var t=0;t<v.length;t++){var r=v[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(f,i(r.key),r)}}function i(f){var v=function u(f,v){if("object"!=typeof f||null===f)return f;var t=f[Symbol.toPrimitive];if(void 0!==t){var r=t.call(f,v||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===v?String:Number)(f)}(f,"string");return"symbol"==typeof v?v:String(v)}var E=function(){function f(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=(0,y.mergeConfig)(f.DefaultConfig,t);this.userConfig=t,(0,h.enableLogs)(r.debug,"Hls instance"),this._autoLevelCapping=-1,r.progressive&&(0,y.enableStreamingMode)(r);var s=r.bufferController,p=r.capLevelController,g=r.fpsController,x=this.abrController=new(0,r.abrController)(this),O=this.bufferController=new s(this),I=this.capLevelController=new p(this),C=new g(this),M=new b.default(this),U=new R.default(this),w=this.levelController=new P.default(this),K=new D.FragmentTracker(this),N=new S.default(this.config),W=this.streamController=new T.default(this,K,N);I.setStreamController(W),C.setStreamController(W);var G=[M,w,W];this.networkControllers=G;var V=[x,O,I,C,U,K];this.audioTrackController=this.createController(r.audioTrackController,G);var H=r.audioStreamController;H&&G.push(new H(this,K,N)),this.subtitleTrackController=this.createController(r.subtitleTrackController,G);var j=r.subtitleStreamController;j&&G.push(new j(this,K,N)),this.createController(r.timelineController,V),N.emeController=this.emeController=this.createController(r.emeController,V),this.cmcdController=this.createController(r.cmcdController,V),this.latencyController=this.createController(k.default,V),this.coreComponents=V}f.isSupported=function(){return(0,_.isSupported)()};var v=f.prototype;return v.createController=function(r,e){if(r){var s=new r(this);return e&&e.push(s),s}return null},v.on=function(r,e,s){void 0===s&&(s=this),this._emitter.on(r,e,s)},v.once=function(r,e,s){void 0===s&&(s=this),this._emitter.once(r,e,s)},v.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},v.off=function(r,e,s,p){void 0===s&&(s=this),this._emitter.off(r,e,s,p)},v.listeners=function(r){return this._emitter.listeners(r)},v.emit=function(r,e,s){return this._emitter.emit(r,e,s)},v.trigger=function(r,e){if(this.config.debug)return this.emit(r,r,e);try{return this.emit(r,r,e)}catch(s){h.logger.error("An internal error happened while handling event "+r+'. Error message: "'+s.message+'". Here is a stacktrace:',s),this.trigger(a.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,error:s})}return!1},v.listenerCount=function(r){return this._emitter.listenerCount(r)},v.destroy=function(){h.logger.log("destroy"),this.trigger(a.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(r){return r.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(r){return r.destroy()}),this.coreComponents.length=0},v.attachMedia=function(r){h.logger.log("attachMedia"),this._media=r,this.trigger(a.Events.MEDIA_ATTACHING,{media:r})},v.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(a.Events.MEDIA_DETACHING,void 0),this._media=null},v.loadSource=function(r){this.stopLoad();var e=this.media,s=this.url,p=this.url=F.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});h.logger.log("loadSource:"+p),e&&s&&s!==p&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(a.Events.MANIFEST_LOADING,{url:r})},v.startLoad=function(r){void 0===r&&(r=-1),h.logger.log("startLoad("+r+")"),this.networkControllers.forEach(function(e){e.startLoad(r)})},v.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},v.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},v.recoverMediaError=function(){h.logger.log("recoverMediaError");var r=this._media;this.detachMedia(),r&&this.attachMedia(r)},v.removeLevel=function(r,e){void 0===e&&(e=0),this.levelController.removeLevel(r,e)},function c(f,v,t){v&&d(f.prototype,v),t&&d(f,t),Object.defineProperty(f,"prototype",{writable:!1})}(f,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){h.logger.log("set currentLevel:"+r),this.loadLevel=r,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){h.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){h.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){h.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){h.logger.log("set startLevel:"+r),-1!==r&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var e=!!r;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(h.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r)}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(r){n.HdcpLevels.indexOf(r)>-1&&(this._maxHdcpLevel=r)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,e=this.config.minAutoBitrate;if(!r)return 0;for(var s=r.length,p=0;p<s;p++)if(r[p].maxBitrate>=e)return p;return 0}},{key:"maxAutoLevel",get:function(){var p,r=this.levels,e=this.autoLevelCapping,s=this.maxHdcpLevel;if(p=-1===e&&r&&r.length?r.length-1:e,s)for(var g=p;g--;){var x=r[g].attrs["HDCP-LEVEL"];if(x&&x<=s)return g}return p}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var e=this.audioTrackController;e&&(e.audioTrack=r)}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return!!r&&r.subtitleDisplay},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.4"}},{key:"Events",get:function(){return a.Events}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:y.hlsDefaultConfig},set:function(r){f.defaultConfig=r}}]),f}();E.defaultConfig=void 0},"./src/is-supported.ts":
/*!*****************************!*\
          !*** ./src/is-supported.ts ***!
          \*****************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{changeTypeSupported:()=>R,isSupported:()=>b});var F=L(
/*! ./utils/mediasource-helper */
"./src/utils/mediasource-helper.ts");function A(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var k=(0,F.getMediaSource)();if(!k)return!1;var P=A();return!(!k||"function"!=typeof k.isTypeSupported||!k.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||P&&(!P.prototype||"function"!=typeof P.prototype.appendBuffer||"function"!=typeof P.prototype.remove))}function R(){var k,P=A();return"function"==typeof(null==P||null===(k=P.prototype)||void 0===k?void 0:k.changeType)}},"./src/loader/date-range.ts":
/*!**********************************!*\
          !*** ./src/loader/date-range.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{DateRange:()=>_,DateRangeAttribute:()=>T});var T,h,F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../utils/attr-list */
"./src/utils/attr-list.ts"),b=L(
/*! ../utils/logger */
"./src/utils/logger.ts");function R(){return R=Object.assign?Object.assign.bind():function(h){for(var y=1;y<arguments.length;y++){var m=arguments[y];for(var l in m)Object.prototype.hasOwnProperty.call(m,l)&&(h[l]=m[l])}return h},R.apply(this,arguments)}function k(h,y){for(var m=0;m<y.length;m++){var l=y[m];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(h,D(l.key),l)}}function D(h){var y=function S(h,y){if("object"!=typeof h||null===h)return h;var m=h[Symbol.toPrimitive];if(void 0!==m){var l=m.call(h,y||"default");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===y?String:Number)(h)}(h,"string");return"symbol"==typeof y?y:String(y)}(h=T||(T={})).ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN";var _=function(){function h(y,m){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,m){var l=m.attr;for(var a in l)if(Object.prototype.hasOwnProperty.call(y,a)&&y[a]!==l[a]){b.logger.warn('DATERANGE tag attribute: "'+a+'" does not match for tags with ID: "'+y.ID+'"'),this._badValueForSameId=a;break}y=R(new A.AttrList({}),l,y)}if(this.attr=y,this._startDate=new Date(y[T.START_DATE]),T.END_DATE in this.attr){var o=new Date(this.attr[T.END_DATE]);(0,F.isFiniteNumber)(o.getTime())&&(this._endDate=o)}}return function P(h,y,m){y&&k(h.prototype,y),m&&k(h,m),Object.defineProperty(h,"prototype",{writable:!1})}(h,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var m=this.duration;return null!==m?new Date(this._startDate.getTime()+1e3*m):null}},{key:"duration",get:function(){if(T.DURATION in this.attr){var m=this.attr.decimalFloatingPoint(T.DURATION);if((0,F.isFiniteNumber)(m))return m}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return T.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(T.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(T.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,F.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),h}()},"./src/loader/fragment-loader.ts":
/*!***************************************!*\
          !*** ./src/loader/fragment-loader.ts ***!
          \***************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{LoadError:()=>m,default:()=>h});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../errors */
"./src/errors.ts");function R(l){var a="function"==typeof Map?new Map:void 0;return R=function(n){if(null===n||!function D(l){return-1!==Function.toString.call(l).indexOf("[native code]")}(n))return n;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(n))return a.get(n);a.set(n,d)}function d(){return k(n,arguments,T(this).constructor)}return d.prototype=Object.create(n.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),S(d,n)},R(l)}function k(l,a,o){return(k=function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(d,c,i){var u=[null];u.push.apply(u,c);var f=new(Function.bind.apply(d,u));return i&&S(f,i.prototype),f}).apply(null,arguments)}function S(l,a){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,d){return n.__proto__=d,n})(l,a)}function T(l){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)})(l)}var _=Math.pow(2,17),h=function(){function l(o){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=o}var a=l.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(n,d){var c=this,i=n.url;if(!i)return Promise.reject(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:n,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var u=this.config,E=u.fLoader,f=u.loader;return new Promise(function(v,t){c.loader&&c.loader.destroy();var r=c.loader=n.loader=E?new E(u):new f(u),e=y(n),s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===n.sn?1/0:_};n.stats=r.stats,r.load(e,s,{onSuccess:function(g,x,O,I){c.resetLoader(n,r);var C=g.data;O.resetIV&&n.decryptdata&&(n.decryptdata.iv=new Uint8Array(C.slice(0,16)),C=C.slice(16)),v({frag:n,part:null,payload:C,networkDetails:I})},onError:function(g,x,O){c.resetLoader(n,r),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:n,response:g,networkDetails:O}))},onAbort:function(g,x,O){c.resetLoader(n,r),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:n,networkDetails:O}))},onTimeout:function(g,x,O){c.resetLoader(n,r),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,networkDetails:O}))},onProgress:function(g,x,O,I){d&&d({frag:n,part:null,payload:O,networkDetails:I})}})})},a.loadPart=function(n,d,c){var i=this;this.abort();var u=this.config,E=u.fLoader,f=u.loader;return new Promise(function(v,t){i.loader&&i.loader.destroy();var r=i.loader=n.loader=E?new E(u):new f(u),e=y(n,d),s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:_};d.stats=r.stats,r.load(e,s,{onSuccess:function(g,x,O,I){i.resetLoader(n,r),i.updateStatsFromPart(n,d);var C={frag:n,part:d,payload:g.data,networkDetails:I};c(C),v(C)},onError:function(g,x,O){i.resetLoader(n,r),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:n,part:d,response:g,networkDetails:O}))},onAbort:function(g,x,O){n.stats.aborted=d.stats.aborted,i.resetLoader(n,r),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:n,part:d,networkDetails:O}))},onTimeout:function(g,x,O){i.resetLoader(n,r),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,part:d,networkDetails:O}))}})})},a.updateStatsFromPart=function(n,d){var c=n.stats,i=d.stats,u=i.total;if(c.loaded+=i.loaded,u){var E=Math.round(n.duration/d.duration),f=Math.min(Math.round(c.loaded/u),E),t=(E-f)*Math.round(c.loaded/f);c.total=c.loaded+t}else c.total=Math.max(c.loaded,c.total);var r=c.loading,e=i.loading;r.start?r.first+=e.first-e.start:(r.start=e.start,r.first=e.first),r.end=e.end},a.resetLoader=function(n,d){n.loader=null,this.loader===d&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),d.destroy()},l}();function y(l,a){void 0===a&&(a=null);var o=a||l,n={frag:l,part:a,responseType:"arraybuffer",url:o.url,headers:{},rangeStart:0,rangeEnd:0},d=o.byteRangeStartOffset,c=o.byteRangeEndOffset;if((0,F.isFiniteNumber)(d)&&(0,F.isFiniteNumber)(c)){var i,u=d,E=c;if("initSegment"===l.sn&&"AES-128"===(null===(i=l.decryptdata)||void 0===i?void 0:i.method)){var f=c-d;f%16&&(E=c+(16-f%16)),0!==d&&(n.resetIV=!0,u=d-16)}n.rangeStart=u,n.rangeEnd=E}return n}var m=function(l){function a(o){for(var n,d=arguments.length,c=new Array(d>1?d-1:0),i=1;i<d;i++)c[i-1]=arguments[i];return(n=l.call.apply(l,[this].concat(c))||this).data=void 0,n.data=o,n}return function b(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,S(l,a)}(a,l),a}(R(Error))},"./src/loader/fragment.ts":
/*!********************************!*\
          !*** ./src/loader/fragment.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{BaseSegment:()=>y,ElementaryStreamTypes:()=>h,Fragment:()=>m,Part:()=>l});var h,a,F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! url-toolkit */
"./node_modules/url-toolkit/src/url-toolkit.js"),R=L(
/*! ./load-stats */
"./src/loader/load-stats.ts");function k(a,o){a.prototype=Object.create(o.prototype),a.prototype.constructor=a,P(a,o)}function P(a,o){return(P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,c){return d.__proto__=c,d})(a,o)}function D(a,o){for(var n=0;n<o.length;n++){var d=o[n];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,T(d.key),d)}}function S(a,o,n){return o&&D(a.prototype,o),n&&D(a,n),Object.defineProperty(a,"prototype",{writable:!1}),a}function T(a){var o=function _(a,o){if("object"!=typeof a||null===a)return a;var n=a[Symbol.toPrimitive];if(void 0!==n){var d=n.call(a,o||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(a)}(a,"string");return"symbol"==typeof o?o:String(o)}(a=h||(h={})).AUDIO="audio",a.VIDEO="video",a.AUDIOVIDEO="audiovideo";var y=function(){function a(n){var d;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((d={})[h.AUDIO]=null,d[h.VIDEO]=null,d[h.AUDIOVIDEO]=null,d),this.baseurl=n}return a.prototype.setByteRange=function(d,c){var i=d.split("@",2),u=[];u[0]=1===i.length?c?c.byteRangeEndOffset:0:parseInt(i[1]),u[1]=parseInt(i[0])+u[0],this._byteRange=u},S(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,A.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(d){this._url=d}}]),a}(),m=function(a){function o(d,c){var i;return(i=a.call(this,c)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new R.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.type=d,i}k(o,a);var n=o.prototype;return n.setKeyFormat=function(c){if(this.levelkeys){var i=this.levelkeys[c];i&&!this._decryptdata&&(this._decryptdata=i.getDecryptData(this.sn))}},n.abortRequests=function(){var c,i;null===(c=this.loader)||void 0===c||c.abort(),null===(i=this.keyLoader)||void 0===i||i.abort()},n.setElementaryStreamInfo=function(c,i,u,E,f,v){void 0===v&&(v=!1);var t=this.elementaryStreams,r=t[c];r?(r.startPTS=Math.min(r.startPTS,i),r.endPTS=Math.max(r.endPTS,u),r.startDTS=Math.min(r.startDTS,E),r.endDTS=Math.max(r.endDTS,f)):t[c]={startPTS:i,endPTS:u,startDTS:E,endDTS:f,partial:v}},n.clearElementaryStreamInfo=function(){var c=this.elementaryStreams;c[h.AUDIO]=null,c[h.VIDEO]=null,c[h.AUDIOVIDEO]=null},S(o,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var i=this.levelkeys.identity;if(i)this._decryptdata=i.getDecryptData(this.sn);else{var u=Object.keys(this.levelkeys);if(1===u.length)return this._decryptdata=this.levelkeys[u[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!(0,F.isFiniteNumber)(this.programDateTime))return null;var c=(0,F.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*c}},{key:"encrypted",get:function(){var c;if(null!==(c=this._decryptdata)&&void 0!==c&&c.encrypted)return!0;if(this.levelkeys){var i=Object.keys(this.levelkeys),u=i.length;if(u>1||1===u&&this.levelkeys[i[0]].encrypted)return!0}return!1}}]),o}(y),l=function(a){function o(n,d,c,i,u){var E;(E=a.call(this,c)||this).fragOffset=0,E.duration=0,E.gap=!1,E.independent=!1,E.relurl=void 0,E.fragment=void 0,E.index=void 0,E.stats=new R.LoadStats,E.duration=n.decimalFloatingPoint("DURATION"),E.gap=n.bool("GAP"),E.independent=n.bool("INDEPENDENT"),E.relurl=n.enumeratedString("URI"),E.fragment=d,E.index=i;var f=n.enumeratedString("BYTERANGE");return f&&E.setByteRange(f,u),u&&(E.fragOffset=u.fragOffset+u.duration),E}return k(o,a),S(o,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var d=this.elementaryStreams;return!!(d.audio||d.video||d.audiovideo)}}]),o}(y)},"./src/loader/key-loader.ts":
/*!**********************************!*\
          !*** ./src/loader/key-loader.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>b});var F=L(
/*! ../errors */
"./src/errors.ts"),A=L(
/*! ./fragment-loader */
"./src/loader/fragment-loader.ts"),b=function(){function R(P){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=P}var k=R.prototype;return k.abort=function(){for(var D in this.keyUriToKeyInfo){var S=this.keyUriToKeyInfo[D].loader;S&&S.abort()}},k.detach=function(){for(var D in this.keyUriToKeyInfo){var S=this.keyUriToKeyInfo[D];(S.mediaKeySessionContext||S.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[D]}},k.destroy=function(){for(var D in this.detach(),this.keyUriToKeyInfo){var S=this.keyUriToKeyInfo[D].loader;S&&S.destroy()}this.keyUriToKeyInfo={}},k.createKeyLoadError=function(D,S,T,_){return void 0===S&&(S=F.ErrorDetails.KEY_LOAD_ERROR),new A.LoadError({type:F.ErrorTypes.NETWORK_ERROR,details:S,fatal:!1,frag:D,networkDetails:T})},k.loadClear=function(D,S){var T=this;if(this.emeController&&this.config.emeEnabled)for(var _=D.sn,h=D.cc,y=function(o){var n=S[o];if(h<=n.cc&&("initSegment"===_||_<n.sn))return T.emeController.selectKeySystemFormat(n).then(function(d){n.setKeyFormat(d)}),"break"},m=0;m<S.length&&"break"!==y(m);m++);},k.load=function(D){var S=this;return!D.decryptdata&&D.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(D).then(function(T){return S.loadInternal(D,T)}):this.loadInternal(D)},k.loadInternal=function(D,S){var T,_;S&&D.setKeyFormat(S);var h=D.decryptdata;if(!h)return Promise.reject(this.createKeyLoadError(D,F.ErrorDetails.KEY_LOAD_ERROR,null,S?"Expected frag.decryptdata to be defined after setting format "+S:"Missing decryption data on fragment in onKeyLoading"));var m=h.uri;if(!m)return Promise.reject(this.createKeyLoadError(D,F.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+m+'"'));var a,l=this.keyUriToKeyInfo[m];if(null!==(T=l)&&void 0!==T&&T.decryptdata.key)return h.key=l.decryptdata.key,Promise.resolve({frag:D,keyInfo:l});if(null!==(_=l)&&void 0!==_&&_.keyLoadPromise)switch(null===(a=l.mediaKeySessionContext)||void 0===a?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then(function(o){return h.key=o.keyInfo.decryptdata.key,{frag:D,keyInfo:l}})}switch(l=this.keyUriToKeyInfo[m]={decryptdata:h,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},h.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===h.keyFormat?this.loadKeyHTTP(l,D):this.loadKeyEME(l,D);case"AES-128":return this.loadKeyHTTP(l,D);default:return Promise.reject(this.createKeyLoadError(D,F.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+h.method+'"'))}},k.loadKeyEME=function(D,S){var T={frag:S,keyInfo:D};if(this.emeController&&this.config.emeEnabled){var _=this.emeController.loadKey(T);if(_)return(D.keyLoadPromise=_.then(function(h){return D.mediaKeySessionContext=h,T})).catch(function(h){throw D.keyLoadPromise=null,h})}return Promise.resolve(T)},k.loadKeyHTTP=function(D,S){var T=this,_=this.config,y=new(0,_.loader)(_);return S.keyLoader=D.loader=y,D.keyLoadPromise=new Promise(function(m,l){y.load({keyInfo:D,frag:S,responseType:"arraybuffer",url:D.decryptdata.uri},{timeout:_.fragLoadingTimeOut,maxRetry:0,retryDelay:_.fragLoadingRetryDelay,maxRetryDelay:_.fragLoadingMaxRetryTimeout,highWaterMark:0},{onSuccess:function(c,i,u,E){var f=u.frag,v=u.keyInfo;if(!f.decryptdata||v!==T.keyUriToKeyInfo[u.url])return l(T.createKeyLoadError(f,F.ErrorDetails.KEY_LOAD_ERROR,E,"after key load, decryptdata unset or changed"));v.decryptdata.key=f.decryptdata.key=new Uint8Array(c.data),f.keyLoader=null,v.loader=null,m({frag:f,keyInfo:v})},onError:function(c,i,u){T.resetLoader(i),l(T.createKeyLoadError(S,F.ErrorDetails.KEY_LOAD_ERROR,u))},onTimeout:function(c,i,u){T.resetLoader(i),l(T.createKeyLoadError(S,F.ErrorDetails.KEY_LOAD_TIMEOUT,u))},onAbort:function(c,i,u){T.resetLoader(i),l(T.createKeyLoadError(S,F.ErrorDetails.INTERNAL_ABORTED,u))}})})},k.resetLoader=function(D){var S=D.frag,T=D.keyInfo,_=D.url,h=T.loader;S.keyLoader===h&&(S.keyLoader=null,T.loader=null),delete this.keyUriToKeyInfo[_],h&&h.destroy()},R}()},"./src/loader/level-details.ts":
/*!*************************************!*\
          !*** ./src/loader/level-details.ts ***!
          \*************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{LevelDetails:()=>D});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts");function A(S,T){for(var _=0;_<T.length;_++){var h=T[_];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(S,R(h.key),h)}}function R(S){var T=function k(S,T){if("object"!=typeof S||null===S)return S;var _=S[Symbol.toPrimitive];if(void 0!==_){var h=_.call(S,T||"default");if("object"!=typeof h)return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===T?String:Number)(S)}(S,"string");return"symbol"==typeof T?T:String(T)}var D=function(){function S(_){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=_}return S.prototype.reloaded=function(h){if(!h)return this.advanced=!0,void(this.updated=!0);var y=this.lastPartSn-h.lastPartSn,m=this.lastPartIndex-h.lastPartIndex;this.updated=this.endSN!==h.endSN||!!m||!!y,this.advanced=this.endSN>h.endSN||y>0||0===y&&m>0,this.misses=this.updated||this.advanced?Math.floor(.6*h.misses):h.misses+1,this.availabilityDelay=h.availabilityDelay},function b(S,T,_){T&&A(S.prototype,T),_&&A(S,_),Object.defineProperty(S,"prototype",{writable:!1})}(S,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,F.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var h=this.driftEndTime-this.driftStartTime;return h>0?1e3*(this.driftEnd-this.driftStart)/h:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var h;return null!==(h=this.partList)&&void 0!==h&&h.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var h;return null!==(h=this.fragments)&&void 0!==h&&h.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var h;return null!==(h=this.partList)&&void 0!==h&&h.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var h;return null!==(h=this.partList)&&void 0!==h&&h.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),S}()},"./src/loader/level-key.ts":
/*!*********************************!*\
          !*** ./src/loader/level-key.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{LevelKey:()=>D});var F=L(
/*! ../utils/keysystem-util */
"./src/utils/keysystem-util.ts"),A=L(
/*! ../utils/mediakeys-helper */
"./src/utils/mediakeys-helper.ts"),b=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),k=L(
/*! ../utils/numeric-encoding-utils */
"./src/utils/numeric-encoding-utils.ts"),P={},D=function(){function T(h,y,m,l,a){void 0===l&&(l=[1]),void 0===a&&(a=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=h,this.uri=y,this.keyFormat=m,this.keyFormatVersions=l,this.iv=a,this.encrypted=!!h&&"NONE"!==h,this.isCommonEncryption=this.encrypted&&"AES-128"!==h}T.clearKeyUriToKeyIdMap=function(){P={}};var _=T.prototype;return _.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;switch(this.keyFormat){case"identity":return"SAMPLE-AES"===this.method;case A.KeySystemFormats.FAIRPLAY:case A.KeySystemFormats.WIDEVINE:case A.KeySystemFormats.PLAYREADY:case A.KeySystemFormats.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},_.getDecryptData=function(y){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof y&&("AES-128"===this.method&&!this.iv&&R.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),y=0);var m=function S(T){for(var _=new Uint8Array(16),h=12;h<16;h++)_[h]=T>>8*(15-h)&255;return _}(y);return new T(this.method,this.uri,"identity",this.keyFormatVersions,m)}var a=(0,F.convertDataUriToArrayBytes)(this.uri);if(a)switch(this.keyFormat){case A.KeySystemFormats.WIDEVINE:this.pssh=a,a.length>=22&&(this.keyId=a.subarray(a.length-22,a.length-6));break;case A.KeySystemFormats.PLAYREADY:var o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,b.mp4pssh)(o,null,a);var n=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),d=String.fromCharCode.apply(null,Array.from(n)),c=d.substring(d.indexOf("<"),d.length),E=(new DOMParser).parseFromString(c,"text/xml").getElementsByTagName("KID")[0];if(E){var f=E.childNodes[0]?E.childNodes[0].nodeValue:E.getAttribute("VALUE");if(f){var v=(0,k.base64Decode)(f).subarray(0,16);(0,F.changeEndianness)(v),this.keyId=v}}break;default:var t=a.subarray(0,16);if(16!==t.length){var r=new Uint8Array(16);r.set(t,16-t.length),t=r}this.keyId=t}if(!this.keyId||16!==this.keyId.byteLength){var e=P[this.uri];if(!e){var s=Object.keys(P).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16),new DataView(e.buffer,12,4).setUint32(0,s),P[this.uri]=e}this.keyId=e}return this},T}()},"./src/loader/load-stats.ts":
/*!**********************************!*\
          !*** ./src/loader/load-stats.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{LoadStats:()=>F});var F=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":
/*!***********************************!*\
          !*** ./src/loader/m3u8-parser.ts ***!
          \***********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>o});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! url-toolkit */
"./node_modules/url-toolkit/src/url-toolkit.js"),R=L(
/*! ./date-range */
"./src/loader/date-range.ts"),k=L(
/*! ./fragment */
"./src/loader/fragment.ts"),P=L(
/*! ./level-details */
"./src/loader/level-details.ts"),D=L(
/*! ./level-key */
"./src/loader/level-key.ts"),S=L(
/*! ../utils/attr-list */
"./src/utils/attr-list.ts"),T=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),_=L(
/*! ../utils/codecs */
"./src/utils/codecs.ts");function h(){return h=Object.assign?Object.assign.bind():function(v){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(v[e]=r[e])}return v},h.apply(this,arguments)}var y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,l=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),a=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),o=function(){function v(){}return v.findGroup=function(r,e){for(var s=0;s<r.length;s++){var p=r[s];if(p.id===e)return p}},v.convertAVC1ToAVCOTI=function(r){var e=r.split(".");if(e.length>2){var s=e.shift()+".";return(s+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return r},v.resolve=function(r,e){return(0,A.buildAbsoluteURL)(e,r,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(r,e){var I,s=[],p=[],g={},x=[],O=!1;for(y.lastIndex=0;null!=(I=y.exec(r));)if(I[1]){var C,M=new S.AttrList(I[1]),U={attrs:M,bitrate:M.decimalInteger("AVERAGE-BANDWIDTH")||M.decimalInteger("BANDWIDTH"),name:M.NAME,url:v.resolve(I[2],e)},w=M.decimalResolution("RESOLUTION");w&&(U.width=w.width,U.height=w.height),d((M.CODECS||"").split(/[ ,]+/).filter(function(V){return V}),U),U.videoCodec&&-1!==U.videoCodec.indexOf("avc1")&&(U.videoCodec=v.convertAVC1ToAVCOTI(U.videoCodec)),null!==(C=U.unknownCodecs)&&void 0!==C&&C.length||p.push(U),s.push(U)}else if(I[3]){var K=new S.AttrList(I[3]);K["DATA-ID"]&&(O=!0,g[K["DATA-ID"]]=K)}else if(I[4]){var N=I[4],W=n(N,e);W.encrypted&&W.isSupported()?x.push(W):T.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+N+'"')}return{levels:p.length>0&&p.length<s.length?p:s,sessionData:O?g:null,sessionKeys:x.length?x:null}},v.parseMasterPlaylistMedia=function(r,e,s,p){void 0===p&&(p=[]);var g,x=[],O=0;for(m.lastIndex=0;null!==(g=m.exec(r));){var I=new S.AttrList(g[1]);if(I.TYPE===s){var C={attrs:I,bitrate:0,id:O++,groupId:I["GROUP-ID"],instreamId:I["INSTREAM-ID"],name:I.NAME||I.LANGUAGE||"",type:s,default:I.bool("DEFAULT"),autoselect:I.bool("AUTOSELECT"),forced:I.bool("FORCED"),lang:I.LANGUAGE,url:I.URI?v.resolve(I.URI,e):""};if(p.length){var M=v.findGroup(p,C.groupId)||p[0];c(C,M,"audioCodec"),c(C,M,"textCodec")}x.push(C)}}return x},v.parseLevelPlaylist=function(r,e,s,p,g){var W,G,V,x=new P.LevelDetails(e),O=x.fragments,I=null,C=0,M=0,U=0,w=0,K=null,N=new k.Fragment(p,e),H=-1,j=!1;for(l.lastIndex=0,x.m3u8=r;null!==(W=l.exec(r));){j&&(j=!1,(N=new k.Fragment(p,e)).start=U,N.sn=C,N.cc=w,N.level=s,I&&(N.initSegment=I,N.rawProgramDateTime=I.rawProgramDateTime,I.rawProgramDateTime=null));var X=W[1];if(X){N.duration=parseFloat(X);var Z=(" "+W[2]).slice(1);N.title=Z||null,N.tagList.push(Z?["INF",X,Z]:["INF",X])}else if(W[3])(0,F.isFiniteNumber)(N.duration)&&(N.start=U,V&&f(N,V,x),N.sn=C,N.level=s,N.cc=w,N.urlId=g,O.push(N),N.relurl=(" "+W[3]).slice(1),u(N,K),K=N,U+=N.duration,C++,M=0,j=!0);else if(W[4]){var Q=(" "+W[4]).slice(1);K?N.setByteRange(Q,K):N.setByteRange(Q)}else if(W[5])N.rawProgramDateTime=(" "+W[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),-1===H&&(H=O.length);else{if(!(W=W[0].match(a))){T.logger.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<W.length&&!(typeof W[G]<"u");G++);var z=(" "+W[G]).slice(1),$=(" "+W[G+1]).slice(1),J=W[G+2]?(" "+W[G+2]).slice(1):"";switch(z){case"PLAYLIST-TYPE":x.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":C=x.startSN=parseInt($);break;case"SKIP":var q=new S.AttrList($),ie=q.decimalInteger("SKIPPED-SEGMENTS");if((0,F.isFiniteNumber)(ie)){x.skippedSegments=ie;for(var re=ie;re--;)O.unshift(null);C+=ie}var ne=q.enumeratedString("RECENTLY-REMOVED-DATERANGES");ne&&(x.recentlyRemovedDateranges=ne.split("\t"));break;case"TARGETDURATION":x.targetduration=parseFloat($);break;case"VERSION":x.version=parseInt($);break;case"EXTM3U":break;case"ENDLIST":x.live=!1;break;case"#":($||J)&&N.tagList.push(J?[$,J]:[$]);break;case"DISCONTINUITY":w++,N.tagList.push(["DIS"]);break;case"GAP":N.tagList.push([z]);break;case"BITRATE":N.tagList.push([z,$]);break;case"DATERANGE":var te=new S.AttrList($),ae=new R.DateRange(te,x.dateRanges[te.ID]);ae.isValid||x.skippedSegments?x.dateRanges[ae.id]=ae:T.logger.warn('Ignoring invalid DATERANGE tag: "'+$+'"'),N.tagList.push(["EXT-X-DATERANGE",$]);break;case"DISCONTINUITY-SEQUENCE":w=parseInt($);break;case"KEY":var ee=n($,e);if(ee.isSupported()){if("NONE"===ee.method){V=void 0;break}V||(V={}),V[ee.keyFormat]&&(V=h({},V)),V[ee.keyFormat]=ee}else T.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+$+'"');break;case"START":var ue=new S.AttrList($).decimalFloatingPoint("TIME-OFFSET");(0,F.isFiniteNumber)(ue)&&(x.startTimeOffset=ue);break;case"MAP":var le=new S.AttrList($);if(N.duration){var ce=new k.Fragment(p,e);E(ce,le,s,V),N.initSegment=I=ce,I.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=I.rawProgramDateTime)}else E(N,le,s,V),I=N,j=!0;break;case"SERVER-CONTROL":var ve=new S.AttrList($);x.canBlockReload=ve.bool("CAN-BLOCK-RELOAD"),x.canSkipUntil=ve.optionalFloat("CAN-SKIP-UNTIL",0),x.canSkipDateRanges=x.canSkipUntil>0&&ve.bool("CAN-SKIP-DATERANGES"),x.partHoldBack=ve.optionalFloat("PART-HOLD-BACK",0),x.holdBack=ve.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ye=new S.AttrList($);x.partTarget=ye.decimalFloatingPoint("PART-TARGET");break;case"PART":var ge=x.partList;ge||(ge=x.partList=[]);var Te=M>0?ge[ge.length-1]:void 0,_e=M++,me=new k.Part(new S.AttrList($),N,e,_e,Te);ge.push(me),N.duration+=me.duration;break;case"PRELOAD-HINT":var fe=new S.AttrList($);x.preloadHint=fe;break;case"RENDITION-REPORT":var he=new S.AttrList($);x.renditionReports=x.renditionReports||[],x.renditionReports.push(he);break;default:T.logger.warn("line parsed but not handled: "+W)}}}K&&!K.relurl?(O.pop(),U-=K.duration,x.partList&&(x.fragmentHint=K)):x.partList&&(u(N,K),N.cc=w,x.fragmentHint=N,V&&f(N,V,x));var Ee=O.length,Le=O[0],se=O[Ee-1];if((U+=x.skippedSegments*x.targetduration)>0&&Ee&&se){x.averagetargetduration=U/Ee;var pe=se.sn;x.endSN="initSegment"!==pe?pe:0,x.live||(se.endList=!0),Le&&(x.startCC=Le.cc)}else x.endSN=0,x.startCC=0;return x.fragmentHint&&(U+=x.fragmentHint.duration),x.totalduration=U,x.endCC=w,H>0&&function i(v,t){for(var r=v[t],e=t;e--;){var s=v[e];if(!s)return;s.programDateTime=r.programDateTime-1e3*s.duration,r=s}}(O,H),x},v}();function n(v,t){var r,e,s=new S.AttrList(v),p=null!=(r=s.enumeratedString("METHOD"))?r:"",g=s.URI,x=s.hexadecimalInteger("IV"),O=s.enumeratedString("KEYFORMATVERSIONS"),I=null!=(e=s.enumeratedString("KEYFORMAT"))?e:"identity";g&&s.IV&&!x&&T.logger.error("Invalid IV: "+s.IV);var C=g?o.resolve(g,t):"",M=(O||"1").split("/").map(Number).filter(Number.isFinite);return new D.LevelKey(p,C,I,M,x)}function d(v,t){["video","audio","text"].forEach(function(r){var e=v.filter(function(p){return(0,_.isCodecType)(p,r)});if(e.length){var s=e.filter(function(p){return 0===p.lastIndexOf("avc1",0)||0===p.lastIndexOf("mp4a",0)});t[r+"Codec"]=s.length>0?s[0]:e[0],v=v.filter(function(p){return-1===e.indexOf(p)})}}),t.unknownCodecs=v}function c(v,t,r){var e=t[r];e&&(v[r]=e)}function u(v,t){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):null!=t&&t.programDateTime&&(v.programDateTime=t.endProgramDateTime),(0,F.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function E(v,t,r,e){v.relurl=t.URI,t.BYTERANGE&&v.setByteRange(t.BYTERANGE),v.level=r,v.sn="initSegment",e&&(v.levelkeys=e),v.initSegment=null}function f(v,t,r){v.levelkeys=t;var e=r.encryptedFragments;(!e.length||e[e.length-1].levelkeys!==t)&&Object.keys(t).some(function(s){return t[s].isCommonEncryption})&&e.push(v)}},"./src/loader/playlist-loader.ts":
/*!***************************************!*\
          !*** ./src/loader/playlist-loader.ts ***!
          \***************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>h});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../events */
"./src/events.ts"),b=L(
/*! ../errors */
"./src/errors.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),k=L(
/*! ./m3u8-parser */
"./src/loader/m3u8-parser.ts"),P=L(
/*! ../types/loader */
"./src/types/loader.ts"),D=L(
/*! ../utils/attr-list */
"./src/utils/attr-list.ts");function T(y,m){var l=y.url;return(void 0===l||0===l.indexOf("data:"))&&(l=m.url),l}const h=function(){function y(l){this.hls=void 0,this.loaders=Object.create(null),this.hls=l,this.registerListeners()}var m=y.prototype;return m.startLoad=function(a){},m.stopLoad=function(){this.destroyInternalLoaders()},m.registerListeners=function(){var a=this.hls;a.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.on(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.unregisterListeners=function(){var a=this.hls;a.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),a.off(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.createInternalLoader=function(a){var o=this.hls.config,i=new(o.pLoader||o.loader)(o);return a.loader=i,this.loaders[a.type]=i,i},m.getInternalLoader=function(a){return this.loaders[a.type]},m.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},m.destroyInternalLoaders=function(){for(var a in this.loaders){var o=this.loaders[a];o&&o.destroy(),this.resetInternalLoader(a)}},m.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},m.onManifestLoading=function(a,o){this.load({id:null,groupId:null,level:0,responseType:"text",type:P.PlaylistContextType.MANIFEST,url:o.url,deliveryDirectives:null})},m.onLevelLoading=function(a,o){this.load({id:o.id,groupId:null,level:o.level,responseType:"text",type:P.PlaylistContextType.LEVEL,url:o.url,deliveryDirectives:o.deliveryDirectives})},m.onAudioTrackLoading=function(a,o){this.load({id:o.id,groupId:o.groupId,level:null,responseType:"text",type:P.PlaylistContextType.AUDIO_TRACK,url:o.url,deliveryDirectives:o.deliveryDirectives})},m.onSubtitleTrackLoading=function(a,o){this.load({id:o.id,groupId:o.groupId,level:null,responseType:"text",type:P.PlaylistContextType.SUBTITLE_TRACK,url:o.url,deliveryDirectives:o.deliveryDirectives})},m.load=function(a){var o,i,u,E,f,v,n=this.hls.config,d=this.getInternalLoader(a);if(d){var c=d.context;if(c&&c.url===a.url)return void R.logger.trace("[playlist-loader]: playlist request ongoing");R.logger.log("[playlist-loader]: aborting previous loader for type: "+a.type),d.abort()}switch(a.type){case P.PlaylistContextType.MANIFEST:i=n.manifestLoadingMaxRetry,u=n.manifestLoadingTimeOut,E=n.manifestLoadingRetryDelay,f=n.manifestLoadingMaxRetryTimeout;break;case P.PlaylistContextType.LEVEL:case P.PlaylistContextType.AUDIO_TRACK:case P.PlaylistContextType.SUBTITLE_TRACK:i=0,u=n.levelLoadingTimeOut;break;default:i=n.levelLoadingMaxRetry,u=n.levelLoadingTimeOut,E=n.levelLoadingRetryDelay,f=n.levelLoadingMaxRetryTimeout}if(d=this.createInternalLoader(a),null!==(o=a.deliveryDirectives)&&void 0!==o&&o.part&&(a.type===P.PlaylistContextType.LEVEL&&null!==a.level?v=this.hls.levels[a.level].details:a.type===P.PlaylistContextType.AUDIO_TRACK&&null!==a.id?v=this.hls.audioTracks[a.id].details:a.type===P.PlaylistContextType.SUBTITLE_TRACK&&null!==a.id&&(v=this.hls.subtitleTracks[a.id].details),v)){var t=v.partTarget,r=v.targetduration;t&&r&&(u=Math.min(1e3*Math.max(3*t,.8*r),u))}var e={timeout:u,maxRetry:i,retryDelay:E,maxRetryDelay:f,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(a,e,s)},m.loadsuccess=function(a,o,n,d){void 0===d&&(d=null),this.resetInternalLoader(n.type);var c=a.data;0===c.indexOf("#EXTM3U")?(o.parsing.start=performance.now(),c.indexOf("#EXTINF:")>0||c.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(a,o,n,d):this.handleMasterPlaylist(a,o,n,d)):this.handleManifestParsingError(a,n,"no EXTM3U delimiter",d)},m.loaderror=function(a,o,n){void 0===n&&(n=null),this.handleNetworkError(o,n,!1,a)},m.loadtimeout=function(a,o,n){void 0===n&&(n=null),this.handleNetworkError(o,n,!0)},m.handleMasterPlaylist=function(a,o,n,d){var c=this.hls,i=a.data,u=T(a,n),E=k.default.parseMasterPlaylist(i,u),f=E.levels,v=E.sessionData,t=E.sessionKeys;if(f.length){var r=f.map(function(O){return{id:O.attrs.AUDIO,audioCodec:O.audioCodec}}),e=f.map(function(O){return{id:O.attrs.SUBTITLES,textCodec:O.textCodec}}),s=k.default.parseMasterPlaylistMedia(i,u,"AUDIO",r),p=k.default.parseMasterPlaylistMedia(i,u,"SUBTITLES",e),g=k.default.parseMasterPlaylistMedia(i,u,"CLOSED-CAPTIONS");s.length&&!s.some(function(O){return!O.url})&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),s.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new D.AttrList({}),bitrate:0,url:""})),c.trigger(A.Events.MANIFEST_LOADED,{levels:f,audioTracks:s,subtitles:p,captions:g,url:u,stats:o,networkDetails:d,sessionData:v,sessionKeys:t})}else this.handleManifestParsingError(a,n,"no level found in manifest",d)},m.handleTrackOrLevelPlaylist=function(a,o,n,d){var c=this.hls,i=n.id,u=n.level,E=n.type,f=T(a,n),v=(0,F.isFiniteNumber)(i)?i:0,t=(0,F.isFiniteNumber)(u)?u:v,r=function S(y){switch(y.type){case P.PlaylistContextType.AUDIO_TRACK:return P.PlaylistLevelType.AUDIO;case P.PlaylistContextType.SUBTITLE_TRACK:return P.PlaylistLevelType.SUBTITLE;default:return P.PlaylistLevelType.MAIN}}(n),e=k.default.parseLevelPlaylist(a.data,f,t,r,v);if(e.fragments.length){if(E===P.PlaylistContextType.MANIFEST){var s={attrs:new D.AttrList({}),bitrate:0,details:e,name:"",url:f};c.trigger(A.Events.MANIFEST_LOADED,{levels:[s],audioTracks:[],url:f,stats:o,networkDetails:d,sessionData:null,sessionKeys:null})}o.parsing.end=performance.now(),n.levelDetails=e,this.handlePlaylistLoaded(a,o,n,d)}else c.trigger(A.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},m.handleManifestParsingError=function(a,o,n,d){this.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:o.type===P.PlaylistContextType.MANIFEST,url:a.url,reason:n,response:a,context:o,networkDetails:d})},m.handleNetworkError=function(a,o,n,d){void 0===n&&(n=!1),R.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+a.type+" level: "+a.level+" id: "+a.id+' group-id: "'+a.groupId+'"');var c=b.ErrorDetails.UNKNOWN,i=!1,u=this.getInternalLoader(a);switch(a.type){case P.PlaylistContextType.MANIFEST:c=n?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case P.PlaylistContextType.LEVEL:c=n?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case P.PlaylistContextType.AUDIO_TRACK:c=n?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case P.PlaylistContextType.SUBTITLE_TRACK:c=n?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1}u&&this.resetInternalLoader(a.type);var E={type:b.ErrorTypes.NETWORK_ERROR,details:c,fatal:i,url:a.url,loader:u,context:a,networkDetails:o};d&&(E.response=d),this.hls.trigger(A.Events.ERROR,E)},m.handlePlaylistLoaded=function(a,o,n,d){var c=n.type,i=n.level,u=n.id,E=n.groupId,f=n.loader,v=n.levelDetails,t=n.deliveryDirectives;if(null!=v&&v.targetduration){if(f)switch(v.live&&(f.getCacheAge&&(v.ageHeader=f.getCacheAge()||0),(!f.getCacheAge||isNaN(v.ageHeader))&&(v.ageHeader=0)),c){case P.PlaylistContextType.MANIFEST:case P.PlaylistContextType.LEVEL:this.hls.trigger(A.Events.LEVEL_LOADED,{details:v,level:i||0,id:u||0,stats:o,networkDetails:d,deliveryDirectives:t});break;case P.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,{details:v,id:u||0,groupId:E||"",stats:o,networkDetails:d,deliveryDirectives:t});break;case P.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADED,{details:v,id:u||0,groupId:E||"",stats:o,networkDetails:d,deliveryDirectives:t})}}else this.handleManifestParsingError(a,n,"invalid target duration",d)},y}()},"./src/polyfills/number.ts":
/*!*********************************!*\
          !*** ./src/polyfills/number.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{MAX_SAFE_INTEGER:()=>A,isFiniteNumber:()=>F});var F=Number.isFinite||function(b){return"number"==typeof b&&isFinite(b)},A=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":
/*!*********************************!*\
          !*** ./src/remux/aac-helper.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>A});const A=function(){function b(){}return b.getSilentFrame=function(k,P){if("mp4a.40.2"===k){if(1===P)return new Uint8Array([0,200,0,128,35,128]);if(2===P)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===P)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===P)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===P)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},b}()},"./src/remux/mp4-generator.ts":
/*!************************************!*\
          !*** ./src/remux/mp4-generator.ts ***!
          \************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>b});var F=Math.pow(2,32)-1,A=function(){function R(){}return R.init=function(){var P;for(P in R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})R.types.hasOwnProperty(P)&&(R.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var D=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),S=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);R.HDLR_TYPES={video:D,audio:S};var T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_=new Uint8Array([0,0,0,0,0,0,0,0]);R.STTS=R.STSC=R.STCO=_,R.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),R.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),R.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);R.FTYP=R.box(R.types.ftyp,h,m,h,y),R.DINF=R.box(R.types.dinf,R.box(R.types.dref,T))},R.box=function(P){for(var D=8,S=arguments.length,T=new Array(S>1?S-1:0),_=1;_<S;_++)T[_-1]=arguments[_];for(var h=T.length,y=h;h--;)D+=T[h].byteLength;var m=new Uint8Array(D);for(m[0]=D>>24&255,m[1]=D>>16&255,m[2]=D>>8&255,m[3]=255&D,m.set(P,4),h=0,D=8;h<y;h++)m.set(T[h],D),D+=T[h].byteLength;return m},R.hdlr=function(P){return R.box(R.types.hdlr,R.HDLR_TYPES[P])},R.mdat=function(P){return R.box(R.types.mdat,P)},R.mdhd=function(P,D){D*=P;var S=Math.floor(D/(F+1)),T=Math.floor(D%(F+1));return R.box(R.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,255&P,S>>24,S>>16&255,S>>8&255,255&S,T>>24,T>>16&255,T>>8&255,255&T,85,196,0,0]))},R.mdia=function(P){return R.box(R.types.mdia,R.mdhd(P.timescale,P.duration),R.hdlr(P.type),R.minf(P))},R.mfhd=function(P){return R.box(R.types.mfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,255&P]))},R.minf=function(P){return R.box(R.types.minf,"audio"===P.type?R.box(R.types.smhd,R.SMHD):R.box(R.types.vmhd,R.VMHD),R.DINF,R.stbl(P))},R.moof=function(P,D,S){return R.box(R.types.moof,R.mfhd(P),R.traf(S,D))},R.moov=function(P){for(var D=P.length,S=[];D--;)S[D]=R.trak(P[D]);return R.box.apply(null,[R.types.moov,R.mvhd(P[0].timescale,P[0].duration)].concat(S).concat(R.mvex(P)))},R.mvex=function(P){for(var D=P.length,S=[];D--;)S[D]=R.trex(P[D]);return R.box.apply(null,[R.types.mvex].concat(S))},R.mvhd=function(P,D){D*=P;var S=Math.floor(D/(F+1)),T=Math.floor(D%(F+1)),_=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,255&P,S>>24,S>>16&255,S>>8&255,255&S,T>>24,T>>16&255,T>>8&255,255&T,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return R.box(R.types.mvhd,_)},R.sdtp=function(P){var T,_,D=P.samples||[],S=new Uint8Array(4+D.length);for(T=0;T<D.length;T++)S[T+4]=(_=D[T].flags).dependsOn<<4|_.isDependedOn<<2|_.hasRedundancy;return R.box(R.types.sdtp,S)},R.stbl=function(P){return R.box(R.types.stbl,R.stsd(P),R.box(R.types.stts,R.STTS),R.box(R.types.stsc,R.STSC),R.box(R.types.stsz,R.STSZ),R.box(R.types.stco,R.STCO))},R.avc1=function(P){var T,_,h,D=[],S=[];for(T=0;T<P.sps.length;T++)D.push((h=(_=P.sps[T]).byteLength)>>>8&255),D.push(255&h),D=D.concat(Array.prototype.slice.call(_));for(T=0;T<P.pps.length;T++)S.push((h=(_=P.pps[T]).byteLength)>>>8&255),S.push(255&h),S=S.concat(Array.prototype.slice.call(_));var y=R.box(R.types.avcC,new Uint8Array([1,D[3],D[4],D[5],255,224|P.sps.length].concat(D).concat([P.pps.length]).concat(S))),m=P.width,l=P.height,a=P.pixelRatio[0],o=P.pixelRatio[1];return R.box(R.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,255&m,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,R.box(R.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),R.box(R.types.pasp,new Uint8Array([a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])))},R.esds=function(P){var D=P.config.length;return new Uint8Array([0,0,0,0,3,23+D,0,1,0,4,15+D,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([D]).concat(P.config).concat([6,1,2]))},R.mp4a=function(P){var D=P.samplerate;return R.box(R.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,D>>8&255,255&D,0,0]),R.box(R.types.esds,R.esds(P)))},R.mp3=function(P){var D=P.samplerate;return R.box(R.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,D>>8&255,255&D,0,0]))},R.stsd=function(P){return R.box(R.types.stsd,R.STSD,"audio"===P.type?"mp3"===P.segmentCodec&&"mp3"===P.codec?R.mp3(P):R.mp4a(P):R.avc1(P))},R.tkhd=function(P){var D=P.id,S=P.duration*P.timescale,T=P.width,_=P.height,h=Math.floor(S/(F+1)),y=Math.floor(S%(F+1));return R.box(R.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,255&D,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,y>>24,y>>16&255,y>>8&255,255&y,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,T>>8&255,255&T,0,0,_>>8&255,255&_,0,0]))},R.traf=function(P,D){var S=R.sdtp(P),T=P.id,_=Math.floor(D/(F+1)),h=Math.floor(D%(F+1));return R.box(R.types.traf,R.box(R.types.tfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,255&T])),R.box(R.types.tfdt,new Uint8Array([1,0,0,0,_>>24,_>>16&255,_>>8&255,255&_,h>>24,h>>16&255,h>>8&255,255&h])),R.trun(P,S.length+16+20+8+16+8+8),S)},R.trak=function(P){return P.duration=P.duration||4294967295,R.box(R.types.trak,R.tkhd(P),R.mdia(P))},R.trex=function(P){var D=P.id;return R.box(R.types.trex,new Uint8Array([0,0,0,0,D>>24,D>>16&255,D>>8&255,255&D,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},R.trun=function(P,D){var y,m,l,a,o,n,S=P.samples||[],T=S.length,_=12+16*T,h=new Uint8Array(_);for(h.set(["video"===P.type?1:0,0,15,1,T>>>24&255,T>>>16&255,T>>>8&255,255&T,(D+=8+_)>>>24&255,D>>>16&255,D>>>8&255,255&D],0),y=0;y<T;y++)h.set([(l=(m=S[y]).duration)>>>24&255,l>>>16&255,l>>>8&255,255&l,(a=m.size)>>>24&255,a>>>16&255,a>>>8&255,255&a,(o=m.flags).isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,(n=m.cts)>>>24&255,n>>>16&255,n>>>8&255,255&n],12+16*y);return R.box(R.types.trun,h)},R.initSegment=function(P){R.types||R.init();var D=R.moov(P),S=new Uint8Array(R.FTYP.byteLength+D.byteLength);return S.set(R.FTYP),S.set(D,R.FTYP.byteLength),S},R}();A.types=void 0,A.HDLR_TYPES=void 0,A.STTS=void 0,A.STSC=void 0,A.STCO=void 0,A.STSZ=void 0,A.VMHD=void 0,A.SMHD=void 0,A.STSD=void 0,A.FTYP=void 0,A.DINF=void 0;const b=A},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
          !*** ./src/remux/mp4-remuxer.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>a,flushTextTrackMetadataCueSamples:()=>d,flushTextTrackUserdataCueSamples:()=>c,normalizePts:()=>o});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ./aac-helper */
"./src/remux/aac-helper.ts"),b=L(
/*! ./mp4-generator */
"./src/remux/mp4-generator.ts"),R=L(
/*! ../events */
"./src/events.ts"),k=L(
/*! ../errors */
"./src/errors.ts"),P=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),D=L(
/*! ../types/loader */
"./src/types/loader.ts"),S=L(
/*! ../utils/timescale-conversion */
"./src/utils/timescale-conversion.ts");function T(){return T=Object.assign?Object.assign.bind():function(E){for(var f=1;f<arguments.length;f++){var v=arguments[f];for(var t in v)Object.prototype.hasOwnProperty.call(v,t)&&(E[t]=v[t])}return E},T.apply(this,arguments)}var m=null,l=null,a=function(){function E(v,t,r,e){if(void 0===e&&(e=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=v,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===m){var p=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);m=p?parseInt(p[1]):0}if(null===l){var g=navigator.userAgent.match(/Safari\/(\d+)/i);l=g?parseInt(g[1]):0}}var f=E.prototype;return f.destroy=function(){},f.resetTimeStamp=function(t){P.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},f.resetNextTimestamp=function(){P.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){P.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(t){var r=!1,e=t.reduce(function(s,p){var g=p.pts-s;return g<-4294967296?(r=!0,o(s,p.pts)):g>0?s:p.pts},t[0].pts);return r&&P.logger.debug("PTS rollover detected"),e},f.remux=function(t,r,e,s,p,g,x,O){var I,C,M,U,w,K,N=p,W=p,V=r.pid>-1,H=r.samples.length,j=t.samples.length>0,X=x&&H>0||H>1;if((!(t.pid>-1)||j)&&(!V||X)||this.ISGenerated||x){this.ISGenerated||(M=this.generateIS(t,r,p));var $,Q=this.isVideoContiguous,z=-1;if(X&&(z=function n(E){for(var f=0;f<E.length;f++)if(E[f].key)return f;return-1}(r.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,z>0){P.logger.warn("[mp4-remuxer]: Dropped "+z+" out of "+H+" video samples due to a missing keyframe");var J=this.getVideoStartPts(r.samples);r.samples=r.samples.slice(z),r.dropped+=z,$=W+=(r.samples[0].pts-J)/r.inputTimeScale}else-1===z&&(P.logger.warn("[mp4-remuxer]: No keyframe found out of "+H+" video samples"),K=!1);if(this.ISGenerated){if(j&&X){var q=this.getVideoStartPts(r.samples),re=(o(t.samples[0].pts,q)-q)/r.inputTimeScale;N+=Math.max(0,re),W+=Math.max(0,-re)}if(j){if(t.samplerate||(P.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),M=this.generateIS(t,r,p)),C=this.remuxAudio(t,N,this.isAudioContiguous,g,V||X||O===D.PlaylistLevelType.AUDIO?W:void 0),X){var ne=C?C.endPTS-C.startPTS:0;r.inputTimeScale||(P.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),M=this.generateIS(t,r,p)),I=this.remuxVideo(r,W,Q,ne)}}else X&&(I=this.remuxVideo(r,W,Q,0));I&&(I.firstKeyFrame=z,I.independent=-1!==z,I.firstKeyFramePTS=$)}}return this.ISGenerated&&(e.samples.length&&(w=d(e,p,this._initPTS,this._initDTS)),s.samples.length&&(U=c(s,p,this._initPTS))),{audio:C,video:I,initSegment:M,independent:K,text:U,id3:w}},f.generateIS=function(t,r,e){var C,M,U,s=t.samples,p=r.samples,g=this.typeSupported,x={},O=!(0,F.isFiniteNumber)(this._initPTS),I="audio/mp4";if(O&&(C=M=1/0),t.config&&s.length&&("mp3"===(t.timescale=t.samplerate,t.segmentCodec)&&(g.mpeg?(I="audio/mpeg",t.codec=""):g.mp3&&(t.codec="mp3")),x.audio={id:"audio",container:I,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&g.mpeg?new Uint8Array(0):b.default.initSegment([t]),metadata:{channelCount:t.channelCount}},O&&(U=t.inputTimeScale,C=M=s[0].pts-Math.round(U*e))),r.sps&&r.pps&&p.length&&(r.timescale=r.inputTimeScale,x.video={id:"main",container:"video/mp4",codec:r.codec,initSegment:b.default.initSegment([r]),metadata:{width:r.width,height:r.height}},O)){U=r.inputTimeScale;var w=this.getVideoStartPts(p),K=Math.round(U*e);M=Math.min(M,o(p[0].dts,w)-K),C=Math.min(C,w-K)}if(Object.keys(x).length)return this.ISGenerated=!0,O&&(this._initPTS=C,this._initDTS=M),{tracks:x,initPTS:C,timescale:U}},f.remuxVideo=function(t,r,e,s){var w,K,p=t.inputTimeScale,g=t.samples,x=[],O=g.length,I=this._initPTS,C=this.nextAvcDts,M=8,U=this.videoSampleDuration,N=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,G=!1;e&&null!==C||(C=r*p-(g[0].pts-o(g[0].dts,g[0].pts)));for(var j=0;j<O;j++){var X=g[j];X.pts=o(X.pts-I,C),X.dts=o(X.dts-I,C),X.dts<g[j>0?j-1:j].dts&&(G=!0)}G&&g.sort(function(Fe,Ne){return Fe.dts-Ne.dts||Fe.pts-Ne.pts});var Z=g[g.length-1].dts-(w=g[0].dts),Q=Z?Math.round(Z/(O-1)):U||t.inputTimeScale/30;if(e){var z=w-C,$=z>Q,J=z<-1;if(($||J)&&(P.logger.warn($?"AVC: "+(0,S.toMsFromMpegTsClock)(z,!0)+" ms ("+z+"dts) hole between fragments detected, filling it":"AVC: "+(0,S.toMsFromMpegTsClock)(-z,!0)+" ms ("+z+"dts) overlapping between fragments detected"),!J||C>g[0].pts)){var q=g[0].pts-z;g[0].dts=w=C,g[0].pts=q,P.logger.log("Video: First PTS/DTS adjusted: "+(0,S.toMsFromMpegTsClock)(q,!0)+"/"+(0,S.toMsFromMpegTsClock)(w,!0)+", delta: "+(0,S.toMsFromMpegTsClock)(z,!0)+" ms")}}w=Math.max(0,w);for(var ie=0,re=0,ne=0;ne<O;ne++){for(var te=g[ne],ae=te.units,ee=ae.length,oe=0,ue=0;ue<ee;ue++)oe+=ae[ue].data.length;re+=oe,ie+=ee,te.length=oe,te.dts=Math.max(te.dts,w),N=Math.min(te.pts,N),W=Math.max(te.pts,W)}K=g[O-1].dts;var ce,le=re+4*ie+8;try{ce=new Uint8Array(le)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:le,reason:"fail allocating video mdat "+le})}var ve=new DataView(ce.buffer);ve.setUint32(0,le),ce.set(b.default.types.mdat,4);for(var ye=!1,ge=Number.POSITIVE_INFINITY,Te=Number.POSITIVE_INFINITY,_e=Number.NEGATIVE_INFINITY,me=Number.NEGATIVE_INFINITY,fe=0;fe<O;fe++){for(var he=g[fe],Ee=he.units,Le=0,se=0,pe=Ee.length;se<pe;se++){var Se=Ee[se],Ie=Se.data,De=Se.data.byteLength;ve.setUint32(M,De),ce.set(Ie,M+=4),M+=De,Le+=4+De}var Ae=void 0;if(fe<O-1)U=g[fe+1].dts-he.dts,Ae=g[fe+1].pts-he.pts;else{var ke=this.config,Re=fe>0?he.dts-g[fe-1].dts:Q;if(Ae=fe>0?he.pts-g[fe-1].pts:Q,ke.stretchShortVideoTrack&&null!==this.nextAudioPts){var Ke=Math.floor(ke.maxBufferHole*p),Me=(s?N+s*p:this.nextAudioPts)-he.pts;Me>Ke?((U=Me-Re)<0?U=Re:ye=!0,P.logger.log("[mp4-remuxer]: It is approximately "+Me/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=Re}else U=Re}var We=Math.round(he.pts-he.dts);ge=Math.min(ge,U),_e=Math.max(_e,U),Te=Math.min(Te,Ae),me=Math.max(me,Ae),x.push(new i(he.key,U,Le,We))}if(x.length)if(m){if(m<70){var Ue=x[0].flags;Ue.dependsOn=2,Ue.isNonSync=0}}else if(l&&me-Te<_e-ge&&Q/_e<.025&&0===x[0].cts){P.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var be=w,xe=0,Be=x.length;xe<Be;xe++){var we=be+x[xe].duration;x[xe].duration=xe<Be-1?we+x[xe+1].cts-(be+x[xe].cts):xe?x[xe-1].duration:Q,x[xe].cts=0,be=we}}console.assert(null!==U,"mp4SampleDuration must be computed"),this.nextAvcDts=C=K+(U=ye||!U?Q:U),this.videoSampleDuration=U,this.isVideoContiguous=!0;var Ye={data1:b.default.moof(t.sequenceNumber++,w,T({},t,{samples:x})),data2:ce,startPTS:N/p,endPTS:(W+U)/p,startDTS:w/p,endDTS:C/p,type:"video",hasAudio:!1,hasVideo:!0,nb:x.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(ce.length,"MDAT length must not be zero"),Ye},f.remuxAudio=function(t,r,e,s,p){var g=t.inputTimeScale,O=g/(t.samplerate?t.samplerate:g),I="aac"===t.segmentCodec?1024:1152,C=I*O,M=this._initPTS,U="mp3"===t.segmentCodec&&this.typeSupported.mpeg,w=[],K=void 0!==p,N=t.samples,W=U?0:8,G=this.nextAudioPts||-1,V=r*g;if(this.isAudioContiguous=e=e||N.length&&G>0&&(s&&Math.abs(V-G)<9e3||Math.abs(o(N[0].pts-M,V)-G)<20*C),N.forEach(function(Se){Se.pts=o(Se.pts-M,V)}),!e||G<0){if(!(N=N.filter(function(Se){return Se.pts>=0})).length)return;G=0===p?0:s&&!K?Math.max(0,V):N[0].pts}if("aac"===t.segmentCodec)for(var H=this.config.maxAudioFramesDrift,j=0,X=G;j<N.length;j++){var Z=N[j],Q=Z.pts,z=Q-X,$=Math.abs(1e3*z/g);if(z<=-H*C&&K)0===j&&(P.logger.warn("Audio frame @ "+(Q/g).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*z/g)+" ms."),this.nextAudioPts=G=X=Q);else if(z>=H*C&&$<1e4&&K){var J=Math.round(z/C);(X=Q-J*C)<0&&(J--,X+=C),0===j&&(this.nextAudioPts=G=X),P.logger.warn("[mp4-remuxer]: Injecting "+J+" audio frame @ "+(X/g).toFixed(3)+"s due to "+Math.round(1e3*z/g)+" ms gap.");for(var q=0;q<J;q++){var ie=Math.max(X,0),re=A.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);re||(P.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),re=Z.unit.subarray()),N.splice(j,0,{unit:re,pts:ie}),X+=C,j++}}Z.pts=X,X+=C}for(var ae,ne=null,te=null,ee=0,oe=N.length;oe--;)ee+=N[oe].unit.byteLength;for(var ue=0,le=N.length;ue<le;ue++){var ce=N[ue],ve=ce.unit,ye=ce.pts;if(null!==te)w[ue-1].duration=Math.round((ye-te)/O);else{if(e&&"aac"===t.segmentCodec&&(ye=G),ne=ye,!(ee>0))return;ee+=W;try{ae=new Uint8Array(ee)}catch{return void this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ee,reason:"fail allocating audio mdat "+ee})}U||(new DataView(ae.buffer).setUint32(0,ee),ae.set(b.default.types.mdat,4))}ae.set(ve,W);var _e=ve.byteLength;W+=_e,w.push(new i(!0,I,_e,0)),te=ye}var me=w.length;if(me){this.nextAudioPts=G=te+O*w[w.length-1].duration;var he=U?new Uint8Array(0):b.default.moof(t.sequenceNumber++,ne/O,T({},t,{samples:w}));t.samples=[];var Ee=ne/g,Le=G/g,pe={data1:he,data2:ae,startPTS:Ee,endPTS:Le,startDTS:Ee,endDTS:Le,type:"audio",hasAudio:!0,hasVideo:!1,nb:me};return this.isAudioContiguous=!0,console.assert(ae.length,"MDAT length must not be zero"),pe}},f.remuxEmptyAudio=function(t,r,e,s){var p=t.inputTimeScale,O=this.nextAudioPts,I=(null!==O?O:s.startDTS*p)+this._initDTS,M=p/(t.samplerate?t.samplerate:p)*1024,U=Math.ceil((s.endDTS*p+this._initDTS-I)/M),w=A.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(P.logger.warn("[mp4-remuxer]: remux empty Audio"),w){for(var K=[],N=0;N<U;N++){var W=I+N*M;K.push({unit:w,pts:W,dts:W})}return t.samples=K,this.remuxAudio(t,r,e,!1)}P.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},E}();function o(E,f){var v;if(null===f)return E;for(v=f<E?-8589934592:8589934592;Math.abs(E-f)>4294967296;)E+=v;return E}function d(E,f,v,t){var r=E.samples.length;if(r){for(var e=E.inputTimeScale,s=0;s<r;s++){var p=E.samples[s];p.pts=o(p.pts-v,f*e)/e,p.dts=o(p.dts-t,f*e)/e}var g=E.samples;return E.samples=[],{samples:g}}}function c(E,f,v){var t=E.samples.length;if(t){for(var r=E.inputTimeScale,e=0;e<t;e++){var s=E.samples[e];s.pts=o(s.pts-v,f*r)/r}E.samples.sort(function(g,x){return g.pts-x.pts});var p=E.samples;return E.samples=[],{samples:p}}}var i=function(f,v,t,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=v,this.size=t,this.cts=r,this.flags=new u(f)},u=function(f){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=f?2:1,this.isNonSync=f?0:1}},"./src/remux/passthrough-remuxer.ts":
/*!******************************************!*\
          !*** ./src/remux/passthrough-remuxer.ts ***!
          \******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>S});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ./mp4-remuxer */
"./src/remux/mp4-remuxer.ts"),b=L(
/*! ../utils/mp4-tools */
"./src/utils/mp4-tools.ts"),R=L(
/*! ../loader/fragment */
"./src/loader/fragment.ts"),k=L(
/*! ../utils/logger */
"./src/utils/logger.ts");function D(T,_){var h=T?.codec;return h&&h.length>4?h:"hvc1"===h||"hev1"===h?"hvc1.1.c.L120.90":"av01"===h?"av01.0.04M.08":"avc1"===h||_===R.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const S=function(){function T(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var _=T.prototype;return _.destroy=function(){},_.resetTimeStamp=function(y){this.initPTS=y,this.lastEndTime=null},_.resetNextTimestamp=function(){this.lastEndTime=null},_.resetInitSegment=function(y,m,l,a){this.audioCodec=m,this.videoCodec=l,this.generateInitSegment((0,b.patchEncyptionData)(y,a)),this.emitInitSegment=!0},_.generateInitSegment=function(y){var m=this.audioCodec,l=this.videoCodec;if(!y||!y.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var a=this.initData=(0,b.parseInitSegment)(y);m||(m=D(a.audio,R.ElementaryStreamTypes.AUDIO)),l||(l=D(a.video,R.ElementaryStreamTypes.VIDEO));var o={};a.audio&&a.video?o.audiovideo={container:"video/mp4",codec:m+","+l,initSegment:y,id:"main"}:a.audio?o.audio={container:"audio/mp4",codec:m,initSegment:y,id:"audio"}:a.video?o.video={container:"video/mp4",codec:l,initSegment:y,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},_.remux=function(y,m,l,a,o){var n,d=this.initPTS,c=this.lastEndTime,i={audio:void 0,video:void 0,text:a,id3:l,initSegment:void 0};(0,F.isFiniteNumber)(c)||(c=this.lastEndTime=o||0);var u=m.samples;if(!u||!u.length)return i;var E={initPTS:void 0,timescale:1},f=this.initData;if((!f||!f.length)&&(this.generateInitSegment(u),f=this.initData),!f||!f.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);var v=(0,b.getStartDTS)(f,u);(0,F.isFiniteNumber)(d)||(this.initPTS=E.initPTS=d=v-o);var t=(0,b.getDuration)(u,f),r=y?v-d:c,e=r+t;(0,b.offsetStartDTS)(f,u,d),t>0?this.lastEndTime=e:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var s=!!f.audio,p=!!f.video,g="";s&&(g+="audio"),p&&(g+="video");var x={data1:u,startPTS:r,startDTS:r,endPTS:e,endDTS:e,type:g,hasAudio:s,hasVideo:p,nb:1,dropped:0};i.audio="audio"===x.type?x:void 0,i.video="audio"!==x.type?x:void 0,i.initSegment=E;var O=null!=(n=this.initPTS)?n:0;return i.id3=(0,A.flushTextTrackMetadataCueSamples)(l,o,O,O),a.samples.length&&(i.text=(0,A.flushTextTrackUserdataCueSamples)(a,o,O)),i},T}()},"./src/task-loop.ts":
/*!**************************!*\
          !*** ./src/task-loop.ts ***!
          \**************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>F});var F=function(){function A(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=A.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(k){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,k),!0)},b.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},A}()},"./src/types/cmcd.ts":
/*!***************************!*\
          !*** ./src/types/cmcd.ts ***!
          \***************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{CMCDObjectType:()=>A,CMCDStreamType:()=>R,CMCDStreamingFormat:()=>b,CMCDVersion:()=>F});var A,k,b,R,F=1;(k=A||(A={})).MANIFEST="m",k.AUDIO="a",k.VIDEO="v",k.MUXED="av",k.INIT="i",k.CAPTION="c",k.TIMED_TEXT="tt",k.KEY="k",k.OTHER="o",function(k){k.DASH="d",k.HLS="h",k.SMOOTH="s",k.OTHER="o"}(b||(b={})),function(k){k.VOD="v",k.LIVE="l"}(R||(R={}))},"./src/types/demuxer.ts":
/*!******************************!*\
          !*** ./src/types/demuxer.ts ***!
          \******************************/(Y,B,L)=>{"use strict";var F,A;L.r(B),L.d(B,{MetadataSchema:()=>F}),(A=F||(F={})).audioId3="org.id3",A.dateRange="com.apple.quicktime.HLS",A.emsg="https://aomedia.org/emsg/ID3"},"./src/types/level.ts":
/*!****************************!*\
          !*** ./src/types/level.ts ***!
          \****************************/(Y,B,L)=>{"use strict";function F(_,h){for(var y=0;y<h.length;y++){var m=h[y];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(_,b(m.key),m)}}function b(_){var h=function R(_,h){if("object"!=typeof _||null===_)return _;var y=_[Symbol.toPrimitive];if(void 0!==y){var m=y.call(_,h||"default");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===h?String:Number)(_)}(_,"string");return"symbol"==typeof h?h:String(h)}L.r(B),L.d(B,{HdcpLevels:()=>k,HlsSkip:()=>P,HlsUrlParameters:()=>S,Level:()=>T,getSkipValue:()=>D});var P,_,k=["NONE","TYPE-0","TYPE-1","TYPE-2",null];function D(_,h){var y=_.canSkipUntil;return y&&(void 0!==h?h-_.endSN:0)<y?_.canSkipDateRanges?P.v2:P.Yes:P.No}(_=P||(P={})).No="",_.Yes="YES",_.v2="v2";var S=function(){function _(y,m,l){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=y,this.part=m,this.skip=l}return _.prototype.addDirectives=function(m){var l=new self.URL(m);return void 0!==this.msn&&l.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&l.searchParams.set("_HLS_part",this.part.toString()),this.skip&&l.searchParams.set("_HLS_skip",this.skip),l.href},_}(),T=function(){function _(h){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[h.url],this.attrs=h.attrs,this.bitrate=h.bitrate,h.details&&(this.details=h.details),this.id=h.id||0,this.name=h.name,this.width=h.width||0,this.height=h.height||0,this.audioCodec=h.audioCodec,this.videoCodec=h.videoCodec,this.unknownCodecs=h.unknownCodecs,this.codecSet=[h.videoCodec,h.audioCodec].filter(function(y){return y}).join(",").replace(/\.[^.,]+/g,"")}return function A(_,h,y){h&&F(_.prototype,h),y&&F(_,y),Object.defineProperty(_,"prototype",{writable:!1})}(_,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var m=y%this.url.length;this._urlId!==m&&(this.details=void 0,this._urlId=m)}}]),_}()},"./src/types/loader.ts":
/*!*****************************!*\
          !*** ./src/types/loader.ts ***!
          \*****************************/(Y,B,L)=>{"use strict";var F,b,A;L.r(B),L.d(B,{PlaylistContextType:()=>F,PlaylistLevelType:()=>A}),(b=F||(F={})).MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack",function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"}(A||(A={}))},"./src/types/transmuxer.ts":
/*!*********************************!*\
          !*** ./src/types/transmuxer.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{ChunkMetadata:()=>F});var F=function(R,k,P,D,S,T){void 0===D&&(D=0),void 0===S&&(S=-1),void 0===T&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=R,this.sn=k,this.id=P,this.size=D,this.part=S,this.partial=T}},"./src/utils/attr-list.ts":
/*!********************************!*\
          !*** ./src/utils/attr-list.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{AttrList:()=>b});var F=/^(\d+)x(\d+)$/,A=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function R(P){for(var D in"string"==typeof P&&(P=R.parseAttrList(P)),P)P.hasOwnProperty(D)&&(this[D]=P[D])}var k=R.prototype;return k.decimalInteger=function(D){var S=parseInt(this[D],10);return S>Number.MAX_SAFE_INTEGER?1/0:S},k.hexadecimalInteger=function(D){if(this[D]){var S=(this[D]||"0x").slice(2);S=(1&S.length?"0":"")+S;for(var T=new Uint8Array(S.length/2),_=0;_<S.length/2;_++)T[_]=parseInt(S.slice(2*_,2*_+2),16);return T}return null},k.hexadecimalIntegerAsNumber=function(D){var S=parseInt(this[D],16);return S>Number.MAX_SAFE_INTEGER?1/0:S},k.decimalFloatingPoint=function(D){return parseFloat(this[D])},k.optionalFloat=function(D,S){var T=this[D];return T?parseFloat(T):S},k.enumeratedString=function(D){return this[D]},k.bool=function(D){return"YES"===this[D]},k.decimalResolution=function(D){var S=F.exec(this[D]);if(null!==S)return{width:parseInt(S[1],10),height:parseInt(S[2],10)}},R.parseAttrList=function(D){var S,T={};for(A.lastIndex=0;null!==(S=A.exec(D));){var h=S[2];0===h.indexOf('"')&&h.lastIndexOf('"')===h.length-1&&(h=h.slice(1,-1)),T[S[1]]=h}return T},R}()},"./src/utils/binary-search.ts":
/*!************************************!*\
          !*** ./src/utils/binary-search.ts ***!
          \************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>A});const A={search:function(R,k){for(var P=0,D=R.length-1,S=null,T=null;P<=D;){var _=k(T=R[S=(P+D)/2|0]);if(_>0)P=S+1;else{if(!(_<0))return T;D=S-1}}return null}}},"./src/utils/buffer-helper.ts":
/*!************************************!*\
          !*** ./src/utils/buffer-helper.ts ***!
          \************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{BufferHelper:()=>b});var F=L(
/*! ./logger */
"./src/utils/logger.ts"),A={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function R(){}return R.isBuffered=function(P,D){try{if(P)for(var S=R.getBuffered(P),T=0;T<S.length;T++)if(D>=S.start(T)&&D<=S.end(T))return!0}catch{}return!1},R.bufferInfo=function(P,D,S){try{if(P){var h,T=R.getBuffered(P),_=[];for(h=0;h<T.length;h++)_.push({start:T.start(h),end:T.end(h)});return this.bufferedInfo(_,D,S)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},R.bufferedInfo=function(P,D,S){D=Math.max(0,D),P.sort(function(i,u){return i.start-u.start||u.end-i.end});var T=[];if(S)for(var _=0;_<P.length;_++){var h=T.length;if(h){var y=T[h-1].end;P[_].start-y<S?P[_].end>y&&(T[h-1].end=P[_].end):T.push(P[_])}else T.push(P[_])}else T=P;for(var l,m=0,a=D,o=D,n=0;n<T.length;n++){var d=T[n].start,c=T[n].end;if(D+S>=d&&D<c)a=d,m=(o=c)-D;else if(D+S<d){l=d;break}}return{len:m,start:a||0,end:o||0,nextStart:l}},R.getBuffered=function(P){try{return P.buffered}catch(D){return F.logger.log("failed to get media.buffered",D),A}},R}()},"./src/utils/cea-608-parser.ts":
/*!*************************************!*\
          !*** ./src/utils/cea-608-parser.ts ***!
          \*************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{CaptionScreen:()=>n,Row:()=>o,default:()=>f});var h,v,F=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),A={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(t){var r=t;return A.hasOwnProperty(t)&&(r=A[t]),String.fromCharCode(r)},R=15,k=100,P={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},D={17:2,18:4,21:6,22:8,23:10,19:13,20:15},S={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(v=h||(h={}))[v.ERROR=0]="ERROR",v[v.TEXT=1]="TEXT",v[v.WARNING=2]="WARNING",v[v.INFO=2]="INFO",v[v.DEBUG=3]="DEBUG",v[v.DATA=3]="DATA";var y=function(){function v(){this.time=null,this.verboseLevel=h.ERROR}return v.prototype.log=function(e,s){if(this.verboseLevel>=e){var p="function"==typeof s?s():s;F.logger.log(this.time+" ["+e+"] "+p)}},v}(),m=function(t){for(var r=[],e=0;e<t.length;e++)r.push(t[e].toString(16));return r},l=function(){function v(r,e,s,p,g){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=r||"white",this.underline=e||!1,this.italics=s||!1,this.background=p||"black",this.flash=g||!1}var t=v.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var s=["foreground","underline","italics","background","flash"],p=0;p<s.length;p++){var g=s[p];e.hasOwnProperty(g)&&(this[g]=e[g])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),a=function(){function v(r,e,s,p,g,x){this.uchar=void 0,this.penState=void 0,this.uchar=r||" ",this.penState=new l(e,s,p,g,x)}var t=v.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,s){this.uchar=e,this.penState.copy(s)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},v}(),o=function(){function v(r){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<k;e++)this.chars.push(new a);this.logger=r,this.pos=0,this.currPenState=new l}var t=v.prototype;return t.equals=function(e){for(var s=!0,p=0;p<k;p++)if(!this.chars[p].equals(e.chars[p])){s=!1;break}return s},t.copy=function(e){for(var s=0;s<k;s++)this.chars[s].copy(e.chars[s])},t.isEmpty=function(){for(var e=!0,s=0;s<k;s++)if(!this.chars[s].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(h.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>k&&(this.logger.log(h.DEBUG,"Too large cursor position "+this.pos),this.pos=k)},t.moveCursor=function(e){var s=this.pos+e;if(e>1)for(var p=this.pos+1;p<s+1;p++)this.chars[p].setPenState(this.currPenState);this.setCursor(s)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var s=this;e>=144&&this.backSpace();var p=b(e);this.pos>=k?this.logger.log(h.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+p+") at position "+s.pos+". Skipping it!"}):(this.chars[this.pos].setChar(p,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var s;for(s=e;s<k;s++)this.chars[s].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],s=!0,p=0;p<k;p++){var g=this.chars[p].uchar;" "!==g&&(s=!1),e.push(g)}return s?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},v}(),n=function(){function v(r){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<R;e++)this.rows.push(new o(r));this.logger=r,this.currRow=R-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=v.prototype;return t.reset=function(){for(var e=0;e<R;e++)this.rows[e].clear();this.currRow=R-1},t.equals=function(e){for(var s=!0,p=0;p<R;p++)if(!this.rows[p].equals(e.rows[p])){s=!1;break}return s},t.copy=function(e){for(var s=0;s<R;s++)this.rows[s].copy(e.rows[s])},t.isEmpty=function(){for(var e=!0,s=0;s<R;s++)if(!this.rows[s].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(h.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(h.INFO,function(){return"pacData = "+JSON.stringify(e)});var s=e.row-1;if(this.nrRollUpRows&&s<this.nrRollUpRows-1&&(s=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==s){for(var p=0;p<R;p++)this.rows[p].clear();var g=this.currRow+1-this.nrRollUpRows,x=this.lastOutputScreen;if(x){var O=x.rows[g].cueStartTime,I=this.logger.time;if(O&&null!==I&&O<I)for(var C=0;C<this.nrRollUpRows;C++)this.rows[s-this.nrRollUpRows+C+1].copy(x.rows[g+C])}}this.currRow=s;var M=this.rows[this.currRow];if(null!==e.indent){var w=Math.max(e.indent-1,0);M.setCursor(e.indent),e.color=M.chars[w].penState.foreground}this.setPen({foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1})},t.setBkgData=function(e){this.logger.log(h.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(h.TEXT,function(){return e.getDisplayText()});var p=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];p.clear(),this.rows.splice(this.currRow,0,p),this.logger.log(h.INFO,"Rolling up")}else this.logger.log(h.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var s=[],p="",x=0;x<R;x++){var O=this.rows[x].getTextString();O&&s.push(e?"Row "+(x+1)+": '"+O+"'":O.trim())}return s.length>0&&(p=e?"["+s.join(" | ")+"]":s.join("\n")),p},t.getTextAndFormat=function(){return this.rows},v}(),d=function(){function v(r,e,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new n(s),this.nonDisplayedMemory=new n(s),this.lastOutputScreen=new n(s),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}var t=v.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(h.INFO,function(){return"MODE="+e}),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var s=this,p=0;p<e.length;p++)this.writeScreen.insertChar(e[p]);var g=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(h.INFO,function(){return g+": "+s.writeScreen.getDisplayText(!0)}),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(h.TEXT,function(){return"DISPLAYED: "+s.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(h.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(h.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(h.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(h.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(h.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(h.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(h.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(h.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(h.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(h.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(h.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(h.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(h.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(h.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var s={flash:!1};if(s.underline=e%2==1,s.italics=e>=46,s.italics)s.foreground="white";else{var p=Math.floor(e/2)-16;s.foreground=["white","green","blue","cyan","red","yellow","magenta"][p]}this.logger.log(h.INFO,"MIDROW: "+JSON.stringify(s)),this.writeScreen.setPen(s)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var s=this.logger.time;null!==s&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,s,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:s):this.cueStartTime=s,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},v}(),c=function(){function v(r,e,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var p=new y;this.channels=[null,new d(r,e,p),new d(r+1,s,p)],this.cmdHistory={a:null,b:null},this.logger=p}var t=v.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,s){this.channels[e].setHandler(s)},t.addData=function(e,s){var p,g,x,O=!1;this.logger.time=e;for(var I=0;I<s.length;I+=2)if(x=127&s[I+1],0!=(g=127&s[I])||0!==x){if(this.logger.log(h.DATA,"["+m([s[I],s[I+1]])+"] -> ("+m([g,x])+")"),(p=this.parseCmd(g,x))||(p=this.parseMidrow(g,x)),p||(p=this.parsePAC(g,x)),p||(p=this.parseBackgroundAttributes(g,x)),!p&&(O=this.parseChars(g,x))){var C=this.currentChannel;C&&C>0?this.channels[C].insertChars(O):this.logger.log(h.WARNING,"No channel found yet. TEXT-MODE?")}!p&&!O&&this.logger.log(h.WARNING,"Couldn't parse cleaned data "+m([g,x])+" orig: "+m([s[I],s[I+1]]))}},t.parseCmd=function(e,s){var p=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&s>=32&&s<=47||(23===e||31===e)&&s>=33&&s<=35))return!1;if(u(e,s,p))return i(null,null,p),this.logger.log(h.DEBUG,"Repeated command ("+m([e,s])+") is dropped"),!0;var O=20===e||21===e||23===e?1:2,I=this.channels[O];return 20===e||21===e||28===e||29===e?32===s?I.ccRCL():33===s?I.ccBS():34===s?I.ccAOF():35===s?I.ccAON():36===s?I.ccDER():37===s?I.ccRU(2):38===s?I.ccRU(3):39===s?I.ccRU(4):40===s?I.ccFON():41===s?I.ccRDC():42===s?I.ccTR():43===s?I.ccRTD():44===s?I.ccEDM():45===s?I.ccCR():46===s?I.ccENM():47===s&&I.ccEOC():I.ccTO(s-32),i(e,s,p),this.currentChannel=O,!0},t.parseMidrow=function(e,s){var p=0;if((17===e||25===e)&&s>=32&&s<=47){if((p=17===e?1:2)!==this.currentChannel)return this.logger.log(h.ERROR,"Mismatch channel in midrow parsing"),!1;var g=this.channels[p];return!!g&&(g.ccMIDROW(s),this.logger.log(h.DEBUG,"MIDROW ("+m([e,s])+")"),!0)}return!1},t.parsePAC=function(e,s){var g=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&s>=64&&s<=127||(16===e||24===e)&&s>=64&&s<=95))return!1;if(u(e,s,g))return i(null,null,g),!0;var I=e<=23?1:2,C=this.channels[I];return!!C&&(C.setPAC(this.interpretPAC(s>=64&&s<=95?1===I?P[e]:S[e]:1===I?D[e]:T[e],s)),i(e,s,g),this.currentChannel=I,!0)},t.interpretPAC=function(e,s){var p,g={color:null,italics:!1,indent:null,underline:!1,row:e};return g.underline=1==(1&(p=s>95?s-96:s-64)),p<=13?g.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(p/2)]:p<=15?(g.italics=!0,g.color="white"):g.indent=4*Math.floor((p-16)/2),g},t.parseChars=function(e,s){var p,O,g=null,x=null;if(e>=25?(p=2,x=e-8):(p=1,x=e),x>=17&&x<=19?(this.logger.log(h.INFO,"Special char '"+b(O=17===x?s+80:18===x?s+112:s+144)+"' in channel "+p),g=[O]):e>=32&&e<=127&&(g=0===s?[e]:[e,s]),g){var I=m(g);this.logger.log(h.DEBUG,"Char codes =  "+I.join(",")),i(e,s,this.cmdHistory)}return g},t.parseBackgroundAttributes=function(e,s){if(!((16===e||24===e)&&s>=32&&s<=47||(23===e||31===e)&&s>=45&&s<=47))return!1;var x,O={};return 16===e||24===e?(x=Math.floor((s-32)/2),O.background=_[x],s%2==1&&(O.background=O.background+"_semi")):45===s?O.background="transparent":(O.foreground="black",47===s&&(O.underline=!0)),this.channels[e<=23?1:2].setBkgData(O),i(e,s,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var s=this.channels[e];s&&s.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var s=0;s<this.channels.length;s++){var p=this.channels[s];p&&p.cueSplitAtTime(e)}},v}();function i(v,t,r){r.a=v,r.b=t}function u(v,t,r){return r.a===v&&r.b===t}const f=c},"./src/utils/codecs.ts":
/*!*****************************!*\
          !*** ./src/utils/codecs.ts ***!
          \*****************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{isCodecSupportedInMp4:()=>b,isCodecType:()=>A});var F={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function A(R,k){var P=F[k];return!!P&&!0===P[R.slice(0,4)]}function b(R,k){return MediaSource.isTypeSupported((k||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":
/*!***************************!*\
          !*** ./src/utils/cues.ts ***!
          \***************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>P});var F=L(
/*! ./vttparser */
"./src/utils/vttparser.ts"),A=L(
/*! ./webvtt-parser */
"./src/utils/webvtt-parser.ts"),b=L(
/*! ./texttrack-utils */
"./src/utils/texttrack-utils.ts"),R=/\s/;const P={newCue:function(S,T,_,h){for(var m,l,a,o,n,y=[],d=self.VTTCue||self.TextTrackCue,c=0;c<h.rows.length;c++)if(a=!0,o=0,n="",!(m=h.rows[c]).isEmpty()){for(var i=0;i<m.chars.length;i++)R.test(m.chars[i].uchar)&&a?o++:(n+=m.chars[i].uchar,a=!1);m.cueStartTime=T,T===_&&(_+=1e-4),o>=16?o--:o++;var u=(0,F.fixLineBreaks)(n.trim()),E=(0,A.generateCueId)(T,_,u);(!S||!S.cues||!S.cues.getCueById(E))&&((l=new d(T,_,u)).id=E,l.line=c+1,l.align="left",l.position=10+Math.min(80,10*Math.floor(8*o/32)),y.push(l))}return S&&y.length&&(y.sort(function(f,v){return"auto"===f.line||"auto"===v.line?0:f.line>8&&v.line>8?v.line-f.line:f.line-v.line}),y.forEach(function(f){return(0,b.addCueToTrack)(S,f)})),y}}},"./src/utils/discontinuities.ts":
/*!**************************************!*\
          !*** ./src/utils/discontinuities.ts ***!
          \**************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{adjustSlidingStart:()=>S,alignMediaPlaylistByPDT:()=>y,alignPDT:()=>h,alignStream:()=>T,findDiscontinuousReferenceFrag:()=>P,findFirstFragWithCC:()=>R,shouldAlignOnDiscontinuities:()=>k});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ./logger */
"./src/utils/logger.ts"),b=L(
/*! ../controller/level-helper */
"./src/controller/level-helper.ts");function R(m,l){for(var a=null,o=0,n=m.length;o<n;o++){var d=m[o];if(d&&d.cc===l){a=d;break}}return a}function k(m,l,a){return!(!l.details||!(a.endCC>a.startCC||m&&m.cc<a.startCC))}function P(m,l,a){void 0===a&&(a=0);var o=m.fragments,n=l.fragments;if(n.length&&o.length){var d=R(o,n[0].cc);if(d&&(!d||d.startPTS))return d;A.logger.log("No frag in previous level to align on")}else A.logger.log("No fragments to align")}function D(m,l){if(m){var a=m.start+l;m.start=m.startPTS=a,m.endPTS=a+m.duration}}function S(m,l){for(var a=l.fragments,o=0,n=a.length;o<n;o++)D(a[o],m);l.fragmentHint&&D(l.fragmentHint,m),l.alignedSliding=!0}function T(m,l,a){l&&(function _(m,l,a){if(k(m,a,l)){var o=P(a.details,l);o&&(0,F.isFiniteNumber)(o.start)&&(A.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),S(o.start,l))}}(m,a,l),!a.alignedSliding&&l.details&&h(a,l.details),!a.alignedSliding&&l.details&&!a.skippedSegments&&(0,b.adjustSliding)(l.details,a))}function h(m,l){if(l.fragments.length&&m.hasProgramDateTime&&l.hasProgramDateTime){var a=l.fragments[0].programDateTime,o=m.fragments[0].programDateTime,n=(o-a)/1e3+l.fragments[0].start;n&&(0,F.isFiniteNumber)(n)&&(A.logger.log("Adjusting PTS using programDateTime delta "+(o-a)+"ms, sliding:"+n.toFixed(3)+" "+m.url+" "),S(n,m))}}function y(m,l){if(m.hasProgramDateTime&&l.hasProgramDateTime){var a=m.fragments,o=l.fragments;if(a.length&&o.length){var d=o[Math.round(o.length/2)-1],c=R(a,d.cc)||a[Math.round(a.length/2)-1],i=d.programDateTime,u=c.programDateTime;null!==i&&null!==u&&S((u-i)/1e3-(c.start-d.start),m)}}}},"./src/utils/ewma-bandwidth-estimator.ts":
/*!***********************************************!*\
          !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
          \***********************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>b});var F=L(
/*! ../utils/ewma */
"./src/utils/ewma.ts");const b=function(){function R(P,D,S){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=S,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new F.default(P),this.fast_=new F.default(D)}var k=R.prototype;return k.update=function(D,S){var T=this.slow_,_=this.fast_;this.slow_.halfLife!==D&&(this.slow_=new F.default(D,T.getEstimate(),T.getTotalWeight())),this.fast_.halfLife!==S&&(this.fast_=new F.default(S,_.getEstimate(),_.getTotalWeight()))},k.sample=function(D,S){var _=(D=Math.max(D,this.minDelayMs_))/1e3,h=8*S/_;this.fast_.sample(_,h),this.slow_.sample(_,h)},k.canEstimate=function(){var D=this.fast_;return D&&D.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},R}()},"./src/utils/ewma.ts":
/*!***************************!*\
          !*** ./src/utils/ewma.ts ***!
          \***************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>A});const A=function(){function b(k,P,D){void 0===P&&(P=0),void 0===D&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=P,this.totalWeight_=D}var R=b.prototype;return R.sample=function(P,D){var S=Math.pow(this.alpha_,P);this.estimate_=D*(1-S)+S*this.estimate_,this.totalWeight_+=P},R.getTotalWeight=function(){return this.totalWeight_},R.getEstimate=function(){if(this.alpha_){var P=1-Math.pow(this.alpha_,this.totalWeight_);if(P)return this.estimate_/P}return this.estimate_},b}()},"./src/utils/fetch-loader.ts":
/*!***********************************!*\
          !*** ./src/utils/fetch-loader.ts ***!
          \***********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>n,fetchSupported:()=>y});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ../loader/load-stats */
"./src/loader/load-stats.ts"),b=L(
/*! ../demux/chunk-cache */
"./src/demux/chunk-cache.ts");function k(d){var c="function"==typeof Map?new Map:void 0;return k=function(u){if(null===u||!function S(d){return-1!==Function.toString.call(d).indexOf("[native code]")}(u))return u;if("function"!=typeof u)throw new TypeError("Super expression must either be null or a function");if(typeof c<"u"){if(c.has(u))return c.get(u);c.set(u,E)}function E(){return P(u,arguments,_(this).constructor)}return E.prototype=Object.create(u.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),T(E,u)},k(d)}function P(d,c,i){return(P=function D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(E,f,v){var t=[null];t.push.apply(t,f);var e=new(Function.bind.apply(E,t));return v&&T(e,v.prototype),e}).apply(null,arguments)}function T(d,c){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,E){return u.__proto__=E,u})(d,c)}function _(d){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)})(d)}function h(){return h=Object.assign?Object.assign.bind():function(d){for(var c=1;c<arguments.length;c++){var i=arguments[c];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(d[u]=i[u])}return d},h.apply(this,arguments)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var m=function(){function d(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||a,this.controller=new self.AbortController,this.stats=new A.LoadStats}var c=d.prototype;return c.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},c.abortInternal=function(){var u=this.response;(!u||!u.ok)&&(this.stats.aborted=!0,this.controller.abort())},c.abort=function(){var u;this.abortInternal(),null!==(u=this.callbacks)&&void 0!==u&&u.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},c.load=function(u,E,f){var v=this,t=this.stats;if(t.loading.start)throw new Error("Loader can only be used once.");t.loading.start=self.performance.now();var r=function l(d,c){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:c,headers:new self.Headers(h({},d.headers))};return d.rangeEnd&&i.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),i}(u,this.controller.signal),e=f.onProgress,s="arraybuffer"===u.responseType,p=s?"byteLength":"length";this.context=u,this.config=E,this.callbacks=f,this.request=this.fetchSetup(u,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){v.abortInternal(),f.onTimeout(t,u,v.response)},E.timeout),self.fetch(this.request).then(function(g){if(v.response=v.loader=g,!g.ok)throw new o(g.statusText||"fetch, bad network response",g.status,g);return t.loading.first=Math.max(self.performance.now(),t.loading.start),t.total=parseInt(g.headers.get("Content-Length")||"0"),e&&(0,F.isFiniteNumber)(E.highWaterMark)?v.loadProgressively(g,t,u,E.highWaterMark,e):s?g.arrayBuffer():g.text()}).then(function(g){var x=v.response;self.clearTimeout(v.requestTimeout),t.loading.end=Math.max(self.performance.now(),t.loading.first);var O=g[p];O&&(t.loaded=t.total=O);var I={url:x.url,data:g};e&&!(0,F.isFiniteNumber)(E.highWaterMark)&&e(t,u,g,x),f.onSuccess(I,t,u,x)}).catch(function(g){self.clearTimeout(v.requestTimeout),t.aborted||f.onError({code:g&&g.code||0,text:g?g.message:null},u,g?g.details:null)})},c.getCacheAge=function(){var u=null;if(this.response){var E=this.response.headers.get("age");u=E?parseFloat(E):null}return u},c.loadProgressively=function(u,E,f,v,t){void 0===v&&(v=0);var r=new b.default,e=u.body.getReader();return function p(){return e.read().then(function(g){if(g.done)return r.dataLength&&t(E,f,r.flush(),u),Promise.resolve(new ArrayBuffer(0));var x=g.value,O=x.length;return E.loaded+=O,O<v||r.dataLength?(r.push(x),r.dataLength>=v&&t(E,f,r.flush(),u)):t(E,f,x,u),p()}).catch(function(){return Promise.reject()})}()},d}();function a(d,c){return new self.Request(d.url,c)}var o=function(d){function c(i,u,E){var f;return(f=d.call(this,i)||this).code=void 0,f.details=void 0,f.code=u,f.details=E,f}return function R(d,c){d.prototype=Object.create(c.prototype),d.prototype.constructor=d,T(d,c)}(c,d),c}(k(Error));const n=m},"./src/utils/hex.ts":
/*!**************************!*\
          !*** ./src/utils/hex.ts ***!
          \**************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>A});const A={hexDump:function(R){for(var k="",P=0;P<R.length;P++){var D=R[P].toString(16);D.length<2&&(D="0"+D),k+=D}return k}}},"./src/utils/imsc1-ttml-parser.ts":
/*!****************************************!*\
          !*** ./src/utils/imsc1-ttml-parser.ts ***!
          \****************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{IMSC1_CODEC:()=>S,parseIMSC1:()=>y});var F=L(
/*! ./mp4-tools */
"./src/utils/mp4-tools.ts"),A=L(
/*! ./vttparser */
"./src/utils/vttparser.ts"),b=L(
/*! ./vttcue */
"./src/utils/vttcue.ts"),R=L(
/*! ../demux/id3 */
"./src/demux/id3.ts"),k=L(
/*! ./timescale-conversion */
"./src/utils/timescale-conversion.ts"),P=L(
/*! ./webvtt-parser */
"./src/utils/webvtt-parser.ts");function D(){return D=Object.assign?Object.assign.bind():function(f){for(var v=1;v<arguments.length;v++){var t=arguments[v];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(f[r]=t[r])}return f},D.apply(this,arguments)}var S="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,_=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,h={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(f,v,t,r,e){var s=(0,F.findBox)(new Uint8Array(f),["mdat"]);if(0!==s.length){var p=s.map(function(x){return(0,R.utf8ArrayToStr)(x)}),g=(0,k.toTimescaleFromScale)(v,1,t);try{p.forEach(function(x){return r(function m(f,v){var e=(new DOMParser).parseFromString(f,"text/xml").getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},p=Object.keys(s).reduce(function(C,M){return C[M]=e.getAttribute("ttp:"+M)||s[M],C},{}),g="preserve"!==e.getAttribute("xml:space"),x=a(l(e,"styling","style")),O=a(l(e,"layout","region")),I=l(e,"body","[begin]");return[].map.call(I,function(C){var M=o(C,g);if(!M||!C.hasAttribute("begin"))return null;var U=i(C.getAttribute("begin"),p),w=i(C.getAttribute("dur"),p),K=i(C.getAttribute("end"),p);if(null===U)throw c(C);if(null===K){if(null===w)throw c(C);K=U+w}var N=new b.default(U-v,K-v,M);N.id=(0,P.generateCueId)(N.startTime,N.endTime,N.text);var V=function n(f,v,t){var r="http://www.w3.org/ns/ttml#styling",e=null,p=null!=f&&f.hasAttribute("style")?f.getAttribute("style"):null;return p&&t.hasOwnProperty(p)&&(e=t[p]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(g,x){var O=d(v,r,x)||d(f,r,x)||d(e,r,x);return O&&(g[x]=O),g},{})}(O[C.getAttribute("region")],x[C.getAttribute("style")],x),H=V.textAlign;if(H){var j=h[H];j&&(N.lineAlign=j),N.align=H}return D(N,V),N}).filter(function(C){return null!==C})}(x,g))})}catch(x){e(x)}}else e(new Error("Could not parse IMSC1 mdat"))}function l(f,v,t){var r=f.getElementsByTagName(v)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function a(f){return f.reduce(function(v,t){var r=t.getAttribute("xml:id");return r&&(v[r]=t),v},{})}function o(f,v){return[].slice.call(f.childNodes).reduce(function(t,r,e){var s;return"br"===r.nodeName&&e?t+"\n":null!==(s=r.childNodes)&&void 0!==s&&s.length?o(r,v):v?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function d(f,v,t){return f&&f.hasAttributeNS(v,t)?f.getAttributeNS(v,t):null}function c(f){return new Error("Could not parse ttml timestamp "+f)}function i(f,v){if(!f)return null;var t=(0,A.parseTimeStamp)(f);return null===t&&(T.test(f)?t=function u(f,v){var t=T.exec(f);return 3600*(0|t[1])+60*(0|t[2])+(0|t[3])+((0|t[4])+(0|t[5])/v.subFrameRate)/v.frameRate}(f,v):_.test(f)&&(t=function E(f,v){var t=_.exec(f),r=Number(t[1]);switch(t[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/v.frameRate;case"t":return r/v.tickRate}return r}(f,v))),t}},"./src/utils/keysystem-util.ts":
/*!*************************************!*\
          !*** ./src/utils/keysystem-util.ts ***!
          \*************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{changeEndianness:()=>b,convertDataUriToArrayBytes:()=>R,strToUtf8array:()=>k});var F=L(
/*! ./numeric-encoding-utils */
"./src/utils/numeric-encoding-utils.ts");function b(P){var D=function(T,_,h){var y=T[_];T[_]=T[h],T[h]=y};D(P,0,3),D(P,1,2),D(P,4,5),D(P,6,7)}function R(P){var D=P.split(":"),S=null;if("data"===D[0]&&2===D.length){var T=D[1].split(";"),_=T[T.length-1].split(",");if(2===_.length){var y=_[1];"base64"===_[0]?(T.splice(-1,1),S=(0,F.base64Decode)(y)):S=function A(P){var D=k(P).subarray(0,16),S=new Uint8Array(16);return S.set(D,16-D.length),S}(y)}}return S}function k(P){return Uint8Array.from(unescape(encodeURIComponent(P)),function(D){return D.charCodeAt(0)})}},"./src/utils/logger.ts":
/*!*****************************!*\
          !*** ./src/utils/logger.ts ***!
          \*****************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{enableLogs:()=>P,logger:()=>D});var F=function(){},A={trace:F,debug:F,log:F,warn:F,info:F,error:F},b=A;function P(S,T){if(self.console&&!0===S||"object"==typeof S){!function k(S){for(var T=arguments.length,_=new Array(T>1?T-1:0),h=1;h<T;h++)_[h-1]=arguments[h];_.forEach(function(y){b[y]=S[y]?S[y].bind(S):function R(S){var T=self.console[S];return T?T.bind(self.console,"["+S+"] >"):F}(y)})}(S,"debug","log","info","warn","error");try{b.log('Debug logs enabled for "'+T+'"')}catch{b=A}}else b=A}var D=A},"./src/utils/mediakeys-helper.ts":
/*!***************************************!*\
          !*** ./src/utils/mediakeys-helper.ts ***!
          \***************************************/(Y,B,L)=>{"use strict";var F,h,A,R;function b(h){switch(h){case A.FAIRPLAY:return F.FAIRPLAY;case A.PLAYREADY:return F.PLAYREADY;case A.WIDEVINE:return F.WIDEVINE;case A.CLEARKEY:return F.CLEARKEY}}function k(h){if(h===R.WIDEVINE)return F.WIDEVINE}function P(h){switch(h){case F.FAIRPLAY:return A.FAIRPLAY;case F.PLAYREADY:return A.PLAYREADY;case F.WIDEVINE:return A.WIDEVINE;case F.CLEARKEY:return A.CLEARKEY}}function D(h){var y=h.drmSystems,m=h.widevineLicenseUrl,l=y?[F.FAIRPLAY,F.WIDEVINE,F.PLAYREADY,F.CLEARKEY].filter(function(a){return!!y[a]}):[];return!l[F.WIDEVINE]&&m&&l.push(F.WIDEVINE),l}L.r(B),L.d(B,{KeySystemFormats:()=>A,KeySystemIds:()=>R,KeySystems:()=>F,getKeySystemsForConfig:()=>D,getSupportedMediaKeySystemConfigurations:()=>T,keySystemDomainToKeySystemFormat:()=>P,keySystemFormatToKeySystemDomain:()=>b,keySystemIdToKeySystemDomain:()=>k,requestMediaKeySystemAccess:()=>S}),(h=F||(F={})).CLEARKEY="org.w3.clearkey",h.FAIRPLAY="com.apple.fps",h.PLAYREADY="com.microsoft.playready",h.WIDEVINE="com.widevine.alpha",function(h){h.CLEARKEY="org.w3.clearkey",h.FAIRPLAY="com.apple.streamingkeydelivery",h.PLAYREADY="com.microsoft.playready",h.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(A||(A={})),function(h){h.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"}(R||(R={}));var S=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function T(h,y,m,l){var a;switch(h){case F.FAIRPLAY:a=["cenc","sinf"];break;case F.WIDEVINE:case F.PLAYREADY:a=["cenc"];break;case F.CLEARKEY:a=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+h)}return function _(h,y,m,l){return[{initDataTypes:h,persistentState:l.persistentState||"not-allowed",distinctiveIdentifier:l.distinctiveIdentifier||"not-allowed",sessionTypes:l.sessionTypes||[l.sessionType||"temporary"],audioCapabilities:y.map(function(o){return{contentType:'audio/mp4; codecs="'+o+'"',robustness:l.audioRobustness||"",encryptionScheme:l.audioEncryptionScheme||null}}),videoCapabilities:m.map(function(o){return{contentType:'video/mp4; codecs="'+o+'"',robustness:l.videoRobustness||"",encryptionScheme:l.videoEncryptionScheme||null}})}]}(a,y,m,l)}},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
          !*** ./src/utils/mediasource-helper.ts ***!
          \*****************************************/(Y,B,L)=>{"use strict";function F(){return self.MediaSource||self.WebKitMediaSource}L.r(B),L.d(B,{getMediaSource:()=>F})},"./src/utils/mp4-tools.ts":
/*!********************************!*\
          !*** ./src/utils/mp4-tools.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{RemuxerTrackIdConfig:()=>S,appendUint8Array:()=>v,bin2str:()=>T,computeRawDurationFromSamples:()=>u,discardEPB:()=>p,findBox:()=>l,getDuration:()=>i,getStartDTS:()=>c,mp4Box:()=>x,mp4pssh:()=>O,offsetStartDTS:()=>E,parseEmsg:()=>g,parseInitSegment:()=>o,parsePssh:()=>I,parseSEIMessageFromNALu:()=>s,parseSamples:()=>t,parseSegmentIndex:()=>a,parseSinf:()=>d,patchEncyptionData:()=>n,readSint32:()=>y,readUint16:()=>_,readUint32:()=>h,segmentValidRange:()=>f,writeUint32:()=>m});var F=L(
/*! ../loader/fragment */
"./src/loader/fragment.ts"),A=L(
/*! ./typed-array */
"./src/utils/typed-array.ts"),b=L(
/*! ../demux/id3 */
"./src/demux/id3.ts"),R=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),k=L(
/*! ./hex */
"./src/utils/hex.ts"),P=Math.pow(2,32)-1,D=[].push,S={video:1,audio:2,id3:3,text:4};function T(C){return String.fromCharCode.apply(null,C)}function _(C,M){var U=C[M]<<8|C[M+1];return U<0?65536+U:U}function h(C,M){var U=y(C,M);return U<0?4294967296+U:U}function y(C,M){return C[M]<<24|C[M+1]<<16|C[M+2]<<8|C[M+3]}function m(C,M,U){C[M]=U>>24,C[M+1]=U>>16&255,C[M+2]=U>>8&255,C[M+3]=255&U}function l(C,M){var U=[];if(!M.length)return U;for(var w=C.byteLength,K=0;K<w;){var N=h(C,K),G=N>1?K+N:w;if(T(C.subarray(K+4,K+8))===M[0])if(1===M.length)U.push(C.subarray(K+8,G));else{var V=l(C.subarray(K+8,G),M.slice(1));V.length&&D.apply(U,V)}K=G}return U}function a(C){var M=[],U=C[0],w=8,K=h(C,w);w+=4,w+=0===U?8:16;var G=C.length+0,V=_(C,w+=2);w+=2;for(var H=0;H<V;H++){var j=w,X=h(C,j);j+=4;var Z=2147483647&X;if(1==(2147483648&X)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var z=h(C,j);j+=4,M.push({referenceSize:Z,subsegmentDuration:z,info:{duration:z/K,start:G,end:G+Z-1}}),G+=Z,w=j+=4}return{earliestPresentationTime:0,timescale:K,version:U,referencesCount:V,references:M}}function o(C){for(var M=[],U=l(C,["moov","trak"]),w=0;w<U.length;w++){var K=U[w],N=l(K,["tkhd"])[0];if(N){var W=N[0],G=0===W?12:20,V=h(N,G),H=l(K,["mdia","mdhd"])[0];if(H){var j=h(H,G=0===(W=H[0])?12:20),X=l(K,["mdia","hdlr"])[0];if(X){var Z=T(X.subarray(8,12)),Q={soun:F.ElementaryStreamTypes.AUDIO,vide:F.ElementaryStreamTypes.VIDEO}[Z];if(Q){var z=l(K,["mdia","minf","stbl","stsd"])[0],$=void 0;z&&($=T(z.subarray(12,16))),M[V]={timescale:j,type:Q},M[Q]={timescale:j,id:V,codec:$}}}}}}return l(C,["moov","mvex","trex"]).forEach(function(q){var ie=h(q,4),re=M[ie];re&&(re.default={duration:h(q,12),flags:h(q,20)})}),M}function n(C,M){if(!C||!M)return C;var U=M.keyId;return U&&M.isCommonEncryption&&l(C,["moov","trak"]).forEach(function(K){var W=l(K,["mdia","minf","stbl","stsd"])[0].subarray(8),G=l(W,["enca"]),V=G.length>0;V||(G=l(W,["encv"])),G.forEach(function(H){l(H.subarray(V?28:78),["sinf"]).forEach(function(Z){var Q=d(Z);if(Q){var z=Q.subarray(8,24);z.some(function($){return 0!==$})||(R.logger.log("[eme] Patching keyId in 'enc"+(V?"a":"v")+">sinf>>tenc' box: "+k.default.hexDump(z)+" -> "+k.default.hexDump(U)),Q.set(U,8))}})})}),C}function d(C){var M=l(C,["schm"])[0];if(M){var U=T(M.subarray(4,8));if("cbcs"===U||"cenc"===U)return l(C,["schi","tenc"])[0]}return R.logger.error("[eme] missing 'schm' box"),null}function c(C,M){return l(M,["moof","traf"]).reduce(function(U,w){var K=l(w,["tfdt"])[0],N=K[0],W=l(w,["tfhd"]).reduce(function(G,V){var H=h(V,4),j=C[H];if(j){var X=h(K,4);1===N&&(X*=Math.pow(2,32),X+=h(K,8));var Q=X/(j.timescale||9e4);if(isFinite(Q)&&(null===G||Q<G))return Q}return G},null);return null!==W&&isFinite(W)&&(null===U||W<U)?W:U},null)||0}function i(C,M){for(var U=0,w=0,K=0,N=l(C,["moof","traf"]),W=0;W<N.length;W++){var G=N[W],V=l(G,["tfhd"])[0],j=M[h(V,4)];if(j){var X=j.default,Z=h(V,0)|X?.flags,Q=X?.duration;8&Z&&(Q=h(V,2&Z?12:8));for(var z=j.timescale||9e4,$=l(G,["trun"]),J=0;J<$.length;J++)!(U=u($[J]))&&Q&&(U=Q*h($[J],4)),j.type===F.ElementaryStreamTypes.VIDEO?w+=U/z:j.type===F.ElementaryStreamTypes.AUDIO&&(K+=U/z)}}if(0===w&&0===K){for(var ie=0,re=l(C,["sidx"]),ne=0;ne<re.length;ne++){var te=a(re[ne]);null!=te&&te.references&&(ie+=te.references.reduce(function(ae,ee){return ae+ee.info.duration||0},0))}return ie}return w||K}function u(C){var M=h(C,0),U=8;1&M&&(U+=4),4&M&&(U+=4);for(var w=0,K=h(C,4),N=0;N<K;N++)256&M&&(w+=h(C,U),U+=4),512&M&&(U+=4),1024&M&&(U+=4),2048&M&&(U+=4);return w}function E(C,M,U){l(M,["moof","traf"]).forEach(function(w){l(w,["tfhd"]).forEach(function(K){var N=h(K,4),W=C[N];if(W){var G=W.timescale||9e4;l(w,["tfdt"]).forEach(function(V){var H=V[0],j=h(V,4);if(0===H)j-=U*G,m(V,4,j=Math.max(j,0));else{j*=Math.pow(2,32),j+=h(V,8),j-=U*G,j=Math.max(j,0);var X=Math.floor(j/(P+1)),Z=Math.floor(j%(P+1));m(V,4,X),m(V,8,Z)}})}})})}function f(C){var M={valid:null,remainder:null},U=l(C,["moof"]);if(!U)return M;if(U.length<2)return M.remainder=C,M;var w=U[U.length-1];return M.valid=(0,A.sliceUint8)(C,0,w.byteOffset-8),M.remainder=(0,A.sliceUint8)(C,w.byteOffset-8),M}function v(C,M){var U=new Uint8Array(C.length+M.length);return U.set(C),U.set(M,C.length),U}function t(C,M){var U=[],w=M.samples,K=M.timescale,N=M.id,W=!1;return l(w,["moof"]).map(function(V){var H=V.byteOffset-8;l(V,["traf"]).map(function(X){var Z=l(X,["tfdt"]).map(function(Q){var z=Q[0],$=h(Q,4);return 1===z&&($*=Math.pow(2,32),$+=h(Q,8)),$/K})[0];return void 0!==Z&&(C=Z),l(X,["tfhd"]).map(function(Q){var z=h(Q,4),$=16777215&h(Q,0),re=0,ne=0!=(16&$),te=0,ae=0!=(32&$),ee=8;z===N&&(0!=(1&$)&&(ee+=8),0!=(2&$)&&(ee+=4),0!=(8&$)&&(re=h(Q,ee),ee+=4),ne&&(te=h(Q,ee),ee+=4),ae&&(ee+=4),"video"===M.type&&(W=function r(C){if(!C)return!1;var M=C.indexOf("."),U=M<0?C:C.substring(0,M);return"hvc1"===U||"hev1"===U||"dvh1"===U||"dvhe"===U}(M.codec)),l(X,["trun"]).map(function(oe){var ue=oe[0],le=16777215&h(oe,0),ce=0!=(1&le),ve=0,ye=0!=(4&le),ge=0!=(256&le),Te=0,_e=0!=(512&le),me=0,fe=0!=(1024&le),he=0!=(2048&le),Ee=0,Le=h(oe,4),se=8;ce&&(ve=h(oe,se),se+=4),ye&&(se+=4);for(var pe=ve+H,Se=0;Se<Le;Se++){if(ge?(Te=h(oe,se),se+=4):Te=re,_e?(me=h(oe,se),se+=4):me=te,fe&&(se+=4),he&&(Ee=0===ue?h(oe,se):y(oe,se),se+=4),M.type===F.ElementaryStreamTypes.VIDEO)for(var Ie=0;Ie<me;){var De=h(w,pe);e(W,w[pe+=4])&&s(w.subarray(pe,pe+De),W?2:1,C+Ee/K,U),pe+=De,Ie+=De+4}C+=Te/K}}))})})}),U}function e(C,M){if(C){var U=M>>1&63;return 39===U||40===U}return 6==(31&M)}function s(C,M,U,w){var K=p(C),N=0;N+=M;for(var W=0,G=0,V=!1,H=0;N<K.length;){W=0;do{if(N>=K.length)break;W+=H=K[N++]}while(255===H);G=0;do{if(N>=K.length)break;G+=H=K[N++]}while(255===H);var j=K.length-N;if(!V&&4===W&&N<K.length){if(V=!0,181===K[N++]){var Z=_(K,N);if(N+=2,49===Z){var Q=h(K,N);if(N+=4,1195456820===Q){var z=K[N++];if(3===z){var $=K[N++],q=64&$,ie=q?2+3*(31&$):0,re=new Uint8Array(ie);if(q){re[0]=$;for(var ne=1;ne<ie;ne++)re[ne]=K[N++]}w.push({type:z,payloadType:W,pts:U,bytes:re})}}}}}else if(5===W&&G<j){if(V=!0,G>16){for(var te=[],ae=0;ae<16;ae++){var ee=K[N++].toString(16);te.push(1==ee.length?"0"+ee:ee),(3===ae||5===ae||7===ae||9===ae)&&te.push("-")}for(var oe=G-16,ue=new Uint8Array(oe),le=0;le<oe;le++)ue[le]=K[N++];w.push({payloadType:W,pts:U,uuid:te.join(""),userData:(0,b.utf8ArrayToStr)(ue),userDataBytes:ue})}}else if(G<j)N+=G;else if(G>j)break}}function p(C){for(var M=C.byteLength,U=[],w=1;w<M-2;)0===C[w]&&0===C[w+1]&&3===C[w+2]?(U.push(w+2),w+=2):w++;if(0===U.length)return C;var K=M-U.length,N=new Uint8Array(K),W=0;for(w=0;w<K;W++,w++)W===U[0]&&(W++,U.shift()),N[w]=C[W];return N}function g(C){var M=C[0],U="",w="",K=0,N=0,W=0,G=0,V=0,H=0;if(0===M){for(;"\0"!==T(C.subarray(H,H+1));)U+=T(C.subarray(H,H+1)),H+=1;for(U+=T(C.subarray(H,H+1)),H+=1;"\0"!==T(C.subarray(H,H+1));)w+=T(C.subarray(H,H+1)),H+=1;w+=T(C.subarray(H,H+1)),H+=1,K=h(C,12),N=h(C,16),G=h(C,20),V=h(C,24),H=28}else if(1===M){K=h(C,H+=4);var j=h(C,H+=4),X=h(C,H+=4);for(H+=4,W=Math.pow(2,32)*j+X,Number.isSafeInteger(W)||(W=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),G=h(C,H),V=h(C,H+=4),H+=4;"\0"!==T(C.subarray(H,H+1));)U+=T(C.subarray(H,H+1)),H+=1;for(U+=T(C.subarray(H,H+1)),H+=1;"\0"!==T(C.subarray(H,H+1));)w+=T(C.subarray(H,H+1)),H+=1;w+=T(C.subarray(H,H+1)),H+=1}return{schemeIdUri:U,value:w,timeScale:K,presentationTime:W,presentationTimeDelta:N,eventDuration:G,id:V,payload:C.subarray(H,C.byteLength)}}function x(C){for(var M=arguments.length,U=new Array(M>1?M-1:0),w=1;w<M;w++)U[w-1]=arguments[w];for(var K=U.length,N=8,W=K;W--;)N+=U[W].byteLength;var G=new Uint8Array(N);for(G[0]=N>>24&255,G[1]=N>>16&255,G[2]=N>>8&255,G[3]=255&N,G.set(C,4),W=0,N=8;W<K;W++)G.set(U[W],N),N+=U[W].byteLength;return G}function O(C,M,U){if(16!==C.byteLength)throw new RangeError("Invalid system id");var w,K,G;if(M){w=1,K=new Uint8Array(16*M.length);for(var N=0;N<M.length;N++){var W=M[N];if(16!==W.byteLength)throw new RangeError("Invalid key");K.set(W,16*N)}}else w=0,K=new Uint8Array;w>0?(G=new Uint8Array(4),M.length>0&&new DataView(G.buffer).setUint32(0,M.length,!1)):G=new Uint8Array;var V=new Uint8Array(4);return U&&U.byteLength>0&&new DataView(V.buffer).setUint32(0,U.byteLength,!1),x([112,115,115,104],new Uint8Array([w,0,0,0]),C,G,K,V,U||new Uint8Array)}function I(C){if(!(C instanceof ArrayBuffer)||C.byteLength<32)return null;var M={version:0,systemId:"",kids:null,data:null},U=new DataView(C),w=U.getUint32(0);if(C.byteLength!==w&&w>44)return null;if(1886614376!==U.getUint32(4)||(M.version=U.getUint32(8)>>>24,M.version>1))return null;M.systemId=k.default.hexDump(new Uint8Array(C,12,16));var N=U.getUint32(28);if(0===M.version){if(w-32<N)return null;M.data=new Uint8Array(C,32,N)}else if(1===M.version){M.kids=[];for(var W=0;W<N;W++)M.kids.push(new Uint8Array(C,32+16*W,16))}return M}},"./src/utils/numeric-encoding-utils.ts":
/*!*********************************************!*\
          !*** ./src/utils/numeric-encoding-utils.ts ***!
          \*********************************************/(Y,B,L)=>{"use strict";function F(D){return D.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function A(D){return btoa(D)}function b(D){return atob(D)}function R(D){return btoa(String.fromCharCode.apply(String,D))}function k(D){return F(R(D))}function P(D){return Uint8Array.from(atob(D),function(S){return S.charCodeAt(0)})}L.r(B),L.d(B,{base64Decode:()=>P,base64DecodeToStr:()=>b,base64Encode:()=>R,base64ToBase64Url:()=>F,base64UrlEncode:()=>k,strToBase64Encode:()=>A})},"./src/utils/output-filter.ts":
/*!************************************!*\
          !*** ./src/utils/output-filter.ts ***!
          \************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>F});var F=function(){function A(R,k){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=k}var b=A.prototype;return b.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(k,P,D){(null===this.startTime||this.startTime>k)&&(this.startTime=k),this.endTime=P,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},A}()},"./src/utils/texttrack-utils.ts":
/*!**************************************!*\
          !*** ./src/utils/texttrack-utils.ts ***!
          \**************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{addCueToTrack:()=>b,clearCurrentCues:()=>R,getCuesInRange:()=>D,removeCuesInRange:()=>k,sendAddTrackEvent:()=>A});var F=L(
/*! ./logger */
"./src/utils/logger.ts");function A(S,T){var _;try{_=new Event("addtrack")}catch{(_=document.createEvent("Event")).initEvent("addtrack",!1,!1)}_.track=S,T.dispatchEvent(_)}function b(S,T){var _=S.mode;if("disabled"===_&&(S.mode="hidden"),S.cues&&!S.cues.getCueById(T.id))try{if(S.addCue(T),!S.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(y){F.logger.debug("[texttrack-utils]: "+y);var h=new self.TextTrackCue(T.startTime,T.endTime,T.text);h.id=T.id,S.addCue(h)}"disabled"===_&&(S.mode=_)}function R(S){var T=S.mode;if("disabled"===T&&(S.mode="hidden"),S.cues)for(var _=S.cues.length;_--;)S.removeCue(S.cues[_]);"disabled"===T&&(S.mode=T)}function k(S,T,_,h){var y=S.mode;if("disabled"===y&&(S.mode="hidden"),S.cues&&S.cues.length>0)for(var m=D(S.cues,T,_),l=0;l<m.length;l++)(!h||h(m[l]))&&S.removeCue(m[l]);"disabled"===y&&(S.mode=y)}function D(S,T,_){var h=[],y=function P(S,T){if(T<S[0].startTime)return 0;var _=S.length-1;if(T>S[_].endTime)return-1;for(var h=0,y=_;h<=y;){var m=Math.floor((y+h)/2);if(T<S[m].startTime)y=m-1;else{if(!(T>S[m].startTime&&h<_))return m;h=m+1}}return S[h].startTime-T<T-S[y].startTime?h:y}(S,T);if(y>-1)for(var m=y,l=S.length;m<l;m++){var a=S[m];if(a.startTime>=T&&a.endTime<=_)h.push(a);else if(a.startTime>_)return h}return h}},"./src/utils/time-ranges.ts":
/*!**********************************!*\
          !*** ./src/utils/time-ranges.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>A});const A={toString:function(R){for(var k="",P=R.length,D=0;D<P;D++)k+="["+R.start(D).toFixed(3)+"-"+R.end(D).toFixed(3)+"]";return k}}},"./src/utils/timescale-conversion.ts":
/*!*******************************************!*\
          !*** ./src/utils/timescale-conversion.ts ***!
          \*******************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{toMpegTsClockFromTimescale:()=>k,toMsFromMpegTsClock:()=>R,toTimescaleFromBase:()=>A,toTimescaleFromScale:()=>b});var F=9e4;function A(P,D,S,T){void 0===S&&(S=1),void 0===T&&(T=!1);var _=P*D*S;return T?Math.round(_):_}function b(P,D,S,T){return void 0===S&&(S=1),void 0===T&&(T=!1),A(P,D,1/S,T)}function R(P,D){return void 0===D&&(D=!1),A(P,1e3,1/F,D)}function k(P,D){return void 0===D&&(D=1),A(P,F,1/D)}},"./src/utils/typed-array.ts":
/*!**********************************!*\
          !*** ./src/utils/typed-array.ts ***!
          \**********************************/(Y,B,L)=>{"use strict";function F(A,b,R){return Uint8Array.prototype.slice?A.slice(b,R):new Uint8Array(Array.prototype.slice.call(A,b,R))}L.r(B),L.d(B,{sliceUint8:()=>F})},"./src/utils/vttcue.ts":
/*!*****************************!*\
          !*** ./src/utils/vttcue.ts ***!
          \*****************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>F});const F=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],b=["start","middle","end","left","right"];function R(T,_){if("string"!=typeof _||!Array.isArray(T))return!1;var h=_.toLowerCase();return!!~T.indexOf(h)&&h}function P(T){return R(b,T)}function D(T){for(var _=arguments.length,h=new Array(_>1?_-1:0),y=1;y<_;y++)h[y-1]=arguments[y];for(var m=1;m<arguments.length;m++){var l=arguments[m];for(var a in l)T[a]=l[a]}return T}function S(T,_,h){var y=this,m={enumerable:!0};y.hasBeenReset=!1;var l="",a=!1,o=T,n=_,d=h,c=null,i="",u=!0,E="auto",f="start",v=50,t="middle",r=50,e="middle";Object.defineProperty(y,"id",D({},m,{get:function(){return l},set:function(p){l=""+p}})),Object.defineProperty(y,"pauseOnExit",D({},m,{get:function(){return a},set:function(p){a=!!p}})),Object.defineProperty(y,"startTime",D({},m,{get:function(){return o},set:function(p){if("number"!=typeof p)throw new TypeError("Start time must be set to a number.");o=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",D({},m,{get:function(){return n},set:function(p){if("number"!=typeof p)throw new TypeError("End time must be set to a number.");n=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",D({},m,{get:function(){return d},set:function(p){d=""+p,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",D({},m,{get:function(){return c},set:function(p){c=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",D({},m,{get:function(){return i},set:function(p){var g=function k(T){return R(A,T)}(p);if(!1===g)throw new SyntaxError("An invalid or illegal string was specified.");i=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",D({},m,{get:function(){return u},set:function(p){u=!!p,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",D({},m,{get:function(){return E},set:function(p){if("number"!=typeof p&&"auto"!==p)throw new SyntaxError("An invalid number or illegal string was specified.");E=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",D({},m,{get:function(){return f},set:function(p){var g=P(p);if(!g)throw new SyntaxError("An invalid or illegal string was specified.");f=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",D({},m,{get:function(){return v},set:function(p){if(p<0||p>100)throw new Error("Position must be between 0 and 100.");v=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",D({},m,{get:function(){return t},set:function(p){var g=P(p);if(!g)throw new SyntaxError("An invalid or illegal string was specified.");t=g,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",D({},m,{get:function(){return r},set:function(p){if(p<0||p>100)throw new Error("Size must be between 0 and 100.");r=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",D({},m,{get:function(){return e},set:function(p){var g=P(p);if(!g)throw new SyntaxError("An invalid or illegal string was specified.");e=g,this.hasBeenReset=!0}})),y.displayState=void 0}return S.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},S}()},"./src/utils/vttparser.ts":
/*!********************************!*\
          !*** ./src/utils/vttparser.ts ***!
          \********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{VTTParser:()=>_,fixLineBreaks:()=>T,parseTimeStamp:()=>b});var F=L(
/*! ./vttcue */
"./src/utils/vttcue.ts"),A=function(){function h(){}return h.prototype.decode=function(l,a){if(!l)return"";if("string"!=typeof l)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},h}();function b(h){function y(l,a,o,n){return 3600*(0|l)+60*(0|a)+(0|o)+parseFloat(n||0)}var m=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return m?parseFloat(m[2])>59?y(m[2],m[3],0,m[4]):y(m[1],m[2],m[3],m[4]):null}var R=function(){function h(){this.values=Object.create(null)}var y=h.prototype;return y.set=function(l,a){!this.get(l)&&""!==a&&(this.values[l]=a)},y.get=function(l,a,o){return o?this.has(l)?this.values[l]:a[o]:this.has(l)?this.values[l]:a},y.has=function(l){return l in this.values},y.alt=function(l,a,o){for(var n=0;n<o.length;++n)if(a===o[n]){this.set(l,a);break}},y.integer=function(l,a){/^-?\d+$/.test(a)&&this.set(l,parseInt(a,10))},y.percent=function(l,a){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(a)){var o=parseFloat(a);if(o>=0&&o<=100)return this.set(l,o),!0}return!1},h}();function k(h,y,m,l){var a=l?h.split(l):[h];for(var o in a)if("string"==typeof a[o]){var n=a[o].split(m);2===n.length&&y(n[0],n[1])}}var P=new F.default(0,0,""),D="middle"===P.align?"middle":"center";function S(h,y,m){var l=h;function a(){var d=b(h);if(null===d)throw new Error("Malformed timestamp: "+l);return h=h.replace(/^[^\sa-zA-Z-]+/,""),d}function n(){h=h.replace(/^\s+/,"")}if(n(),y.startTime=a(),n(),"--\x3e"!==h.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+l);h=h.slice(3),n(),y.endTime=a(),n(),function o(d,c){var i=new R;k(d,function(f,v){var t;switch(f){case"region":for(var r=m.length-1;r>=0;r--)if(m[r].id===v){i.set(f,m[r].region);break}break;case"vertical":i.alt(f,v,["rl","lr"]);break;case"line":t=v.split(","),i.integer(f,t[0]),i.percent(f,t[0])&&i.set("snapToLines",!1),i.alt(f,t[0],["auto"]),2===t.length&&i.alt("lineAlign",t[1],["start",D,"end"]);break;case"position":t=v.split(","),i.percent(f,t[0]),2===t.length&&i.alt("positionAlign",t[1],["start",D,"end","line-left","line-right","auto"]);break;case"size":i.percent(f,v);break;case"align":i.alt(f,v,["start",D,"end","left","right"])}},/:/,/\s/),c.region=i.get("region",null),c.vertical=i.get("vertical","");var u=i.get("line","auto");"auto"===u&&-1===P.line&&(u=-1),c.line=u,c.lineAlign=i.get("lineAlign","start"),c.snapToLines=i.get("snapToLines",!0),c.size=i.get("size",100),c.align=i.get("align",D);var E=i.get("position","auto");"auto"===E&&50===P.position&&(E="start"===c.align||"left"===c.align?0:"end"===c.align||"right"===c.align?100:50),c.position=E}(h,y)}function T(h){return h.replace(/<br(?: \/)?>/gi,"\n")}var _=function(){function h(){this.state="INITIAL",this.buffer="",this.decoder=new A,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=h.prototype;return y.parse=function(l){var a=this;function o(){var E=a.buffer,f=0;for(E=T(E);f<E.length&&"\r"!==E[f]&&"\n"!==E[f];)++f;var v=E.slice(0,f);return"\r"===E[f]&&++f,"\n"===E[f]&&++f,a.buffer=E.slice(f),v}l&&(a.buffer+=a.decoder.decode(l,{stream:!0}));try{var d="";if("INITIAL"===a.state){if(!/\r\n|\n/.test(a.buffer))return this;var c=(d=o()).match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(!c||!c[0])throw new Error("Malformed WebVTT signature.");a.state="HEADER"}for(var i=!1;a.buffer;){if(!/\r\n|\n/.test(a.buffer))return this;switch(i?i=!1:d=o(),a.state){case"HEADER":/:/.test(d)?k(d,function(f,v){},/:/):d||(a.state="ID");continue;case"NOTE":d||(a.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){a.state="NOTE";break}if(!d)continue;if(a.cue=new F.default(0,0,""),a.state="CUE",-1===d.indexOf("--\x3e")){a.cue.id=d;continue}case"CUE":if(!a.cue){a.state="BADCUE";continue}try{S(d,a.cue,a.regionList)}catch{a.cue=null,a.state="BADCUE";continue}a.state="CUETEXT";continue;case"CUETEXT":var u=-1!==d.indexOf("--\x3e");if(!d||u&&(i=!0)){a.oncue&&a.cue&&a.oncue(a.cue),a.cue=null,a.state="ID";continue}if(null===a.cue)continue;a.cue.text&&(a.cue.text+="\n"),a.cue.text+=d;continue;case"BADCUE":d||(a.state="ID")}}}catch{"CUETEXT"===a.state&&a.cue&&a.oncue&&a.oncue(a.cue),a.cue=null,a.state="INITIAL"===a.state?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var l=this;try{if((l.cue||"HEADER"===l.state)&&(l.buffer+="\n\n",l.parse()),"INITIAL"===l.state||"BADWEBVTT"===l.state)throw new Error("Malformed WebVTT signature.")}catch(a){l.onparsingerror&&l.onparsingerror(a)}return l.onflush&&l.onflush(),this},h}()},"./src/utils/webvtt-parser.ts":
/*!************************************!*\
          !*** ./src/utils/webvtt-parser.ts ***!
          \************************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{generateCueId:()=>_,parseWebVTT:()=>y});var F=L(
/*! ./src/polyfills/number */
"./src/polyfills/number.ts"),A=L(
/*! ./vttparser */
"./src/utils/vttparser.ts"),b=L(
/*! ../demux/id3 */
"./src/demux/id3.ts"),R=L(
/*! ./timescale-conversion */
"./src/utils/timescale-conversion.ts"),k=L(
/*! ../remux/mp4-remuxer */
"./src/remux/mp4-remuxer.ts"),P=/\r\n|\n\r|\n|\r/g,D=function(l,a,o){return void 0===o&&(o=0),l.slice(o,o+a.length)===a},S=function(l){var a=parseInt(l.slice(-3)),o=parseInt(l.slice(-6,-4)),n=parseInt(l.slice(-9,-7)),d=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!((0,F.isFiniteNumber)(a)&&(0,F.isFiniteNumber)(o)&&(0,F.isFiniteNumber)(n)&&(0,F.isFiniteNumber)(d)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return a+=1e3*o,(a+=6e4*n)+36e5*d},T=function(l){for(var a=5381,o=l.length;o;)a=33*a^l.charCodeAt(--o);return(a>>>0).toString()};function _(m,l,a){return T(m.toString())+T(l.toString())+T(a)}var h=function(l,a,o){var n=l[a],d=l[n.prevCC];if(!d||!d.new&&n.new)return l.ccOffset=l.presentationOffset=n.start,void(n.new=!1);for(;null!==(c=d)&&void 0!==c&&c.new;){var c;l.ccOffset+=n.start-d.start,n.new=!1,d=l[(n=d).prevCC]}l.presentationOffset=o};function y(m,l,a,o,n,d,c,i){var s,u=new A.VTTParser,E=(0,b.utf8ArrayToStr)(new Uint8Array(m)).trim().replace(P,"\n").split("\n"),f=[],v=(0,R.toMpegTsClockFromTimescale)(l,a),t="00:00.000",r=0,e=0,p=!0;u.oncue=function(g){var x=o[n],O=o.ccOffset,I=(r-v)/9e4;null!=x&&x.new&&(void 0!==e?O=o.ccOffset=x.start:h(o,n,I)),I&&(O=I-o.presentationOffset);var C=g.endTime-g.startTime,M=(0,k.normalizePts)(9e4*(g.startTime+O-e),9e4*d)/9e4;g.startTime=Math.max(M,0),g.endTime=Math.max(M+C,0);var U=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(U)),g.id||(g.id=_(g.startTime,g.endTime,U)),g.endTime>0&&f.push(g)},u.onparsingerror=function(g){s=g},u.onflush=function(){s?i(s):c(f)},E.forEach(function(g){if(p){if(D(g,"X-TIMESTAMP-MAP=")){p=!1,g.slice(16).split(",").forEach(function(x){D(x,"LOCAL:")?t=x.slice(6):D(x,"MPEGTS:")&&(r=parseInt(x.slice(7)))});try{e=S(t)/1e3}catch(x){s=x}return}""===g&&(p=!1)}u.parse(g+"\n")}),u.flush()}},"./src/utils/xhr-loader.ts":
/*!*********************************!*\
          !*** ./src/utils/xhr-loader.ts ***!
          \*********************************/(Y,B,L)=>{"use strict";L.r(B),L.d(B,{default:()=>k});var F=L(
/*! ../utils/logger */
"./src/utils/logger.ts"),A=L(
/*! ../loader/load-stats */
"./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m;const k=function(){function P(S){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=S?S.xhrSetup:null,this.stats=new A.LoadStats,this.retryDelay=0}var D=P.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var T=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),T&&(T.onreadystatechange=null,T.onprogress=null,4!==T.readyState&&(this.stats.aborted=!0,T.abort()))},D.abort=function(){var T;this.abortInternal(),null!==(T=this.callbacks)&&void 0!==T&&T.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(T,_,h){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=T,this.config=_,this.callbacks=h,this.retryDelay=_.retryDelay,this.loadInternal()},D.loadInternal=function(){var T=this.config,_=this.context;if(T){var h=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var m=this.xhrSetup;try{if(m)try{m(h,_.url)}catch{h.open("GET",_.url,!0),m(h,_.url)}h.readyState||h.open("GET",_.url,!0);var l=this.context.headers;if(l)for(var a in l)h.setRequestHeader(a,l[a])}catch(o){return void this.callbacks.onError({code:h.status,text:o.message},_,h)}_.rangeEnd&&h.setRequestHeader("Range","bytes="+_.rangeStart+"-"+(_.rangeEnd-1)),h.onreadystatechange=this.readystatechange.bind(this),h.onprogress=this.loadprogress.bind(this),h.responseType=_.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout),h.send()}},D.readystatechange=function(){var T=this.context,_=this.loader,h=this.stats;if(T&&_){var y=_.readyState,m=this.config;if(!h.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),0===h.loading.first&&(h.loading.first=Math.max(self.performance.now(),h.loading.start)),4===y){_.onreadystatechange=null,_.onprogress=null;var l=_.status,a="arraybuffer"===_.responseType;if(l>=200&&l<300&&(a&&_.response||null!==_.responseText)){var o,n;if(h.loading.end=Math.max(self.performance.now(),h.loading.first),n=a?(o=_.response).byteLength:(o=_.responseText).length,h.loaded=h.total=n,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(h,T,o,_),!this.callbacks)return;this.callbacks.onSuccess({url:_.responseURL,data:o},h,T,_)}else h.retry>=m.maxRetry||l>=400&&l<499?(F.logger.error(l+" while loading "+T.url),this.callbacks.onError({code:l,text:_.statusText},T,_)):(F.logger.warn(l+" while loading "+T.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),h.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},D.loadtimeout=function(){F.logger.warn("timeout while loading "+this.context.url);var T=this.callbacks;T&&(this.abortInternal(),T.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(T){var _=this.stats;_.loaded=T.loaded,T.lengthComputable&&(_.total=T.total)},D.getCacheAge=function(){var T=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var _=this.loader.getResponseHeader("age");T=_?parseFloat(_):null}return T},P}()},"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
          !*** ./node_modules/eventemitter3/index.js ***!
          \*********************************************/Y=>{"use strict";var B=Object.prototype.hasOwnProperty,L="~";function F(){}function A(P,D,S){this.fn=P,this.context=D,this.once=S||!1}function b(P,D,S,T,_){if("function"!=typeof S)throw new TypeError("The listener must be a function");var h=new A(S,T||P,_),y=L?L+D:D;return P._events[y]?P._events[y].fn?P._events[y]=[P._events[y],h]:P._events[y].push(h):(P._events[y]=h,P._eventsCount++),P}function R(P,D){0==--P._eventsCount?P._events=new F:delete P._events[D]}function k(){this._events=new F,this._eventsCount=0}Object.create&&(F.prototype=Object.create(null),(new F).__proto__||(L=!1)),k.prototype.eventNames=function(){var S,T,D=[];if(0===this._eventsCount)return D;for(T in S=this._events)B.call(S,T)&&D.push(L?T.slice(1):T);return Object.getOwnPropertySymbols?D.concat(Object.getOwnPropertySymbols(S)):D},k.prototype.listeners=function(D){var T=this._events[L?L+D:D];if(!T)return[];if(T.fn)return[T.fn];for(var _=0,h=T.length,y=new Array(h);_<h;_++)y[_]=T[_].fn;return y},k.prototype.listenerCount=function(D){var T=this._events[L?L+D:D];return T?T.fn?1:T.length:0},k.prototype.emit=function(D,S,T,_,h,y){var m=L?L+D:D;if(!this._events[m])return!1;var o,n,l=this._events[m],a=arguments.length;if(l.fn){switch(l.once&&this.removeListener(D,l.fn,void 0,!0),a){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,S),!0;case 3:return l.fn.call(l.context,S,T),!0;case 4:return l.fn.call(l.context,S,T,_),!0;case 5:return l.fn.call(l.context,S,T,_,h),!0;case 6:return l.fn.call(l.context,S,T,_,h,y),!0}for(n=1,o=new Array(a-1);n<a;n++)o[n-1]=arguments[n];l.fn.apply(l.context,o)}else{var c,d=l.length;for(n=0;n<d;n++)switch(l[n].once&&this.removeListener(D,l[n].fn,void 0,!0),a){case 1:l[n].fn.call(l[n].context);break;case 2:l[n].fn.call(l[n].context,S);break;case 3:l[n].fn.call(l[n].context,S,T);break;case 4:l[n].fn.call(l[n].context,S,T,_);break;default:if(!o)for(c=1,o=new Array(a-1);c<a;c++)o[c-1]=arguments[c];l[n].fn.apply(l[n].context,o)}}return!0},k.prototype.on=function(D,S,T){return b(this,D,S,T,!1)},k.prototype.once=function(D,S,T){return b(this,D,S,T,!0)},k.prototype.removeListener=function(D,S,T,_){var h=L?L+D:D;if(!this._events[h])return this;if(!S)return R(this,h),this;var y=this._events[h];if(y.fn)y.fn===S&&(!_||y.once)&&(!T||y.context===T)&&R(this,h);else{for(var m=0,l=[],a=y.length;m<a;m++)(y[m].fn!==S||_&&!y[m].once||T&&y[m].context!==T)&&l.push(y[m]);l.length?this._events[h]=1===l.length?l[0]:l:R(this,h)}return this},k.prototype.removeAllListeners=function(D){var S;return D?this._events[S=L?L+D:D]&&R(this,S):(this._events=new F,this._eventsCount=0),this},k.prototype.off=k.prototype.removeListener,k.prototype.addListener=k.prototype.on,k.prefixed=L,k.EventEmitter=k,Y.exports=k},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
          !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
          \*****************************************************/function(Y){var L,F,A,b,R;L=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,F=/^(?=([^\/?#]*))\1([^]*)$/,A=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Y.exports=R={buildAbsoluteURL:function(k,P,D){if(D=D||{},k=k.trim(),!(P=P.trim())){if(!D.alwaysNormalize)return k;var S=R.parseURL(k);if(!S)throw new Error("Error trying to parse base URL.");return S.path=R.normalizePath(S.path),R.buildURLFromParts(S)}var T=R.parseURL(P);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return D.alwaysNormalize?(T.path=R.normalizePath(T.path),R.buildURLFromParts(T)):P;var _=R.parseURL(k);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&"/"!==_.path[0]){var h=F.exec(_.path);_.netLoc=h[1],_.path=h[2]}_.netLoc&&!_.path&&(_.path="/");var y={scheme:_.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(y.netLoc=_.netLoc,"/"!==T.path[0]))if(T.path){var m=_.path,l=m.substring(0,m.lastIndexOf("/")+1)+T.path;y.path=R.normalizePath(l)}else y.path=_.path,T.params||(y.params=_.params,T.query||(y.query=_.query));return null===y.path&&(y.path=D.alwaysNormalize?R.normalizePath(T.path):T.path),R.buildURLFromParts(y)},parseURL:function(k){var P=L.exec(k);return P?{scheme:P[1]||"",netLoc:P[2]||"",path:P[3]||"",params:P[4]||"",query:P[5]||"",fragment:P[6]||""}:null},normalizePath:function(k){for(k=k.split("").reverse().join("").replace(A,"");k.length!==(k=k.replace(b,"")).length;);return k.split("").reverse().join("")},buildURLFromParts:function(k){return k.scheme+k.netLoc+k.path+k.params+k.query+k.fragment}}}},Pe={};function de(Y){var B=Pe[Y];if(void 0!==B)return B.exports;var L=Pe[Y]={exports:{}};return Oe[Y].call(L.exports,L,L.exports,de),L.exports}de.m=Oe,de.n=Y=>{var B=Y&&Y.__esModule?()=>Y.default:()=>Y;return de.d(B,{a:B}),B},de.d=(Y,B)=>{for(var L in B)de.o(B,L)&&!de.o(Y,L)&&Object.defineProperty(Y,L,{enumerable:!0,get:B[L]})},de.o=(Y,B)=>Object.prototype.hasOwnProperty.call(Y,B),de.r=Y=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(Y,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Y,"__esModule",{value:!0})};var Ce=de("./src/hls.ts");return Ce.default})());